
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="Daily minute" />
<meta name="keywords" content="journal, blog">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="AI Agent 设计与落地"/>
  <meta property="og:description" content="Daily minute"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./ai-agent-she-ji-yu-luo-di.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-12-28 20:20:00+08:00"/>
  <meta property="article:modified_time" content="2025-12-28 22:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="journal"/>
  <meta property="article:tag" content="blog"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; AI Agent 设计与落地</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_blank" href="tao.html" >tao</a>
          </li>
          <li>
            <a target="_blank" href="article.html" >article</a>
          </li>
          <li>
            <a target="_blank" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_blank" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_blank" href="manual.html" >manual</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_blank" href="https://github.com/walterfan" >github</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="ai-agent-she-ji-yu-luo-di">AI Agent 设计与落地</h1>
    <p>
      Posted on Sun 28 December 2025 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <table>
<thead>
<tr>
<th><strong>Abstract</strong></th>
<th>AI Agent 设计与落地</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authors</strong></td>
<td><a href="https://www.fanyamin.com">Walter Fan</a></td>
</tr>
<tr>
<td> <strong>Category</strong>  </td>
<td> learning note  </td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>v1.0</td>
</tr>
<tr>
<td><strong>Updated</strong></td>
<td>2025-12-28</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://creativecommons.org/licenses/by-nc-nd/4.0">CC-BY-NC-ND 4.0</a></td>
</tr>
</tbody>
</table>
<p>你可能也见过这种“AI 项目翻车现场”：</p>
<ul>
<li>第 1 天：HR 说“能不能让 AI 帮我看简历？”</li>
<li>第 3 天：你做了个 ChatGPT 问答页，效果还行。</li>
<li>第 7 天：开始接入岗位 JD、做关键词匹配、自动改写，突然发现：<strong>隐私、事实一致性、格式、可解释性、以及“别把人写成神仙”</strong>全都要管。</li>
<li>第 14 天：上线试跑，输出像开盲盒：有时一针见血，有时胡编乱造；有时语言很漂亮，有时把时间线改得稀碎。</li>
</ul>
<p>这时候你会发现：</p>
<blockquote>
<p>这不是“写 prompt”的问题，这是“做系统”的问题。</p>
</blockquote>
<p>所以本文用一个更真实、更能落地的例子来讲 Agent：</p>
<p><strong>“简历审查与优化 AI Agent”</strong>（下面简称“简历 Agent”）</p>
<p>它的目标很具体：
- 输入：候选人简历 + 目标岗位 JD +（可选）公司/团队偏好
- 输出：结构化评审 + 可追溯修改建议 + 生成可投递的新版简历</p>

<h2 id="1-agent-llm">1. 先明确：你要做的是“Agent”还是“自动化脚本 + LLM”？</h2>
<p>很多失败项目不是模型不行，而是把 LLM 问答误当成 Agent。</p>
<h3 id="11-agent-prd">1.1 Agent 的最小定义（建议你直接写到 PRD 顶部）</h3>
<p>Agent = 在给定目标下，能<strong>自主规划步骤</strong>、<strong>调用工具执行</strong>、在环境中产生<strong>可观测动作</strong>、并对结果进行<strong>迭代修正</strong>的系统。</p>
<p>一句话：<strong>它得“会做事”，不是只“会聊天”。</strong> 😄</p>
<h3 id="12-agent-agent">1.2 用“简历 Agent”快速判定：它为什么是 Agent？</h3>
<p>满足以下 2 条以上，你就别再叫它“聊天机器人”了：</p>
<ul>
<li><strong>多步任务</strong>：解析简历 → 对齐 JD → 找缺口 → 改写 → 校验 → 导出</li>
<li><strong>外部工具</strong>：文件解析（PDF/DOCX）、ATS关键词匹配、模板渲染、导出</li>
<li><strong>状态/记忆</strong>：版本管理（v1/v2/v3）、修改记录、用户偏好（语气/行业）</li>
<li><strong>失败重试/回滚</strong>：解析失败、格式坏掉、改写过度、事实冲突</li>
<li><strong>多角色/并行子任务</strong>：分析（Reviewer）/改写（Writer）/校验（Verifier）</li>
</ul>
<blockquote>
<p>小提醒：如果你只是“把简历丢给模型，让它给建议”，那更像“自动化脚本 + LLM”。不要硬叫 Agent，否则评审时你会被问：它的工具呢？它的状态机呢？它的回滚呢？</p>
<p>ATS 是 Applicant Tracking System 的缩写，中文常译为 候选人跟踪系统 / 招聘管理系统。
它用于企业招聘流程中对简历进行 收集、解析、筛选、关键词匹配、流转审批、面试安排与记录 等；很多“ATS 友好简历”指的是更容易被这类系统正确解析并命中岗位关键词。</p>
</blockquote>
<h2 id="2">2. 需求拆解模板：把“目标”拆成可执行的任务网</h2>
<p>落地第一步不是挑框架，而是把问题拆对。</p>
<h3 id="21-prd">2.1 PRD 一页纸模板（强烈建议照填）</h3>
<p>把下面这 7 行当作“必填字段”，填不出来就别开工：</p>
<ul>
<li><strong>目标（Goal）</strong>：用户最终想得到什么可验收的产物？</li>
<li><strong>输入（Input）</strong>：用户给什么？（文本/链接/文件/表格/上下文）</li>
<li><strong>输出（Output）</strong>：产物格式？（Markdown/JSON/工单/代码提交）</li>
<li><strong>环境与工具（Tools）</strong>：允许调用哪些系统？权限范围？</li>
<li><strong>约束（Constraints）</strong>：时间/成本/合规/语言/不可编造（必须可溯源）</li>
<li><strong>验收标准（Acceptance Criteria）</strong>：怎么判断“做对了”？</li>
<li><strong>失败边界（Failure Modes）</strong>：最容易翻车的 3-5 件事</li>
</ul>
<h4 id="211-agent">2.1.1 示例：简历 Agent（一页纸样例）</h4>
<ul>
<li><strong>Goal</strong>：对“岗位 JD”给出结构化评审（匹配度、缺口、风险），并生成可投递的简历（PDF/DOCX）。</li>
<li><strong>Input</strong>：简历文件（PDF/DOCX/Markdown）、岗位 JD（文本/链接）、可选：候选人自述亮点。</li>
<li><strong>Output</strong>：</li>
<li><code>review.json</code>（评分 + 缺口 + 风险 + 建议）</li>
<li><code>resume_v2.docx</code> / <code>resume_v2.pdf</code>（可投递版本）</li>
<li><code>diff.md</code>（改动说明：哪里改了、为什么改）</li>
<li><strong>Tools</strong>：文件解析、关键词抽取、模板渲染（DOCX/LaTeX）、拼写语法检查、导出服务。</li>
<li><strong>Constraints</strong>：</li>
<li>不得编造经历（不能凭空加项目、加公司、加时间线）</li>
<li>涉及 PII 必须脱敏/加密存储；默认不保留原始简历</li>
<li>输出必须可解释：每条建议对应 JD 证据或简历原句</li>
<li><strong>Acceptance</strong>：</li>
<li>所有“新增内容”都能追溯来源（来自简历/来自用户补充）</li>
<li>时间线不冲突；技能与经历一致</li>
<li>ATS 关键词覆盖率提升（可量化）</li>
<li><strong>Failure Modes</strong>：PDF 解析乱序、模型擅自编造、格式破坏、关键词堆砌、语气过度夸张。</li>
</ul>
<h3 id="22-task-graph">2.2 把大目标拆成“可观察”的 Task Graph</h3>
<p>建议输出一个任务有向图（DAG），而不是“步骤列表”。原因：现实里会分支与回退。</p>
<div class="highlight"><pre><span></span><code>flowchart TD
  ingest[IngestResumeAndJD] --&gt; parse[ParseResume]
  ingest --&gt; parseJD[ParseJD]
  parse --&gt; extract[ExtractFactsAndSkills]
  parseJD --&gt; keywords[ExtractJDKeywords]
  extract --&gt; gap[GapAnalysis]
  keywords --&gt; gap
  gap --&gt; rewrite[RewriteSections]
  rewrite --&gt; verify[VerifyNoFabrication]
  verify --&gt; format[RenderTemplate]
  format --&gt; deliver[DeliverFiles]
  verify --&gt;|NeedClarification| ask[AskUserForMissingInfo]
  ask --&gt; rewrite
</code></pre></div>
<blockquote>
<p>关键点：DAG 里每一步都应该能产出“可观测中间结果”（结构化数据/日志/可复现的输出），否则后面你根本没法排查。</p>
</blockquote>
<h2 id="3-controller-tools-memoryctm-policy">3. 核心架构模式：Controller-Tools-Memory（CTM）+ 可插拔 Policy</h2>
<p>把 Agent 当成“可控的软件系统”，而不是“一个 Prompt”。</p>
<h3 id="31">3.1 组件清单（最常用的工程化分层）</h3>
<ul>
<li><strong>Controller（控制器）</strong>：规划、调度、重试、终止条件</li>
<li><strong>Tools（工具层）</strong>：稳定的 API 封装，含鉴权、超时、幂等</li>
<li><strong>Memory（记忆层）</strong>：短期上下文 + 长期状态/向量库 + 任务缓存</li>
<li><strong>Policy（策略层）</strong>：权限、合规、成本、路由、提示词模板</li>
<li><strong>Telemetry（可观测层）</strong>：日志、链路、token/成本、评测与告警</li>
</ul>
<blockquote>
<p>朴素但重要的事实：<strong>模型负责生成候选方案；系统负责把方案变成可控动作。</strong></p>
</blockquote>
<h4 id="311-agent">3.1.1 简历 Agent 的最小可行架构图</h4>
<div class="highlight"><pre><span></span><code>flowchart LR
  User[User] --&gt; Controller

  subgraph tools [Tools]
    ResumeParser[ResumeParser]
    JDParser[JDParser]
    ATSMatcher[ATSKeywordMatcher]
    TemplateRenderer[DocxOrLatexRenderer]
    GrammarChecker[GrammarChecker]
  end

  Controller --&gt; tools
  Controller --&gt; Memory
  Controller --&gt; Policy
  Controller --&gt; Telemetry
  tools --&gt; Controller
</code></pre></div>
<h3 id="32">3.2 趋势提示：现在拼的是“治理能力”</h3>
<p>做简历 Agent 这种“看起来很简单”的事，最容易被低估：
- 你不做治理，输出就会漂移；
- 你不做验证，模型就会编；
- 你不做可观测，线上就变成玄学。</p>
<p>做 Agent 不是“先能跑”，而是 <strong>能控、能查、能省</strong>。⚡️</p>
<h2 id="4-pattern-0-1">4. 构建 Pattern：从 0 到 1 的最短路径（可复用流程）</h2>
<p>下面是我建议的“七步法”，我会用“简历 Agent”贯穿。</p>
<h3 id="41-step-1output-contract">4.1 Step 1：先定输出契约（Output Contract）</h3>
<p>不先定输出，就会在后期评测和集成时失控。</p>
<ul>
<li>输出必须是<strong>结构化</strong>或可解析格式（JSON/Markdown 严格模板）</li>
<li>输出必须<strong>可验证</strong>：引用来源、时间戳、证据链接</li>
</ul>
<p>示例：<code>review.json</code>（建议配 JSON Schema 校验）：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"match_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.78</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"strengths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">"point"</span><span class="p">:</span><span class="w"> </span><span class="s2">"有分布式系统经验"</span><span class="p">,</span><span class="w"> </span><span class="nt">"evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"简历：XX 项目描述"</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"gaps"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">"gap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"缺少可量化指标"</span><span class="p">,</span><span class="w"> </span><span class="nt">"suggestion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"将‘优化性能’改为‘P95 从 800ms 降到 220ms’"</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"risks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="nt">"risk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"时间线不一致"</span><span class="p">,</span><span class="w"> </span><span class="nt">"evidence"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-2022 与 2022-2023 重叠"</span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">"ats_keywords"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"missing"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Kafka"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Kubernetes"</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"covered"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Java"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Spring"</span><span class="p">,</span><span class="w"> </span><span class="s2">"MySQL"</span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"change_rules"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"no_fabrication"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"tone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"professional"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>经验：<strong>宁可让模型写“结构化要点”，也不要让模型写“散文式长文”。</strong> 长文不稳定、难回归，最后只能靠“相信 AI”。（相信就输了😄）</p>
<h3 id="42-step-2tool-first">4.2 Step 2：工具先行（Tool-first）</h3>
<p>把工具当成“后端服务”来写，不要把 API 调用写进提示词里。</p>
<p>简历 Agent 的工具封装建议包含：</p>
<ul>
<li><strong>解析</strong>：PDF/DOCX → 结构化段落（标题/项目/时间）</li>
<li><strong>关键词</strong>：JD 关键词抽取 + ATS 覆盖率计算</li>
<li><strong>导出</strong>：模板渲染（DOCX/LaTeX）+ PDF 导出</li>
<li><strong>检查</strong>：拼写语法、格式约束（行距/分页）、链接有效性</li>
</ul>
<p>工具封装要包含：</p>
<ul>
<li>超时与重试（指数退避）</li>
<li>幂等（尤其是导出/写入文件）</li>
<li>权限与审计（谁上传了什么、谁下载了什么）</li>
<li>统一错误码（便于控制器规划分支）</li>
</ul>
<h4 id="421">4.2.1 工具接口定义模板（错误码 / 幂等键 / 审计字段 / 超时重试）</h4>
<p>很多 Agent 项目“看起来能跑、实际上不可控”，本质原因是：<strong>工具层没有被当成“后端服务”来设计。</strong></p>
<p>下面给一个我常用的工具接口模板，你可以直接套到简历 Agent 里。</p>
<p><strong>工具接口（建议统一成 JSON 结构）</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResumeParser"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"parse"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"req_20251228_0001"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"idempotency_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sha256:..."</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"actor"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"u_123"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"tenant_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"t_001"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hr"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"input"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"file_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3://bucket/resume.pdf"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"file_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pdf"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"zh-CN"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"policy"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"timeout_ms"</span><span class="p">:</span><span class="w"> </span><span class="mi">8000</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"max_retries"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"retry_backoff_ms"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">],</span>
<span class="w">    </span><span class="nt">"pii_mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"redact"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>工具返回（强烈建议统一错误码 + 可重试标记）</strong>：</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PARSE_PDF_OCR_REQUIRED"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PDF is scanned image; OCR required"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"retryable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"hint"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ask user for DOCX or run OCR tool"</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">"audit"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">"request_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"req_20251228_0001"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"tool"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResumeParser"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"parse"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-12-28T22:31:12Z"</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>建议的错误码分层（够用就好）</strong>：</p>
<ul>
<li><strong>权限类</strong>：<code>AUTH_FORBIDDEN</code>, <code>AUTH_EXPIRED</code></li>
<li><strong>输入类</strong>：<code>INPUT_INVALID</code>, <code>INPUT_TOO_LARGE</code>, <code>INPUT_UNSUPPORTED_FORMAT</code></li>
<li><strong>外部依赖类</strong>：<code>UPSTREAM_TIMEOUT</code>, <code>UPSTREAM_RATE_LIMIT</code>, <code>UPSTREAM_5XX</code></li>
<li><strong>业务类</strong>：<code>PARSE_FAILED</code>, <code>TEMPLATE_RENDER_FAILED</code>, <code>EXPORT_FAILED</code></li>
<li><strong>安全类</strong>：<code>PII_POLICY_VIOLATION</code>, <code>PROMPT_INJECTION_DETECTED</code></li>
</ul>
<p><strong>幂等键（idempotency_key）怎么用？</strong></p>
<ul>
<li>对“导出/生成文件/写入版本库”这种写入型操作，必须带幂等键。</li>
<li>推荐幂等键 = <code>hash(用户ID + 输入文件hash + JD hash + 输出模板版本 + 输出格式)</code>。</li>
<li>这样用户重复点“生成”，最多只会拿到同一份产物，不会生成 N 份垃圾版本。</li>
</ul>
<p><strong>审计字段（audit）怎么用？</strong></p>
<ul>
<li>记录：谁触发、用的什么输入、调用了哪些工具、产出了哪些文件。</li>
<li>简历是 PII，审计不是可选项，是上线门票。</li>
</ul>
<p><strong>超时/重试建议（工程上很实用）</strong>：</p>
<ul>
<li>工具调用超时要“短”，避免线程池被拖死；需要长任务就异步化。</li>
<li>只对 <strong>retryable=true</strong> 的错误重试（比如限流/超时），不要对解析失败重试 N 次自我感动。</li>
<li>控制器里做“错误分支规划”：</li>
<li><code>PARSE_PDF_OCR_REQUIRED</code> → 调 <code>OcrTool</code> 或请求用户提供 DOCX</li>
<li><code>TEMPLATE_RENDER_FAILED</code> → 回滚上一个版本 + 降级到纯文本模板</li>
</ul>
<h3 id="43-step-3plannerexecutor">4.3 Step 3：设计控制器（Planner/Executor）</h3>
<p>推荐从简单开始：</p>
<ul>
<li>单代理 ReAct（最容易上线）</li>
<li>需要并行再升级多代理（Reviewer/Writer/Verifier）</li>
</ul>
<p>控制器最重要的三个能力：</p>
<ul>
<li><strong>停止条件</strong>：何时停止（例如“所有风险已闭环/需要用户补充信息”）</li>
<li><strong>失败恢复</strong>：解析失败→换解析器；关键词过拟合→降权；格式崩→回滚到上一个版本</li>
<li><strong>预算控制</strong>：token/调用次数/最长耗时</li>
</ul>
<h3 id="44-step-4state-machine">4.4 Step 4：加入记忆与状态（State Machine）</h3>
<p>简历优化往往是多轮：你改一版，我再提意见，再改一版。</p>
<p>如果你的任务跨多轮或跨天，必须上状态机，否则靠对话历史必翻车。</p>
<p>建议状态：</p>
<ul>
<li>INIT → INGESTED → ANALYZED → REWRITTEN → VERIFIED → RENDERED → DELIVERED → DONE</li>
<li>异常：NEED_CLARIFICATION / FAILED / ROLLBACKED</li>
</ul>
<h3 id="45-step-5verification-layer">4.5 Step 5：验证层（Verification Layer）要单独做</h3>
<p>“模型自信”不等于“事实正确”。简历场景尤其敏感：<strong>编造经历 = 灾难</strong>。</p>
<p>建议最少做两种验证：</p>
<ul>
<li><strong>可验证引用</strong>：每条建议必须绑定证据（简历原句/JD 句子/用户补充）</li>
<li><strong>二次校验</strong>：用更便宜模型 + 规则校验</li>
<li>时间线是否冲突</li>
<li>公司/项目是否新增（禁止）</li>
<li>指标是否夸张（例如“提升 100 倍”要打回）</li>
</ul>
<h4 id="451-verifier">4.5.1 Verifier 规则清单（简历场景必备）</h4>
<p>简历 Agent 的 Verifier 目标不是“挑刺”，而是把不确定性收敛成工程可控变量：<strong>不编造、不冲突、不过度、不注水、可追溯。</strong></p>
<p>你可以把 Verifier 拆成“规则 + 轻量模型”的组合：</p>
<ul>
<li><strong>规则</strong>：快、稳定、可解释（适合拦截硬错误）</li>
<li><strong>轻量模型</strong>：查软错误（语气、可读性、是否过度夸张）</li>
</ul>
<p>下面这份清单可以直接做成代码里的 <code>resume_verifier_rules.yaml</code>。</p>
<p><strong>A. 不得编造（No Fabrication）</strong></p>
<ul>
<li><strong>禁止新增实体</strong>：新公司名/新项目名/新时间段/新职位头衔</li>
<li><strong>做法</strong>：抽取“原简历实体集合”，对比“改写后实体集合”，出现新增则打回</li>
<li><strong>禁止新增不存在的技术栈</strong>：例如简历没写过 Kafka，却突然出现“精通 Kafka”</li>
<li><strong>做法</strong>：技能词表 + 证据绑定（每个技能必须引用原句或用户补充）</li>
</ul>
<p><strong>B. 时间线一致性（Timeline Consistency）</strong></p>
<ul>
<li><strong>日期范围不冲突</strong>：同一时间段出现两个全职经历</li>
<li><strong>项目时间必须落在所属公司时间范围内</strong></li>
<li><strong>“至今”只能出现一次</strong>（或者必须解释多段并行）</li>
</ul>
<p><strong>C. 量化指标合理性（Metric Sanity Check）</strong></p>
<ul>
<li><strong>夸张指标拦截</strong>：如“提升 100 倍/提升 10000%”默认判为高风险</li>
<li><strong>缺少单位/口径提醒</strong>：如“延迟降低 80%”但无 P95/P99、无基线</li>
<li><strong>指标与动作一致</strong>：写了“做缓存”但指标却是“准确率提升”，就要提示不一致</li>
</ul>
<p><strong>D. 关键词堆砌检测（Keyword Stuffing）</strong></p>
<ul>
<li><strong>关键词密度过高</strong>：一段话连续罗列 15 个技术名词</li>
<li><strong>与经历无关的关键词</strong>：JD 里要 Kubernetes，你简历没任何容器经历却硬塞</li>
<li><strong>策略</strong>：允许“补充学习/接触”，但必须放在“技能/学习”而不是“工作成果”里</li>
</ul>
<p><strong>E. 风格与语气（Tone &amp; Claims）</strong></p>
<ul>
<li><strong>避免把人写成神仙</strong>：</li>
<li>不要“全栈架构师/技术领袖/业内顶尖”这种无证据的帽子</li>
<li>更推荐：职责 + 行动 + 结果（CAR/STAR）</li>
<li><strong>一致性</strong>：同一份简历的语气要统一（不要一会儿像论文，一会儿像广告）</li>
</ul>
<p><strong>F. 格式与可投递性（Format &amp; Deliverability）</strong></p>
<ul>
<li><strong>段落长度限制</strong>：项目描述每条 1-2 行（不然 HR 眼睛会罢工）</li>
<li><strong>链接可用</strong>：GitHub/Blog/作品集链接必须可点击、格式正确</li>
<li><strong>导出校验</strong>：生成的 DOCX/PDF 不能乱码、不能错位、不能丢字</li>
</ul>
<p><strong>G. 证据链（Evidence Binding）</strong></p>
<ul>
<li>每条建议必须绑定一个 evidence：</li>
<li><code>resume_quote</code>（原简历句子）或 <code>user_supplied</code>（用户补充）或 <code>jd_quote</code>（JD 句子）</li>
<li>没证据的建议不允许出现在最终输出里（顶多作为“需要用户确认的问题”）</li>
</ul>
<h3 id="46-step-6observability-governance">4.6 Step 6：上可观测与治理（Observability + Governance）</h3>
<p>上线后你需要回答四个问题：</p>
<ul>
<li>这次建议为什么是这样？（trace + 证据链）</li>
<li>花了多少钱？（token、工具调用）</li>
<li>哪些地方最容易出错？（解析错误/格式错误/编造风险）</li>
<li>哪些提示/工具最有效？（A/B、回归测试）</li>
</ul>
<h3 id="47-step-7-eval-first-iteration">4.7 Step 7：做评测集 + 回归（Eval-first Iteration）</h3>
<p>没有评测集，优化永远是拍脑袋。</p>
<p>简历 Agent 的评测集建议包含：</p>
<ul>
<li>正常样本（70%）：规范简历 + 清晰 JD</li>
<li>边界样本（20%）：PDF 乱序、JD 含糊、经历缺指标</li>
<li>对抗样本（10%）：诱导编造、诱导夸大、提示注入（“忽略规则”）</li>
</ul>
<h2 id="5">5. 典型模式库（直接套用）</h2>
<h3 id="arag">模式 A：RAG + 工具写入（简历知识库助手）</h3>
<p>适用：把公司内部“简历模板/面试题库/胜任力模型”做成可检索知识库。</p>
<p>要点：</p>
<ul>
<li>检索：向量 + 关键字混合（避免仅语义）</li>
<li>引用：每条建议绑定来源（模板条目/胜任力条款）</li>
<li>写入：必须幂等（防止重复版本/覆盖原件）</li>
</ul>
<h3 id="b-plan-execute-review">模式 B：规划-执行-校对（Plan-Execute-Review）</h3>
<p>适用：简历改写、生成 cover letter、生成面试自我介绍。</p>
<p>推荐结构：</p>
<ul>
<li>Planner：列“缺口清单 + 需要用户补充的问题”</li>
<li>Executor：生成 v2 草稿</li>
<li>Reviewer：查事实/格式/语气/风险</li>
</ul>
<h3 id="creviewerwriterverifier">模式 C：多代理分工（Reviewer/Writer/Verifier）</h3>
<p>适用：长简历、多岗位投递、多版本管理。</p>
<p>注意事项：</p>
<ul>
<li>明确“交付物格式”（PDF/DOCX + review.json + diff.md）</li>
<li>Agent 间通信只传<strong>结构化中间结果</strong>，少传长文本（省 token，也更可控）</li>
</ul>
<h2 id="6-agent">6. 安全与合规检查清单（Agent 必备）</h2>
<p>简历 = PII + 职业轨迹，安全合规要放在前面。</p>
<h3 id="61-checklist">6.1 工具调用安全（Checklist）</h3>
<ul>
<li>上传文件默认<strong>不持久化</strong>，或设置明确的保留期（例如 24h 自动删除）</li>
<li>所有写入类工具必须有沙箱/测试环境</li>
<li>权限遵循最小权限原则（谁能看谁的简历）</li>
<li>对外网请求有域名白名单</li>
<li>记录审计日志（谁触发、做了什么、参数是什么）</li>
</ul>
<h3 id="62-prompt-injection">6.2 防提示注入（Prompt Injection）</h3>
<ul>
<li>系统提示与用户内容严格分隔（role separation）</li>
<li>检索内容视为“不可信输入”，需要清洗</li>
<li>重要工具参数由程序生成，不让模型自由拼接（特别是文件路径、模板变量）</li>
</ul>
<h2 id="7">7. 上线验收：别只验“能跑”，要验“能控”</h2>
<p>建议用下面这张表做上线前验收（可以直接贴进 Jira）：</p>
<h3 id="71">7.1 功能</h3>
<ul>
<li>输出契约符合约定格式（review.json 校验通过）</li>
<li>新简历可导出，格式不崩（分页/对齐/字体）</li>
</ul>
<h3 id="72">7.2 稳定性</h3>
<ul>
<li>解析失败可降级或重试（换解析器/换策略）</li>
<li>有明确停止条件，不会无限循环</li>
</ul>
<h3 id="73">7.3 成本</h3>
<ul>
<li>单任务 token 成本可预测，超预算会自动中止或降级</li>
</ul>
<h3 id="74">7.4 可观测</h3>
<ul>
<li>trace 可追溯到每次工具调用与关键中间结论</li>
<li>关键错误有告警（解析失败率、导出失败率、编造风险命中率）</li>
</ul>
<h3 id="75">7.5 安全</h3>
<ul>
<li>越权用例测试通过（不能访问不该访问的简历）</li>
<li>导出/下载操作具备审计</li>
</ul>
<h2 id="8-agent">8. 一个小但高效的习惯：给 Agent 也安排“走动休息”</h2>
<p>写 Agent 常常要长时间盯日志、调提示、看 trace。对人同样要做节奏管理：</p>
<ul>
<li>每小时离开桌面走 5 分钟</li>
<li>借机做“切换视角”的复盘：我现在是在解决真实问题，还是在堆复杂度？</li>
</ul>
<h2 id="agent">结语：把简历 Agent 当软件工程，而不是魔法</h2>
<p>当你用输出契约约束结果、用工具层约束动作、用状态机约束流程、用评测与可观测约束迭代时，Agent 的不确定性会被收敛成可控的工程变量。</p>
<hr/>
<p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/journal.html">journal</a>
      <a href="./tag/blog.html">blog</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./man-man-ren-sheng-lu.html" title="漫漫人生路">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./bie-liao-2025.html" title="别了, 2025">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./operator-terraform-dui-chuan-tong-yun-wei-de-gai-bian.html">Operator + Terraform 对传统运维的改变</a></li>
      <li><a href="./shi-yong-di-yi-xing-yuan-li-zuo-jia-gou-she-ji.html">使用第一性原理做架构设计</a></li>
      <li><a href="./zhi-chang-zhong-na-xie-huo-de-zui-jiu-de-fang-fa-lun-suo-xie.html">职场中那些“活得最久”的方法论缩写</a></li>
      <li><a href="./zui-tong-yong-de-6-da-yan-jiang-kuang-jia.html">最通用的 6 大演讲框架</a></li>
      <li><a href="./bie-liao-2025.html">别了, 2025</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>