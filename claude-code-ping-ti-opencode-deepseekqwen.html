
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="用 opencode 接入公司私有部署的 Qwen/DeepSeek（OpenAI-compatible API），日常写代码、改文档基本够用，还能省掉订阅费与 token 焦虑；关键是把 TLS 自签证书这关过掉，别用“关掉校验”这种野路子。" />
<meta name="keywords" content="opencode, claude-code, qwen, deepseek, openai-compatible, ai-sdk, tls, ca">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="claude code 平替: opencode + deepseek/qwen"/>
  <meta property="og:description" content="用 opencode 接入公司私有部署的 Qwen/DeepSeek（OpenAI-compatible API），日常写代码、改文档基本够用，还能省掉订阅费与 token 焦虑；关键是把 TLS 自签证书这关过掉，别用“关掉校验”这种野路子。"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./claude-code-ping-ti-opencode-deepseekqwen.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2026-02-25 23:27:00+08:00"/>
  <meta property="article:modified_time" content="2026-02-25 23:41:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Tech"/>
  <meta property="article:tag" content="opencode"/>
  <meta property="article:tag" content="claude-code"/>
  <meta property="article:tag" content="qwen"/>
  <meta property="article:tag" content="deepseek"/>
  <meta property="article:tag" content="openai-compatible"/>
  <meta property="article:tag" content="ai-sdk"/>
  <meta property="article:tag" content="tls"/>
  <meta property="article:tag" content="ca"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; claude code 平替: opencode + deepseek/qwen</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_blank" href="tao.html" >tao</a>
          </li>
          <li>
            <a target="_blank" href="article.html" >article</a>
          </li>
          <li>
            <a target="_blank" href="manual.html" >manual</a>
          </li>
          <li>
            <a target="_blank" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_blank" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_blank" href="https://github.com/walterfan" >github</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="claude-code-ping-ti-opencode-deepseekqwen">claude code 平替: opencode + deepseek/qwen</h1>
    <p>
      Posted on Wed 25 February 2026 in <a href="./category/tech.html">Tech</a>

    </p>
  </header>


  <div>
    <table>
<thead>
<tr>
<th><strong>Abstract</strong></th>
<th>claude code 平替: opencode + deepseek/qwen</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authors</strong></td>
<td><a href="https://www.fanyamin.com">Walter Fan</a></td>
</tr>
<tr>
<td><strong>Category</strong></td>
<td>tech note</td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>v1.0</td>
</tr>
<tr>
<td><strong>Updated</strong></td>
<td>2026-02-25</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://creativecommons.org/licenses/by-nc-nd/4.0">CC-BY-NC-ND 4.0</a></td>
</tr>
</tbody>
</table>
<h1 id="claude-code-opencode-deepseekqwen">claude code 平替: opencode + deepseek/qwen</h1>
<p>我最近试了下 <code>opencode</code>，配上私有部署的 Qwen（也能换成 DeepSeek 之类的模型），最大的感受很朴素：</p>
<ul>
<li><strong>不再为 token 不够用焦虑</strong>（至少不会像订阅版那样心里打鼓）</li>
<li><strong>不再为订阅费心疼</strong>（尤其是“用得不算少，但又没到重度依赖”的阶段）</li>
<li><strong>效果确实差一点</strong>，可应付日常工作，基本够用</li>
</ul>
<p>这篇文章就写一件事：<strong>把它配到能稳定用</strong>，尤其是 TLS/证书这道坎。</p>
<h2 id="what">What</h2>
<p>这里说的 <code>opencode</code>，指的是 <a href="https://github.com/anomalyco/opencode">OpenCode（GitHub）</a> 这个开源 AI coding agent，官方介绍在 <a href="https://opencode.ai/">opencode.ai</a>。</p>
<h3 id="opencode">OpenCode 是什么（我按“能干啥”来理解它）</h3>
<p>一句话：<strong>把“像 Claude Code 那样的 coding agent”搬进终端里</strong>。</p>
<p>它的定位不是“再做一个 Chat”，而是偏工程化的“工作台”：</p>
<ul>
<li><strong>终端/TUI 优先</strong>：你在 shell 里就能开工（当然也有桌面端、IDE 扩展）</li>
<li><strong>Provider-agnostic</strong>：不绑定某一家模型/平台，你能接 Claude、GPT、Gemini，也能接公司私有部署（只要你们提供 OpenAI-compatible 入口）</li>
<li><strong>LSP 支持</strong>：它会尽量加载合适的语言服务，做补全/跳转/诊断这类“工程味”更重的活</li>
<li><strong>多会话</strong>：同一个项目你可以开多个 session 并行做事（比如一个写代码，一个查资料/改文档）</li>
<li><strong>内置 agent</strong>：它有不同权限/风格的 agent 可切（比如默认的全权限 <code>build</code>，以及更克制的只读 <code>plan</code>）</li>
<li><strong>隐私取向</strong>：官方宣称不存储你的代码/上下文（这点对“公司环境”尤其关键）</li>
</ul>
<h3 id="_1">这篇文章里，我们来看看怎么用它</h3>
<p>更具体点，这篇文章就是把 OpenCode 当“壳”，把模型换成公司内网的 Qwen/DeepSeek：</p>
<ul>
<li>用 <code>opencode</code> 当“终端里的 AI coding 工具”</li>
<li>通过 <code>@ai-sdk/openai-compatible</code> 接一个 <strong>OpenAI-compatible</strong> 的内部网关（例如 <code>https://my-llm.fanyamin.com/api</code>）</li>
<li>选择内部提供的模型（例如 <code>Qwen3-235B-A22B-Thinking-2507</code> / <code>Qwen3-235B-A22B-Instruct-2507</code>）</li>
</ul>
<h2 id="why">Why</h2>
<h3 id="1">1) 订阅费不是问题，心理负担才是</h3>
<p>你在写代码时不想算账：这段 prompt 值不值 0.2 美元，那段 diff 会不会把额度烧穿。能“放心用”，比“更聪明一点”对日常效率更重要。</p>
<h3 id="2">2) 私有部署模型的收益：可控、便宜、能集成</h3>
<p>固然模型能力会略弱，但胜在：</p>
<ul>
<li><strong>内网可达</strong>，延迟更稳</li>
<li><strong>权限可控</strong>（公司做过审计/准入）</li>
<li><strong>成本可控</strong>（你不用自己掏腰包）</li>
</ul>
<h2 id="how">How</h2>
<p>下面以 <code>my-llm.fanyamin.com</code> 这种 OpenAI-compatible 网关为例。</p>
<h3 id="0-opencode">0) 安装 opencode</h3>
<p>你可以用官方安装脚本（最省事）：</p>
<div class="highlight"><pre><span></span><code>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://opencode.ai/install<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</code></pre></div>

<p>或者用 npm 全局安装：</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>opencode-ai
</code></pre></div>

<p>我个人的小习惯是：涉及 <code>curl | bash</code> 的脚本，<strong>能先看一眼脚本内容再跑就先看一眼</strong>，心里更踏实。</p>
<h3 id="1-opencode-provider">1) 配置 <code>opencode</code> 的 provider（推荐做法）</h3>
<p>把配置放在 <code>~/.config/opencode/opencode.json</code>。</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;$schema&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://opencode.ai/config.json&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;provider&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;happycoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;npm&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@ai-sdk/openai-compatible&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;happycoding&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;baseURL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://my-llm.fanyamin.com/api&quot;</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;models&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Qwen3-235B-A22B-Thinking-2507&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Qwen3-235B-A22B-Thinking-2507&quot;</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Qwen3-235B-A22B-Instruct-2507&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>几点小提醒：</p>
<ul>
<li><strong>JSON 一定要用英文双引号</strong>。你贴的示例里出现了中文引号（“ ”），那种会直接解析失败。</li>
<li>你原文里 <code>Instruct</code> 的 <code>name</code> 写成了 <code>Thinking</code>，我这里顺手纠正了。</li>
</ul>
<h3 id="2-provider">2) 登录与连上 provider</h3>
<p>我这边的流程是：</p>
<ul>
<li><code>/connect</code>：按提示完成登录/授权</li>
<li><code>/models</code>：确认能看到内部的模型列表（例如 <code>Qwen3-235B-A22B-A22B-Thinking-2507</code> 这种）</li>
</ul>
<p>注意：<code>~/.local/share/opencode/auth.json</code> 这类文件里通常会有 token/凭据，<strong>别提交到仓库，也别贴到博客里</strong>。</p>
<h3 id="3-tls-ca">3) 处理 TLS 自签证书（推荐：加 CA，不要关校验）</h3>
<p>最常见的坑是：内部网关用了自签名证书/私有 CA，Node 侧会报 TLS 错。</p>
<p>正确姿势是把 CA 加进来。你可以用 <code>openssl s_client</code> 把证书链导出来：</p>
<div class="highlight"><pre><span></span><code>openssl<span class="w"> </span>s_client<span class="w"> </span>-connect<span class="w"> </span>my-llm.fanyamin.com:443<span class="w"> </span>-showcerts<span class="w"> </span>&lt;/dev/null<span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="p">|</span><span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-outform<span class="w"> </span>PEM<span class="w"> </span>&gt;<span class="w"> </span>happycoding-ca.pem
</code></pre></div>

<p>然后让 Node 进程信任它：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_EXTRA_CA_CERTS</span><span class="o">=</span>~/certs/happycoding-ca.pem
opencode
</code></pre></div>

<h3 id="4-tls">4) 不推荐但你可能见过的做法：关闭 TLS 校验</h3>
<p>你可能见过：</p>
<div class="highlight"><pre><span></span><code><span class="nv">NODE_TLS_REJECT_UNAUTHORIZED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span>opencode
</code></pre></div>

<p>这招的确“能跑”，但代价是把 HTTPS 的安全底线一起关掉了——等于告诉程序：<strong>谁给我证书我都信</strong>。</p>
<p>如果只是本地临时排障（确认问题确实在证书链），可以短时间用一下；<strong>长期使用不建议</strong>，更不建议写进脚本或文档当“标准方案”。</p>
<h2 id="example">Example</h2>
<p>一个我自己常用的“确认链路是否通了”的小步骤：</p>
<ol>
<li><code>opencode</code> 里跑 <code>/models</code> 能列出 <code>Qwen3-235B-A22B-*</code>  </li>
<li>随便发个小请求让它回一句（例如让它总结 <code>git diff</code> 的意图）  </li>
<li>如果卡住/报错，优先看 TLS、代理、baseURL 路径（<code>/api</code> 有没有漏）</li>
</ol>
<h2 id="summary">Summary</h2>
<p><code>opencode + 私有 Qwen/DeepSeek</code> 这条路，核心不是“模型有多强”，而是“工程上能不能稳稳当当地用起来”。</p>
<p>无他：<strong>先把证书、网络、配置这三板斧练熟</strong>，你就能少掉一半的心火。</p>
<h2 id="checklist">Checklist</h2>
<ul>
<li>[ ] <code>~/.config/opencode/opencode.json</code> 是合法 JSON（英文双引号、无多余逗号）</li>
<li>[ ] <code>baseURL</code> 能在本机访问（内网/VPN/代理）</li>
<li>[ ] <code>/models</code> 能列出你要用的模型</li>
<li>[ ] 自签证书问题用 <code>NODE_EXTRA_CA_CERTS</code> 解决，而不是长期 <code>NODE_TLS_REJECT_UNAUTHORIZED=0</code></li>
<li>[ ] <code>auth.json</code>/token 文件不外传、不进 git</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><code>opencode</code> 配置 schema：<code>https://opencode.ai/config.json</code></li>
<li>Node 环境变量：<code>NODE_EXTRA_CA_CERTS</code></li>
</ul>
<hr/>
<p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/opencode.html">opencode</a>
      <a href="./tag/claude-code.html">claude-code</a>
      <a href="./tag/qwen.html">qwen</a>
      <a href="./tag/deepseek.html">deepseek</a>
      <a href="./tag/openai-compatible.html">openai-compatible</a>
      <a href="./tag/ai-sdk.html">ai-sdk</a>
      <a href="./tag/tls.html">tls</a>
      <a href="./tag/ca.html">ca</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./zhi-chang-gong-ju-xiang-zhi-xiang-shang-guan-li-bu-shi-pai-ma-pi-er-shi-bang-ling-dao-zuo-jue-ce-geng-rong-yi.html" title="职场工具箱之向上管理：不是拍马屁，而是帮领导做决策更容易">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./agent-skillsgei-ai-zhu-shou-zhuang-shang-ji-neng-bao.html">Agent Skills：给 AI 助手装上"技能包"</a></li>
      <li><a href="./claude-code-shi-yong-ji-qiao-yu-cheng-ben-kong-zhi-zhi-nan.html">Claude Code 使用技巧与成本控制指南</a></li>
      <li><a href="./go-cryptotls-configclone-session-resumption-pitfalls-cve-2025-68121.html">Go crypto/tls Config.Clone session resumption pitfalls (CVE-2025-68121)</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>