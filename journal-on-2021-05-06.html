
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">


  <link rel="stylesheet"
        type="text/css"
        href="./theme/stork/stork.css" />

  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="Daily minute" />
<meta name="keywords" content="journal, blog">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="Journal on 2021-05-06"/>
  <meta property="og:description" content="Daily minute"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./journal-on-2021-05-06.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-05-06 10:20:00+08:00"/>
  <meta property="article:modified_time" content="2021-05-06 19:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="journal"/>
  <meta property="article:tag" content="blog"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; Journal on 2021-05-06</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>

    <div class="stork">
      <input class="stork-input" type="text" autocomplete="off" name="q" data-stork="sitesearch" placeholder="Search..." onclick="loadStorkIndex()"/>
      <div class="stork-output" data-stork="sitesearch-output"></div>
    </div>

    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="/pims" >tao</a>
          </li>
          <li>
            <a target="_self" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_self" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_self" href="https://github.com/walterfan" >github</a>
          </li>
          <li>
            <a target="_self" href="https://www.jianshu.com/u/e0b365801f48" >技术文章</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="journal-on-2021-05-06">Journal on 2021-05-06</h1>
    <p>
      Posted on Thu 06 May 2021 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <h1 id="thinking">Thinking</h1>
<p>但愿不厌其烦，笔耕不辍</p>
<h1 id="quote">Quote</h1>
<h1 id="program">Program</h1>
<p><img alt="nat" src="images/nat.png"></p>
<h2 id="turn-server">Turn Server</h2>
<p>Coturn: https://github.com/coturn/coturn</p>
<p>— refer to https://github.com/coturn/coturn/blob/master/INSTALL</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/coturn/coturn.git
cd coturn
</code></pre></div>

<ul>
<li>vi install_deps.sh</li>
</ul>
<div class="highlight"><pre><span></span><code>yum install -y openssl-devel
yum install -y  sqlite
yum install -y  sqlite-devel
yum install -y  libevent
yum install -y  libevent-devel
#yum install postgresql-devel
#yum install postgresql-server
#yum install mysql-devel
#yum install mysql-server
#yum install hiredis
#yum install hiredis-devel
</code></pre></div>

<ul>
<li>source install_deps.sh</li>
<li>./configure</li>
<li>make</li>
<li>make install</li>
</ul>
<p>1) If your system supports automatic start-up system daemon services,
then to enable the turnserver as a system service that is automatically
started, you have to:</p>
<div class="highlight"><pre><span></span><code>    a) Create and edit /etc/turnserver.conf or
    /usr/local/etc/turnserver.conf .
    Use /usr/local/etc/turnserver.conf.default as an example.

    b) For user accounts settings: set up SQLite or PostgreSQL or
    MySQL or MongoDB or Redis database for user accounts.
    Use /usr/local/share/turnserver/schema.sql as SQL database schema,
    or use /usr/local/share/turnserver/schema.userdb.redis as Redis
    database schema description and/or
    /usr/local/share/turnserver/schema.stats.redis
    as Redis status &amp; statistics database schema description.

    If you are using SQLite, the default database location is in
    /var/db/turndb or in /usr/local/var/db/turndb or in /var/lib/turn/turndb.

    c) add whatever is necessary to enable start-up daemon for the
    /usr/local/bin/turnserver.
</code></pre></div>

<p>2) If you do not want the turnserver to be a system service,
   then you can start/stop it "manually", using the "turnserver"
   executable with appropriate options (see the documentation).</p>
<p>3) To create database schema, use schema in file
/usr/local/share/turnserver/schema.sql.</p>
<p>4) For additional information, run:</p>
<p>$ man turnserver
   $ man turnadmin
   $ man turnutils</p>
<ul>
<li>sqlite3 /usr/local/var/db/turndb</li>
</ul>
<div class="highlight"><pre><span></span><code>SQLite version 3.7.17 2013-05-20 00:56:22
Enter &quot;.help&quot; for instructions
Enter SQL statements terminated with a &quot;;&quot;
sqlite&gt; .schema
CREATE TABLE turnusers_lt (
    realm varchar(127) default &#39;&#39;,
    name varchar(512),
    hmackey char(128),
    PRIMARY KEY (realm,name)
);
CREATE TABLE turn_secret (
        realm varchar(127) default &#39;&#39;,
        value varchar(256),
        primary key (realm,value)
);
CREATE TABLE allowed_peer_ip (
        realm varchar(127) default &#39;&#39;,
        ip_range varchar(256),
        primary key (realm,ip_range)
);
CREATE TABLE denied_peer_ip (
        realm varchar(127) default &#39;&#39;,
        ip_range varchar(256),
        primary key (realm,ip_range)
);
CREATE TABLE turn_origin_to_realm (
        origin varchar(127),
        realm varchar(127),
        primary key (origin)
);
CREATE TABLE turn_realm_option (
        realm varchar(127) default &#39;&#39;,
        opt varchar(32),
        value varchar(128),
        primary key (realm,opt)
);
CREATE TABLE oauth_key (
        kid varchar(128),
        ikm_key varchar(256),
        timestamp bigint default 0,
        lifetime integer default 0,
        as_rs_alg varchar(64) default &#39;&#39;,
        realm varchar(127),
        primary key (kid)
);
CREATE TABLE admin_user (
        name varchar(32),
        realm varchar(127),
        password varchar(127),
        primary key (name)
);
</code></pre></div>

<h3 id="_1">启动</h3>
<ul>
<li>
<p>turnserver -h &gt; help.txt</p>
</li>
<li>
<p>refer to https://github.com/coturn/coturn/wiki/</p>
</li>
</ul>
<p>$ cd examples</p>
<p>$ ./scripts/rfc5769.sh</p>
<div class="highlight"><pre><span></span><code>RFC 5769 message fingerprint test(0) result: success
RFC 5769 simple request short-term credentials and integrity test result: success
RFC 5769 NEGATIVE fingerprint test(0) result: success
RFC 5769 message structure, long-term credentials and integrity test result: success
RFC 5769 message encoding test result: success
RFC 5769 NEGATIVE long-term credentials test result: success
RFC 5769 message fingerprint test(1) result: success
RFC 5769 IPv4 response short-term credentials and integrity test result: success
RFC 5769 NEGATIVE fingerprint test(1) result: success
RFC 5769 IPv4 encoding result: success
RFC 5769 message fingerprint test(2) result: success
RFC 5769 IPv6 response short-term credentials and integrity test result: success
RFC 5769 NEGATIVE fingerprint test(2) result: success
RFC 5769 IPv6 encoding result: success
</code></pre></div>

<p>$ more /usr/local/etc/turnserver.conf.default</p>
<p>$ turnadmin -a -u walter -p **** -r fanyamin.com</p>
<p>$ cp /usr/local/etc/turnserver.conf.default /usr/local/etc/turnserver.conf</p>
<p>$ vi /usr/local/etc/turnserver.conf</p>
<div class="highlight"><pre><span></span><code>listening-port=3478 #监听端口
listening-device=eth0 #监听的网卡
external-ip=xx.xx.xxx.xx #公网ip
user=walter:**** #用户名:密码
realm=fanyamin.com #一般与turnadmin创建用户时指定的realm一致
</code></pre></div>

<ul>
<li>refer to https://www.cnblogs.com/yjmyzz/p/how-to-install-coturn-on-ubuntu.html</li>
</ul>
<p>$ turnserver -o -a -f -v -r fanyamin.com</p>
<div class="highlight"><pre><span></span><code>0: log file opened: /var/log/turn_6425_2020-11-15.log
0: Config file found: /usr/local/etc/turnserver.conf
0:
RFC 3489/5389/5766/5780/6062/6156 STUN/TURN Server
Version Coturn-4.5.1.3 &#39;dan Eider&#39;
0:
Max number of open files/sockets allowed for this process: 65535
0:
Due to the open files/sockets limitation,
max supported number of TURN Sessions possible is: 32500 (approximately)
0:
</code></pre></div>

<h3 id="testing">Testing</h3>
<p>As https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/</p>
<p>turn:xx.xx.xx.xx:3478
Walter/***</p>
<ul>
<li>refer to https://github.com/webrtc/samples/blob/gh-pages/src/content/peerconnection/trickle-ice/js/main.js</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/journal.html">journal</a>
      <a href="./tag/blog.html">blog</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./ge-ming-ren-yong-yuan-shi-nian-qing.html" title="革命人永远是年轻">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./journal-on-2021-05-07.html" title="Journal on 2021-05-07">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./xiao-chu-suo-shi.html">消除琐事</a></li>
      <li><a href="./shi-yao-shi-pkce.html">什么是 PKCE</a></li>
      <li><a href="./open-source-community-maturity.html">open source community maturity</a></li>
      <li><a href="./mop-yu-qing-dan-ge-ming.html">MoP 与清单革命</a></li>
      <li><a href="./yong-di-yi-xing-yuan-li-zuo-hao-zi-ji.html">用第一性原理做好自己</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>  <script>
    window.loadStorkIndex = function () {
      stork.initialize("./theme/stork/stork.wasm")
      stork.register("sitesearch", "./search-index.st", { showProgress: false });
    }
  </script>
  <script src="./theme/stork/stork.js"></script>

</body>
</html>