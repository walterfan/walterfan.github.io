
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="Daily minute" />
<meta name="keywords" content="journal, blog">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="Nacos and its C++ SDK"/>
  <meta property="og:description" content="Daily minute"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./nacos-and-its-c-sdk.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2025-03-29 10:20:00+08:00"/>
  <meta property="article:modified_time" content="2025-03-29 19:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="journal"/>
  <meta property="article:tag" content="blog"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; Nacos and its C++ SDK</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="tao.html" >tao</a>
          </li>
          <li>
            <a target="_self" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_self" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_self" href="https://github.com/walterfan" >github</a>
          </li>
          <li>
            <a target="_self" href="https://www.jianshu.com/u/e0b365801f48" >技术文章</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="nacos-and-its-c-sdk">Nacos and its C++ SDK</h1>
    <p>
      Posted on Sat 29 March 2025 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <table>
<thead>
<tr>
<th><strong>Abstract</strong></th>
<th>Nacos and its C++ SDK</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authors</strong></td>
<td><a href="https://www.fanyamin.com">Walter Fan</a></td>
</tr>
<tr>
<td> <strong>Category</strong>  </td>
<td> learning note  </td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>v1.0</td>
</tr>
<tr>
<td><strong>Updated</strong></td>
<td>2025-03-29</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://creativecommons.org/licenses/by-nc-nd/4.0">CC-BY-NC-ND 4.0</a></td>
</tr>
</tbody>
</table>
<h1 id="2025-03-29">2025-03-29</h1>
<h1 id="nacos">Nacos 简介与使用指南</h1>
<h2 id="nacos_1">什么是 Nacos</h2>
<p>Nacos（全称：Dynamic Naming and Configuration Service）是阿里巴巴开源的一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。Nacos 的主要功能包括：</p>
<ol>
<li><strong>服务发现与服务健康监测</strong>：动态注册和发现服务实例，以及对服务实例健康状态的检测</li>
<li><strong>动态配置管理</strong>：集中管理配置，实时推送配置变更</li>
<li><strong>动态 DNS 服务</strong>：提供权重路由等功能</li>
<li><strong>服务及其元数据管理</strong>：管理服务的静态元数据</li>
</ol>
<h2 id="nacos_2">如何使用 Nacos</h2>
<h3 id="1-nacos">1. 安装与启动 Nacos 服务器</h3>
<p><strong>下载与安装</strong>：</p>
<div class="highlight"><pre><span></span><span class="c1"># 下载最新稳定版</span>
wget<span class="w"> </span>https://github.com/alibaba/nacos/releases/download/2.2.0/nacos-server-2.2.0.tar.gz
<span class="c1"># 解压</span>
tar<span class="w"> </span>-xvf<span class="w"> </span>nacos-server-2.2.0.tar.gz
<span class="nb">cd</span><span class="w"> </span>nacos
</pre></div>


<p><strong>启动服务</strong>：</p>
<div class="highlight"><pre><span></span><span class="c1"># 单机模式启动</span>
sh<span class="w"> </span>startup.sh<span class="w"> </span>-m<span class="w"> </span>standalone
</pre></div>


<p>或者</p>
<div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nacos-group/nacos-docker.git
<span class="nb">cd</span><span class="w"> </span>nacos-docker
<span class="w"> </span>docker-compose<span class="w"> </span>-f<span class="w"> </span>example/standalone-derby.yaml<span class="w"> </span>up<span class="w"> </span>-d
</pre></div>


<h3 id="2">2. 访问管理控制台</h3>
<p>启动成功后，可以通过浏览器访问 Nacos 控制台：</p>
<div class="highlight"><pre><span></span>http://localhost:8848/nacos
</pre></div>


<p>默认用户名和密码均为：nacos</p>
<h3 id="3">3. 基本操作</h3>
<p><strong>配置管理</strong>：
- 在控制台可以创建配置命名空间
- 添加、修改和删除配置项
- 导入导出配置</p>
<p><strong>服务管理</strong>：
- 注册服务实例
- 查询服务实例
- 设置服务健康状态</p>
<h2 id="nacos-c-sdk">使用 Nacos C++ SDK</h2>
<p>Nacos 提供了 C++ SDK 用于与 Nacos 服务器进行通信。下面是如何使用 Nacos C++ SDK 与 Nacos 服务器通信并管理配置的基本步骤。</p>
<h3 id="1-nacos-c-sdk">1. 安装 Nacos C++ SDK</h3>
<p>首先，需要安装 Nacos C++ SDK：</p>
<div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nacos-group/nacos-sdk-cpp.git
<span class="nb">cd</span><span class="w"> </span>nacos-sdk-cpp

<span class="c1"># 创建构建目录</span>
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build

<span class="c1"># 配置并构建SDK</span>
cmake<span class="w"> </span>..
make
make<span class="w"> </span>install
</pre></div>


<h3 id="2-nacos">2. 初始化 Nacos 客户端</h3>
<p>下面是使用 C++ SDK 初始化 Nacos 客户端的示例：</p>
<div class="highlight"><pre><span></span><span class="c1">//nacos_test_1.cpp</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Nacos.h&quot;</span>

<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">nacos</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<span class="w">    </span><span class="n">props</span><span class="p">[</span><span class="n">PropertyKeyConst</span><span class="o">::</span><span class="n">SERVER_ADDR</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;10.100.212.8:8848&quot;</span><span class="p">;</span><span class="c1">//Server address</span>
<span class="w">    </span><span class="n">INacosServiceFactory</span><span class="w"> </span><span class="o">*</span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NacosFactoryFactory</span><span class="o">::</span><span class="n">getNacosFactory</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<span class="w">    </span><span class="n">ResourceGuard</span><span class="w"> </span><span class="o">&lt;</span><span class="n">INacosServiceFactory</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_guardFactory</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="w">    </span><span class="n">ConfigService</span><span class="w"> </span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">CreateConfigService</span><span class="p">();</span>
<span class="w">    </span><span class="n">ResourceGuard</span><span class="w"> </span><span class="o">&lt;</span><span class="n">ConfigService</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_serviceFactory</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="w">    </span><span class="n">NacosString</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">-&gt;</span><span class="n">getConfig</span><span class="p">(</span><span class="s">&quot;k&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">NULLSTR</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<span class="w">             </span><span class="s">&quot;Request failed with curl code:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">errorcode</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<span class="w">             </span><span class="s">&quot;Reason:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>编译步骤:</p>
<div class="highlight"><pre><span></span>g++<span class="w"> </span>-I/usr/local/include/nacos/<span class="w"> </span>test/nacos_test_1.cpp<span class="w"> </span>-lcurl<span class="w"> </span>-lz<span class="w"> </span>-L.<span class="w"> </span>-lnacos-cli-static<span class="w"> </span>-o<span class="w"> </span>nacos_test_1
</pre></div>


<h3 id="3_1">3. 获取配置</h3>
<div class="highlight"><pre><span></span><span class="c1">// 获取配置</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 参数：dataId, group</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">getConfig</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;获取配置成功，内容：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;获取配置失败，异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="4">4. 发布配置</h3>
<div class="highlight"><pre><span></span><span class="c1">// 发布配置</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 参数：dataId, group, content</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isPublishOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">publishConfig</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;config content&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isPublishOk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;发布配置成功&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;发布配置失败&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;发布配置异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="5">5. 删除配置</h3>
<div class="highlight"><pre><span></span><span class="c1">// 删除配置</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 参数：dataId, group</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isRemoveOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">removeConfig</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isRemoveOk</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;删除配置成功&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;删除配置失败&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;删除配置异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="6">6. 监听配置变化</h3>
<div class="highlight"><pre><span></span><span class="c1">// 定义监听器类</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyConfigListener</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Listener</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">receiveConfigInfo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">NacosString</span><span class="w"> </span><span class="o">&amp;</span><span class="n">configInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;收到配置变更通知：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">configInfo</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// 添加监听器</span>
<span class="n">MyConfigListener</span><span class="w"> </span><span class="o">*</span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyConfigListener</span><span class="p">();</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">addListener</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;添加配置监听器成功&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;添加配置监听器失败，异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ... 程序运行一段时间后 ...</span>

<span class="c1">// 移除监听器</span>
<span class="n">configService</span><span class="o">-&gt;</span><span class="n">removeListener</span><span class="p">(</span><span class="s">&quot;example&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">);</span>
<span class="k">delete</span><span class="w"> </span><span class="n">listener</span><span class="p">;</span>
</pre></div>


<h3 id="7">7. 完整示例</h3>
<p>下面是一个完整的使用 Nacos C++ SDK 进行配置管理的示例：</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span><span class="c1"> // for sleep()</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Nacos.h&quot;</span>


<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">nacos</span><span class="p">;</span>

<span class="c1">// 定义配置变更监听器</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MyConfigListener</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Listener</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">receiveConfigInfo</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">NacosString</span><span class="w"> </span><span class="o">&amp;</span><span class="n">configInfo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;收到配置变更通知：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">configInfo</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化属性</span>
<span class="w">    </span><span class="n">Properties</span><span class="w"> </span><span class="n">props</span><span class="p">;</span>
<span class="w">    </span><span class="n">props</span><span class="p">[</span><span class="n">PropertyKeyConst</span><span class="o">::</span><span class="n">SERVER_ADDR</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;10.100.212.8:8848&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">props</span><span class="p">[</span><span class="n">PropertyKeyConst</span><span class="o">::</span><span class="n">NAMESPACE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="n">INacosServiceFactory</span><span class="w"> </span><span class="o">*</span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NacosFactoryFactory</span><span class="o">::</span><span class="n">getNacosFactory</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
<span class="w">    </span><span class="n">ResourceGuard</span><span class="w"> </span><span class="o">&lt;</span><span class="n">INacosServiceFactory</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_guardFactory</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 创建配置服务</span>
<span class="w">    </span><span class="n">ConfigService</span><span class="w"> </span><span class="o">*</span><span class="n">configService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">configService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factory</span><span class="o">-&gt;</span><span class="n">CreateConfigService</span><span class="p">();</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;初始化 Nacos 配置服务成功&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;初始化 Nacos 配置服务失败，异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 定义配置ID和组</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">dataId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;example&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DEFAULT_GROUP&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 发布配置</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;initial config content&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">isPublishOk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">publishConfig</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">);</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;发布配置&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">isPublishOk</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;成功&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;失败&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;发布配置异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 获取配置</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">string</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">getConfig</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="mi">5000</span><span class="p">);</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;获取配置成功，内容：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;获取配置失败，异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 添加配置监听</span>
<span class="w">    </span><span class="n">MyConfigListener</span><span class="w"> </span><span class="o">*</span><span class="n">listener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyConfigListener</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">addListener</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">);</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;添加配置监听器成功&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 修改配置触发监听</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 等待一秒</span>
<span class="w">        </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">publishConfig</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updated config content&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 等待接收配置变更</span>
<span class="w">        </span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;配置监听异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 移除监听器并删除配置</span>
<span class="w">    </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">removeListener</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">listener</span><span class="p">);</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">listener</span><span class="p">;</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">isRemoved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configService</span><span class="o">-&gt;</span><span class="n">removeConfig</span><span class="p">(</span><span class="n">dataId</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">);</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;删除配置&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">isRemoved</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;成功&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;失败&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NacosException</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;删除配置异常：&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 释放资源</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">configService</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>编译步骤</p>
<div class="highlight"><pre><span></span>g++<span class="w"> </span>-I/usr/local/include/nacos/<span class="w"> </span>test/nacos_test_2.cpp<span class="w"> </span>-lcurl<span class="w"> </span>-lz<span class="w"> </span>-L.<span class="w"> </span>-lnacos-cli-static<span class="w"> </span>-o<span class="w"> </span>nacos_test_2
</pre></div>


<h2 id="_1">总结</h2>
<p>Nacos 是一个强大的服务发现和配置管理平台，通过 C++ SDK，您可以轻松地将 Nacos 集成到 C++ 应用程序中。使用 Nacos C++ SDK，您可以执行以下操作：</p>
<ol>
<li>获取、发布和删除配置</li>
<li>监听配置变更</li>
<li>服务注册与发现</li>
</ol>
<p>在实际应用中，Nacos 可以帮助您实现配置的集中管理和动态更新，简化分布式系统的配置管理复杂度。</p>
<p><hr/>
本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/journal.html">journal</a>
      <a href="./tag/blog.html">blog</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./pao-zai-shui-li-cai-neng-xue-hui-you-yong-qian-duan-kai-fa-xue-xi-zhi-lu.html" title="泡在水里才能学会游泳 - 前端开发学习之路">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./xian-tian-biao-dan-huan-shi-xian-liao-hui-er-tian.html" title="先填表单还是先聊会儿天">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./ru-he-ying-dui-yi-tuan-luan-ma.html">如何应对一团乱码</a></li>
      <li><a href="./wo-he-ni-wo-yu-da-mo-xing.html">我和你 - 我与大模型</a></li>
      <li><a href="./an-quan-xu-yao-ge-chi-ge-chi-cai-neng-an-quan.html">安全需要隔离, 隔离才能安全</a></li>
      <li><a href="./ji-bu-de-na-yao-duo-jiu-ya-suo-yi-xia-ba.html">记不得那么多就压缩一下吧</a></li>
      <li><a href="./go-wei-fu-wu-fang-wen-kong-zhi-zhi-casbin-shi-jian-zhi-nan.html">Go 微服务访问控制之 Casbin 实践指南</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>