
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">




    <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="./images/favicon.ico" type="image/x-icon">

  


 

<meta name="author" content="Walter Fan" />
<meta name="description" content="Daily minute" />
<meta name="keywords" content="journal, blog">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="YAML and Mindmap"/>
  <meta property="og:description" content="Daily minute"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./yaml-and-mindmap.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2020-07-26 10:20:00+08:00"/>
  <meta property="article:modified_time" content="2020-07-26 19:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="journal"/>
  <meta property="article:tag" content="blog"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; YAML and Mindmap</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="./">
        <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
      </a>

      <h1>
        <a href="./">Walter Fan</a>
      </h1>

<p>手握灵珠常奋笔, 心开天籁不吹箫</p>

      <nav>
        <ul class="list">



            <li>
              <a target="_self" href="tao.html" >tao</a>
            </li>
            <li>
              <a target="_self" href="interest.html" >interest</a>
            </li>
            <li>
              <a target="_self" href="/wordpress" >notebook</a>
            </li>
            <li>
              <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
            </li>
            <li>
              <a target="_self" href="https://github.com/walterfan" >github</a>
            </li>
            <li>
              <a target="_self" href="https://www.jianshu.com/u/e0b365801f48" >jianshu</a>
            </li>
            <li>
              <a target="_self" href="about.html" >about</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="http://github.com/walterfan" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="yaml-and-mindmap">YAML and Mindmap</h1>
    <p>
      Posted on Sun 26 July 2020 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <p>最近在读一本书 “Think Stats”, 中文名为“统计思维 - 程序员数学之概率统计”。
这本书写得挺有意思，简单易读，而且还是一本统计方面的词典。这不，写了一点笔记</p>
<ul>
<li>statistic.yaml</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="n">outline</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="err">探索性数据分析</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">2.</span><span class="w"> </span><span class="err">分布</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">3.</span><span class="w"> </span><span class="err">概率质量函数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">4.</span><span class="w"> </span><span class="err">累积分布函数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">5.</span><span class="w"> </span><span class="err">分布建模</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">6.</span><span class="w"> </span><span class="err">概率密度函数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">7.</span><span class="w"> </span><span class="err">变量之间的关系</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">8.</span><span class="w"> </span><span class="err">估计</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">9.</span><span class="w"> </span><span class="err">假设检验</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">10.</span><span class="w"> </span><span class="err">线性最小二乘法</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">11.</span><span class="w"> </span><span class="err">回归</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">12.</span><span class="w"> </span><span class="err">时间序列分析</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">13.</span><span class="w"> </span><span class="err">生存分析</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="mf">14.</span><span class="w"> </span><span class="err">分析方法</span><span class="w"></span>
<span class="n">glossary</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">PMF</span><span class="p">:</span><span class="w"> </span><span class="n">Probability</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Function</span><span class="w"> </span><span class="err">概率质量函数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">distribution</span><span class="p">:</span><span class="w"> </span><span class="err">分布</span><span class="p">,</span><span class="err">样本中的值以及每个值出现的频数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">histogram</span><span class="p">:</span><span class="w"> </span><span class="err">直方图</span><span class="p">,</span><span class="w"> </span><span class="err">从值到频数的映射，或者展示这一映射的图形</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">frequency</span><span class="p">:</span><span class="w"> </span><span class="err">频数</span><span class="p">,</span><span class="err">一个值在样本中出现的次数</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">mode</span><span class="p">:</span><span class="w"> </span><span class="err">众数，一个样本中最常出现的值，或者最常出现的值之一</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">normal</span><span class="p">:</span><span class="w"> </span><span class="n">distribution</span><span class="w"> </span><span class="err">正态分布，钟形的理想化分布，也称为高斯分布</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">uniform</span><span class="p">:</span><span class="w"> </span><span class="n">distribution</span><span class="w"> </span><span class="err">均匀分布，所有值具有相同频数的分布</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">tail</span><span class="p">:</span><span class="w"> </span><span class="err">尾部</span><span class="p">,</span><span class="w"> </span><span class="err">一个分布中最高端</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">centrial</span><span class="w"> </span><span class="n">tendency</span><span class="p">:</span><span class="w"> </span><span class="err">集中趋势，样本或总体的一个特征，直观上，这一个特征是一个平均值或典型值</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">outlier</span><span class="p">:</span><span class="w"> </span><span class="err">离群值：远离集中趋势的值</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">spread</span><span class="p">:</span><span class="w"> </span><span class="err">散布，对值在分布中扩展规模的度量</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">variance</span><span class="p">:</span><span class="w"> </span><span class="err">方差，用于量化散布</span><span class="w"> </span><span class="o">$$</span><span class="w">  </span><span class="n">S</span><span class="o">^</span><span class="mi">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>\<span class="n">frac</span><span class="p">{</span><span class="mi">1</span><span class="p">}{</span><span class="n">n</span><span class="p">}</span><span class="w"> </span>\<span class="n">sum_</span><span class="p">{</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">}</span><span class="o">^</span><span class="n">n</span><span class="p">(</span><span class="n">x_i</span><span class="o">-</span>\<span class="n">overline</span><span class="p">{</span><span class="n">x</span><span class="p">})</span><span class="w"> </span><span class="o">$$</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">deviation</span><span class="p">:</span><span class="w"> </span><span class="err">标准差，方差的的平方根，用于量化散布</span><span class="w"></span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">effect</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="err">效应量，用于量化一个效应的大小，如群组之间的差异</span><span class="w">  </span>
</code></pre></div>

<p>还想画一个思维导图，也不想找什么思维导图软件再画了，索性写一个 Python 脚本， 根据 yaml 文件自动生成一个思维导图。</p>
<ul>
<li>用法</li>
</ul>
<div class="highlight"><pre><span></span><code>$ python portal/util/yamlmm.py -n statistic -s ./mindmap/statistic.yaml -t ./mindmap/statistic.png

$ open ./mindmap/statistic.png
</code></pre></div>

<p>生成的图片如下</p>
<p><img alt="" src="./images/statistic.png"></p>
<p>Python 源代码如下</p>
<div class="highlight"><pre><span></span><code><span class="s s-Atom">from</span> <span class="s s-Atom">jinja2</span> <span class="s s-Atom">import</span> <span class="nv">Template</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">sys</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">re</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">os</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">yaml</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">re</span>
<span class="s s-Atom">import</span> <span class="s s-Atom">argparse</span>
<span class="s s-Atom">from</span> <span class="s s-Atom">graphviz</span> <span class="s s-Atom">import</span> <span class="nv">Source</span>
<span class="s s-Atom">from</span> <span class="s s-Atom">loguru</span> <span class="s s-Atom">import</span> <span class="s s-Atom">logger</span>

<span class="s s-Atom">logger</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">sys</span><span class="p">.</span><span class="s s-Atom">stdout</span><span class="p">,</span>
           <span class="s s-Atom">format=</span><span class="s2">&quot;{time} {message}&quot;</span><span class="p">,</span>
           <span class="s s-Atom">filter=</span><span class="s2">&quot;client&quot;</span><span class="p">,</span>
           <span class="s s-Atom">level=</span><span class="s2">&quot;INFO&quot;</span><span class="p">)</span>


<span class="nv">GRAPH_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">graph {</span>
<span class="s2">    #label=&quot;</span><span class="p">{{</span> <span class="s s-Atom">diagram_name</span> <span class="p">}}</span><span class="s2">&quot;;</span>
<span class="s2">    labelloc=t;</span>
<span class="s2">    rankdir=LR;</span>
<span class="s2">    node [shape=box style=filled, color=lightgrey];</span>

<span class="s2">    {{ diagram_desc }}</span>
<span class="s2">    {{ diagram_content }}</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>



<span class="s s-Atom">def</span> <span class="nf">node_set_desc</span><span class="p">(</span><span class="s s-Atom">node_set</span><span class="p">,</span> <span class="s s-Atom">is_sorted</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span><span class="s s-Atom">:</span>
    <span class="s s-Atom">node_desc_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="s s-Atom">for</span> <span class="s s-Atom">node</span> <span class="s s-Atom">in</span> <span class="s s-Atom">node_set:</span>
        <span class="s s-Atom">node_name</span> <span class="o">=</span> <span class="s s-Atom">node</span><span class="p">.</span><span class="nf">get_unique_name</span><span class="p">()</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">node</span><span class="p">.</span><span class="nn">value</span><span class="p">:</span>
            <span class="s s-Atom">node_attr</span> <span class="o">=</span>  <span class="s2">&quot;label=\&quot;{}: {}\&quot;&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">node</span><span class="p">.</span><span class="s s-Atom">value</span><span class="p">)</span>
        <span class="nn">else</span><span class="p">:</span>
            <span class="s s-Atom">node_attr</span> <span class="o">=</span> <span class="s2">&quot;label=\&quot;{}\&quot;&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">)</span>

        <span class="s s-Atom">node_desc_list</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">&#39;\t{}[{}];&#39;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">node_name</span><span class="p">,</span> <span class="s s-Atom">node_attr</span><span class="p">))</span>
    <span class="s s-Atom">if</span> <span class="s s-Atom">is_sorted:</span>
        <span class="s s-Atom">node_desc_list</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span><span class="s s-Atom">node_desc_list</span><span class="p">)</span>
    <span class="s s-Atom">return</span> <span class="s s-Atom">&#39;\n&#39;</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s s-Atom">node_desc_list</span><span class="p">)</span>

<span class="s s-Atom">class</span> <span class="nv">TreeNode</span><span class="s s-Atom">:</span>
    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">init__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">key=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="o">=</span><span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">parent</span><span class="o">=</span><span class="nv">None</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">name</span> <span class="o">=</span> <span class="s s-Atom">key</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">value</span> <span class="o">=</span> <span class="s s-Atom">val</span>
        <span class="s s-Atom">#</span> <span class="s s-Atom">list</span> <span class="s s-Atom">of</span> <span class="nv">TreeNode</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">parent</span> <span class="o">=</span> <span class="s s-Atom">parent</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">children</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="s s-Atom">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">node</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">children</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">name</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s s-Atom">r&#39;[\. -]&#39;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">set_parent</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">parent</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">parent</span> <span class="o">=</span> <span class="s s-Atom">parent</span>

    <span class="s s-Atom">def</span> <span class="nf">get_unique_name</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nn">parent</span><span class="p">:</span>
            <span class="s s-Atom">valid_name</span> <span class="o">=</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s s-Atom">r&#39;[\. -]&#39;</span><span class="p">,</span><span class="s s-Atom">&#39;_&#39;</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">)</span>
            <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">parent</span><span class="p">.</span><span class="nf">get_unique_name</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="s s-Atom">valid_name</span>
        <span class="nn">else</span><span class="p">:</span>
            <span class="s s-Atom">return</span> <span class="s s-Atom">re</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s s-Atom">r&#39;[\. -]&#39;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">repr__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">return</span> <span class="s2">&quot;{}[lable=\&quot;{}\&quot;], {}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="nf">get_unique_name</span><span class="p">(),</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">value</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">children</span><span class="p">.</span><span class="k">__</span><span class="nf">len__</span><span class="p">())</span>

<span class="s s-Atom">class</span> <span class="nv">YamlMindmap</span><span class="s s-Atom">:</span>
    <span class="s s-Atom">def</span> <span class="k">__</span><span class="nf">init__</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">file</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">path=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">yaml_file</span> <span class="o">=</span> <span class="s s-Atom">file</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_name</span> <span class="o">=</span> <span class="s s-Atom">name</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_path</span> <span class="o">=</span> <span class="s s-Atom">path</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">root_node</span> <span class="o">=</span> <span class="nv">None</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">node_set</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">sequence_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="s s-Atom">def</span> <span class="nf">load_yaml_doc</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">with</span> <span class="nf">open</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">yaml_file</span><span class="p">,</span> <span class="s s-Atom">&#39;r&#39;</span><span class="p">,</span> <span class="s s-Atom">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="nn">fp</span><span class="p">:</span>
            <span class="s s-Atom">doc</span> <span class="o">=</span> <span class="s s-Atom">yaml</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="s s-Atom">fp</span><span class="p">,</span> <span class="nv">Loader</span><span class="o">=</span><span class="s s-Atom">yaml</span><span class="p">.</span><span class="nv">FullLoader</span><span class="p">)</span>
            <span class="s s-Atom">return</span> <span class="s s-Atom">doc</span>

    <span class="s s-Atom">def</span> <span class="nf">load_yaml_docs</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">yaml_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="s s-Atom">with</span> <span class="nf">open</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">yaml_file</span><span class="p">,</span> <span class="s s-Atom">&#39;r&#39;</span><span class="p">,</span> <span class="s s-Atom">encoding=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="s s-Atom">as</span> <span class="nn">fp</span><span class="p">:</span>
            <span class="s s-Atom">docs</span> <span class="o">=</span> <span class="s s-Atom">yaml</span><span class="p">.</span><span class="nf">load_all</span><span class="p">(</span><span class="s s-Atom">fp</span><span class="p">,</span> <span class="nv">Loader</span><span class="o">=</span><span class="s s-Atom">yaml</span><span class="p">.</span><span class="nv">FullLoader</span><span class="p">)</span>
            <span class="s s-Atom">for</span> <span class="s s-Atom">doc</span> <span class="s s-Atom">in</span> <span class="nn">docs</span><span class="p">:</span>
                <span class="s s-Atom">yaml_objs</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s s-Atom">doc</span><span class="p">)</span>
        <span class="s s-Atom">return</span> <span class="s s-Atom">yaml_objs</span>

    <span class="s s-Atom">def</span> <span class="nf">add_sequence</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">fromNode</span><span class="p">,</span> <span class="s s-Atom">toNode</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">sequence_list</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="s2">&quot;{} -- {}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">fromNode</span><span class="p">.</span><span class="nf">get_unique_name</span><span class="p">(),</span> <span class="s s-Atom">toNode</span><span class="p">.</span><span class="nf">get_unique_name</span><span class="p">())))</span>

    <span class="s s-Atom">def</span> <span class="nf">dot_to_png</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">dot_content</span><span class="p">,</span> <span class="s s-Atom">png_file</span><span class="p">,</span> <span class="s s-Atom">**kwargs</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s2">&quot;dot_to_png from {} to {}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">dot_content</span><span class="p">,</span> <span class="s s-Atom">png_file</span><span class="p">))</span>
        <span class="s s-Atom">basename</span> <span class="o">=</span> <span class="s s-Atom">png_file</span><span class="p">[:-</span><span class="mi">4</span><span class="p">]</span>

        <span class="s s-Atom">src</span> <span class="o">=</span> <span class="nv">Source</span><span class="p">(</span><span class="s s-Atom">dot_content</span><span class="p">)</span>
        <span class="s s-Atom">file_path</span> <span class="o">=</span> <span class="s s-Atom">src</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="s s-Atom">filename</span><span class="o">=</span><span class="s s-Atom">basename</span><span class="p">,</span> <span class="s s-Atom">format=&#39;png&#39;</span><span class="p">,</span> <span class="s s-Atom">cleanup</span><span class="o">=</span><span class="nv">True</span><span class="p">)</span>
        <span class="s s-Atom">return</span> <span class="s s-Atom">os</span><span class="p">.</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="s s-Atom">file_path</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">parse_dict</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">dict_obj</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">for</span> <span class="s s-Atom">key</span><span class="p">,</span> <span class="s s-Atom">val</span> <span class="s s-Atom">in</span> <span class="s s-Atom">dict_obj</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s2">&quot;{} -- {}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">key</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="p">))</span>
            <span class="s s-Atom">node</span> <span class="o">=</span> <span class="nv">TreeNode</span><span class="p">(</span><span class="s s-Atom">key</span><span class="p">,</span> <span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">parent_node</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">str</span><span class="p">)</span> <span class="s s-Atom">or</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">int</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">node</span><span class="p">.</span><span class="s s-Atom">value</span> <span class="o">=</span> <span class="s s-Atom">val</span>
            <span class="s s-Atom">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">dict</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_dict</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="p">)</span>
            <span class="s s-Atom">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">list</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_list</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="p">)</span>

            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">node_set</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">)</span>
            <span class="s s-Atom">parent_node</span><span class="p">.</span><span class="nf">add_child</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">)</span>
            <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">add_sequence</span><span class="p">(</span><span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">node</span><span class="p">)</span>



    <span class="s s-Atom">def</span> <span class="nf">parse_list</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">list_obj</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">for</span> <span class="s s-Atom">val</span> <span class="s s-Atom">in</span> <span class="s s-Atom">list_obj:</span>
            <span class="s s-Atom">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">str</span><span class="p">)</span> <span class="s s-Atom">or</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">int</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">node</span> <span class="o">=</span> <span class="nv">TreeNode</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="nv">None</span><span class="p">,</span> <span class="s s-Atom">parent_node</span><span class="p">)</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">node_set</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">)</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">add_sequence</span><span class="p">(</span><span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">node</span><span class="p">)</span>
                <span class="s s-Atom">parent_node</span><span class="p">.</span><span class="nf">add_child</span><span class="p">(</span><span class="s s-Atom">node</span><span class="p">)</span>
            <span class="s s-Atom">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">dict</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_dict</span><span class="p">(</span><span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="p">)</span>
            <span class="s s-Atom">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">val</span><span class="p">,</span> <span class="s s-Atom">list</span><span class="p">)</span><span class="s s-Atom">:</span>
                <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_list</span><span class="p">(</span><span class="s s-Atom">parent_node</span><span class="p">,</span> <span class="s s-Atom">val</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">draw_graphs</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title=</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">yaml_objs</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">load_yaml_docs</span><span class="p">()</span>
        <span class="s s-Atom">for</span> <span class="s s-Atom">yaml_obj</span> <span class="s s-Atom">in</span> <span class="s s-Atom">yaml_objs:</span>
            <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">draw_mindmap</span><span class="p">(</span><span class="s s-Atom">yaml_obj</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">draw_graph</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title=</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>
        <span class="s s-Atom">yaml_obj</span> <span class="o">=</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">load_yaml_doc</span><span class="p">()</span>
        <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">draw_mindmap</span><span class="p">(</span><span class="s s-Atom">yaml_obj</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title</span><span class="p">)</span>

    <span class="s s-Atom">def</span> <span class="nf">draw_mindmap</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">,</span> <span class="s s-Atom">yaml_obj</span><span class="p">,</span> <span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title=</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>

        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">root_node</span> <span class="o">=</span> <span class="nv">TreeNode</span><span class="p">(</span><span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">title</span><span class="p">)</span>
        <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">node_set</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">root_node</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">yaml_obj</span><span class="p">,</span> <span class="s s-Atom">dict</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_dict</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">root_node</span><span class="p">,</span> <span class="s s-Atom">yaml_obj</span><span class="p">)</span>
        <span class="s s-Atom">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="s s-Atom">yaml_obj</span><span class="p">,</span> <span class="s s-Atom">list</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">parse_list</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">root_node</span><span class="p">,</span> <span class="s s-Atom">yaml_obj</span><span class="p">)</span>
        <span class="nn">else</span><span class="p">:</span>
            <span class="s s-Atom">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="s2">&quot;yaml is empty&quot;</span><span class="p">)</span>

        <span class="s s-Atom">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s s-Atom">&#39;diagram_name&#39;:</span> <span class="s s-Atom">title</span> <span class="s s-Atom">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                      <span class="s s-Atom">&#39;diagram_desc&#39;:</span> <span class="nf">node_set_desc</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">node_set</span><span class="p">),</span>
                      <span class="s s-Atom">&#39;diagram_content&#39;:</span> <span class="s s-Atom">&#39;\n&#39;</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">sequence_list</span><span class="p">)}</span>

        <span class="s s-Atom">template</span> <span class="o">=</span> <span class="nv">Template</span><span class="p">(</span><span class="nv">GRAPH_TEMPLATE</span><span class="p">)</span>
        <span class="s s-Atom">dot_content</span> <span class="o">=</span> <span class="s s-Atom">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="s s-Atom">parameters</span><span class="p">)</span>

        <span class="s s-Atom">if</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_name</span> <span class="s s-Atom">and</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_name</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">png_file</span> <span class="o">=</span> <span class="s2">&quot;{}/{}&quot;</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_path</span><span class="p">,</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">diagram_name</span><span class="p">)</span>
            <span class="s s-Atom">return</span> <span class="s s-Atom">self</span><span class="p">.</span><span class="nf">dot_to_png</span><span class="p">(</span><span class="s s-Atom">dot_content</span><span class="p">,</span> <span class="s s-Atom">png_file</span><span class="p">)</span>
        <span class="nn">else</span><span class="p">:</span>
            <span class="s s-Atom">self</span><span class="p">.</span><span class="s s-Atom">content</span> <span class="o">=</span> <span class="s s-Atom">dot_content</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s s-Atom">&#39;\n&#39;</span><span class="p">,</span> <span class="s s-Atom">&#39;&#39;</span><span class="p">)</span>
            <span class="s s-Atom">return</span> <span class="s2">&quot;&quot;</span>

<span class="s s-Atom">def</span> <span class="nf">draw_mindmap</span><span class="p">(</span><span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">yaml_file</span><span class="p">,</span> <span class="s s-Atom">png_file</span><span class="p">)</span><span class="s s-Atom">:</span>
    <span class="s s-Atom">obj</span> <span class="o">=</span> <span class="nv">YamlMindmap</span><span class="p">(</span><span class="s s-Atom">yaml_file</span><span class="p">,</span> <span class="s s-Atom">png_file</span><span class="p">)</span>
    <span class="s s-Atom">obj</span><span class="p">.</span><span class="nf">draw_graphs</span><span class="p">(</span><span class="s s-Atom">name</span><span class="p">)</span>

<span class="s s-Atom">if</span> <span class="k">__</span><span class="s s-Atom">name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="s s-Atom">:</span>

    <span class="s s-Atom">parser</span> <span class="o">=</span> <span class="s s-Atom">argparse</span><span class="p">.</span><span class="nv">ArgumentParser</span><span class="p">()</span>

    <span class="s s-Atom">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="s s-Atom">&#39;-n&#39;</span><span class="p">,</span> <span class="s s-Atom">required</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">action=&#39;store&#39;</span><span class="p">,</span> <span class="s s-Atom">dest=&#39;name&#39;</span><span class="p">,</span> <span class="s s-Atom">help=&#39;specify the mindmap name&#39;</span><span class="p">)</span>
    <span class="s s-Atom">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="s s-Atom">&#39;-s&#39;</span><span class="p">,</span> <span class="s s-Atom">required</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">action=&#39;store&#39;</span><span class="p">,</span> <span class="s s-Atom">dest=&#39;source&#39;</span><span class="p">,</span> <span class="s s-Atom">help=&#39;specify a source yaml file: *.yaml&#39;</span><span class="p">)</span>
    <span class="s s-Atom">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="s s-Atom">&#39;-t&#39;</span><span class="p">,</span> <span class="s s-Atom">required</span><span class="o">=</span><span class="nv">True</span><span class="p">,</span> <span class="s s-Atom">action=&#39;store&#39;</span><span class="p">,</span> <span class="s s-Atom">dest=&#39;target&#39;</span><span class="p">,</span> <span class="s s-Atom">help=&#39;specify a targe mindmap graph file: *.png&#39;</span><span class="p">)</span>

    <span class="s s-Atom">args</span> <span class="o">=</span> <span class="s s-Atom">parser</span><span class="p">.</span><span class="nf">parse_args</span><span class="p">()</span>

    <span class="nf">draw_mindmap</span><span class="p">(</span><span class="s s-Atom">args</span><span class="p">.</span><span class="s s-Atom">name</span><span class="p">,</span> <span class="s s-Atom">args</span><span class="p">.</span><span class="s s-Atom">source</span><span class="p">,</span> <span class="s s-Atom">args</span><span class="p">.</span><span class="s s-Atom">target</span><span class="p">)</span>
</code></pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/journal.html">journal</a>
      <a href="./tag/blog.html">blog</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy; 2010 ~ 2030 Walter Fan</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake -->    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>

</body>
</html>