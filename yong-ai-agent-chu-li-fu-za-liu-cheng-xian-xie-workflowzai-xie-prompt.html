
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="复杂流程不是靠&#34;更长的 Prompt&#34;解决的，而是靠可拆分的 SubAgent、可审计的 A2A 消息契约、可复用的 MCP 工具，以及&#34;先声明后执行&#34;的 workflow 把不确定性关进笼子里。" />
<meta name="keywords" content="ai, agent, workflow, mcp, a2a, prompt-engineering, langgraph">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="用 AI Agent 处理复杂流程：先写 Workflow，再写 Prompt"/>
  <meta property="og:description" content="复杂流程不是靠&#34;更长的 Prompt&#34;解决的，而是靠可拆分的 SubAgent、可审计的 A2A 消息契约、可复用的 MCP 工具，以及&#34;先声明后执行&#34;的 workflow 把不确定性关进笼子里。"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./yong-ai-agent-chu-li-fu-za-liu-cheng-xian-xie-workflowzai-xie-prompt.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2026-02-06 21:00:00+08:00"/>
  <meta property="article:modified_time" content="2026-02-07 22:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="ai"/>
  <meta property="article:tag" content="agent"/>
  <meta property="article:tag" content="workflow"/>
  <meta property="article:tag" content="mcp"/>
  <meta property="article:tag" content="a2a"/>
  <meta property="article:tag" content="prompt-engineering"/>
  <meta property="article:tag" content="langgraph"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; 用 AI Agent 处理复杂流程：先写 Workflow，再写 Prompt</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_blank" href="tao.html" >tao</a>
          </li>
          <li>
            <a target="_blank" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_blank" href="article.html" >article</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_blank" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_blank" href="manual.html" >manual</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_blank" href="https://github.com/walterfan" >github</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="yong-ai-agent-chu-li-fu-za-liu-cheng-xian-xie-workflowzai-xie-prompt">用 AI Agent 处理复杂流程：先写 Workflow，再写 Prompt</h1>
    <p>
      Posted on Fri 06 February 2026 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <table>
<thead>
<tr>
<th><strong>Abstract</strong></th>
<th>用 AI Agent 处理复杂流程：先写 Workflow，再写 Prompt</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authors</strong></td>
<td><a href="https://www.fanyamin.com">Walter Fan</a></td>
</tr>
<tr>
<td><strong>Category</strong></td>
<td>Journal</td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>v1.0</td>
</tr>
<tr>
<td><strong>Updated</strong></td>
<td>2026-02-06</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://creativecommons.org/licenses/by-nc-nd/4.0">CC-BY-NC-ND 4.0</a></td>
</tr>
</tbody>
</table>
<h2 id="_1">短大纲（给忙人）</h2>
<details>
<summary>展开看看</summary>

- **先把问题说清楚**：复杂流程的"复杂"不是步骤多，而是不确定性多（输入乱、分支多、工具杂、回滚难）
- **Super Agent 做三件事**：识别任务 → 分派任务 → 汇总成果（别亲自下场写每一步）
- **Sub Agent 遵循 SRP**：一个 SubAgent 只对一种能力负责，输入/输出可测试、可替换
- **SOLID 全家桶**：SRP 只是开头，OCP/LSP/ISP/DIP 在 Agent 系统里一样管用
- **A2A 通讯用结构化数据**：别靠自然语言"意会"，要有 schema、版本、错误码、可追踪 id
- **Prompt 要做版本管理**：别塞数据库，直接用目录 + Git；可 diff、可 review、可回滚
- **Workflow：先设计，再执行**：把流程当"程序"写出来（DAG/状态机/重试策略），然后让 Agent 去跑
- **MCP：把工具接入标准化**：SubAgent 通过 MCP 用工具，Super Agent 只管调度与权限边界
- **LangGraph 实战 Demo**：用 Supervisor + SubAgent 模式实现一个临床论文写作 Workflow

</details>

<hr>
<h2 id="prompt">开头先扎心：你不是缺 Prompt，你是缺"流程的骨架"</h2>
<p>我见过很多团队上来就"加 Prompt"。流程越复杂，Prompt 越长，最后像一锅粥：谁都能往里加一勺酱油，但没人知道锅里到底是什么味儿。</p>
<p>你想用 AI Agent 处理一个复杂流程，比如：</p>
<ul>
<li>新需求来了：要查历史文档、看代码、跑测试、写变更说明、发通知、顺手再写个 FAQ</li>
<li>安全审计来了：要拉取日志、关联工单、抽取证据、生成报告，还要对"不可披露信息"做脱敏</li>
<li>或者更日常的：写一篇文章，图要渲染、引用要校验、素材要归档、还得保持风格不油腻</li>
</ul>
<p>这些事<strong>不难在"步骤"</strong>，难在"意外"：</p>
<ul>
<li>输入不干净：同一个字段有人叫 <code>repo</code> 有人叫 <code>repository</code>，还夹着半截中文</li>
<li>分支很多：失败后怎么办？要不要重试？重试要不要换策略？</li>
<li>工具一堆：本地脚本、API、MCP server、数据库、Git、CI......每个都有自己的脾气</li>
<li>结果要可审计：出了问题你得能回答"为什么是这个结论""哪一步用的什么依据"</li>
</ul>
<p>所以我现在更倾向一句话：<strong>先写 Workflow，再写 Prompt。</strong></p>
<hr>
<h2 id="1-super-agent-subagent">1) 先把角色分清：Super Agent 与 SubAgent，不是"大模型分身术"</h2>
<p>"Super Agent / SubAgent" 这个分法，很多人觉得只是换了个名字。其实不是——它的核心目的是<strong>把复杂度关进笼子里</strong>。</p>
<h3 id="super-agent">Super Agent：像项目经理，但更像"编排器"</h3>
<p>Super Agent 的核心职责很简单，三件事：</p>
<ul>
<li><strong>识别与拆分任务</strong>：把"做一件大事"拆成"可交付的小事"</li>
<li><strong>分派与编排执行顺序（workflow）</strong>：谁先谁后、并行还是串行、失败怎么兜底</li>
<li><strong>汇总与验收成果</strong>：把 SubAgent 的输出拼成可交付物，并做一致性检查</li>
</ul>
<p>它最重要的能力不是"写得好"，而是"管得住"。</p>
<h3 id="subagentsrp">SubAgent：SRP（单一职责）不是口号，是救命</h3>
<p>SubAgent 我建议强行遵循 SRP：<strong>一个 SubAgent 只负责一个领域能力</strong>。例如：</p>
<ul>
<li><code>ResearchAgent</code>：只负责检索与引用（输出来源、摘要、置信度）</li>
<li><code>CodeAgent</code>：只负责改代码/跑命令（输出 diff、测试结果）</li>
<li><code>DocAgent</code>：只负责把结构化输入写成文档（输出 markdown + 章节结构）</li>
<li><code>DiagramAgent</code>：只负责把 diagram code block 渲染成图片（输出路径 + 校验）</li>
</ul>
<p>好处很现实：</p>
<ul>
<li><strong>可替换</strong>：某个 SubAgent 拉胯就换模型/换实现，不影响整个系统</li>
<li><strong>可测试</strong>：给定输入，输出是否符合 schema？能不能做 golden test？</li>
<li><strong>可控权限</strong>：需要网络的、能写文件的、能访问敏感数据的，权限边界更清晰</li>
</ul>
<h3 id="srpsolid-agent">不只是 SRP：SOLID 五原则在 Agent 系统里全能用</h3>
<p>SRP 只是开胃菜。写过后端服务的人对 SOLID 不会陌生——好消息是，这五条原则搬到 AI Agent 系统里几乎可以直接用。</p>
<p><strong>OCP（开闭原则）：加能力 = 加文件/加节点，不改已有代码</strong></p>
<p>要新增一个工具（比如从 PubMed 扩展到 ClinicalTrials.gov），挂一个新 MCP Server 就行，SubAgent 代码不用动。要更新某个 Agent 的 prompt，改文件、发 PR，其他 Agent 完全无感。要加一个新 SubAgent，在 StateGraph 上加一个节点，已有节点不用碰。</p>
<p><strong>LSP（里氏替换原则）：遵守契约的 Agent 可以随时互换</strong></p>
<p>只要新的 SubAgent 遵守同一套 A2A schema（输入/输出格式一致），就能无感替换。比如把 <code>literature_agent</code> 底层从 GPT-4o-mini 换成 Claude，Supervisor 完全不需要知道——它只关心"给你 topic，你还我 references 列表"。</p>
<p><strong>ISP（接口隔离原则）：给 Agent 最小够用的工具集</strong></p>
<p><code>writer_agent</code> 只有写作工具，不给它搜索工具——它不需要、也不应该自己去搜索。如果你把所有 tools 都塞给一个 Agent，它就容易"跑偏"：本来该写论文的，看到有搜索工具就自己去搜了一轮，产出不可预期。</p>
<p><strong>DIP（依赖倒置原则）：依赖抽象（契约），不依赖具体实现</strong></p>
<p>Supervisor 不依赖"literature_agent 是用 GPT-4o 跑的"这个细节，它只依赖 A2A 消息契约。SubAgent 不依赖"工具是直接调 API 还是走 MCP"，它只依赖 <code>@tool</code> 接口。Workflow 不依赖"用 LangGraph 还是 Temporal"，它只依赖 DAG 定义。</p>
<p>速查表放在这里，方便你对照检查自己的 Agent 系统：</p>
<table>
<thead>
<tr>
<th>原则</th>
<th>Agent 系统中的含义</th>
<th>反面教材</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SRP</strong></td>
<td>一个 SubAgent 只负责一个领域能力</td>
<td>一个 Agent 又搜索又写作又审稿</td>
</tr>
<tr>
<td><strong>OCP</strong></td>
<td>加新能力 = 加文件/加节点</td>
<td>每次加功能都要改 Supervisor 的 prompt</td>
</tr>
<tr>
<td><strong>LSP</strong></td>
<td>遵守 A2A 契约即可互换</td>
<td>换个模型就要改调用方代码</td>
</tr>
<tr>
<td><strong>ISP</strong></td>
<td>每个 Agent 只拿自己需要的 tools</td>
<td>所有 tools 全塞给每个 Agent</td>
</tr>
<tr>
<td><strong>DIP</strong></td>
<td>Agent 之间依赖契约，不依赖实现</td>
<td>Supervisor 里硬编码 SubAgent 的模型名</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="2-a2aagent-to-agent">2) A2A（Agent-to-Agent）通讯：别靠"自然语言默契"，要靠契约</h2>
<p>先对齐一下术语：<strong>A2A 在不同团队里含义不完全一样</strong>。Google 2025 年发布了一个 <a href="https://github.com/google/A2A">Agent2Agent Protocol</a> 开放协议，专门解决跨平台 Agent 互操作的问题。我这篇文章里说的 A2A 更宽泛，泛指"Agent 与 Agent 之间的消息交互"——不管你用 Google 的协议、自研的 schema，还是 LangGraph 的 <code>MessagesState</code>，核心诉求是一样的：<strong>让 Agent 之间的沟通有契约、可追踪、能重试</strong>。</p>
<p>如果你让 SubAgent 用自然语言随便回一句"我做完了"，Super Agent 很快会陷入两种尴尬：</p>
<ul>
<li><strong>要么</strong>不敢用：因为不知道这个结果靠不靠谱、缺不缺字段</li>
<li><strong>要么</strong>瞎用：因为不知道错误在哪、重试该怎么做</li>
</ul>
<p>解决办法很工程化：<strong>结构化消息 + schema + 版本</strong>。</p>
<h3 id="a2a-json">一个能落地的 A2A 消息模板（JSON）</h3>
<p>下面这个模板我自己很常用，你可以按需删减，但别丢掉关键字段（<code>id</code>/<code>correlation_id</code>/<code>status</code>/<code>artifact</code>/<code>error</code>）。</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a2a.v1&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;msg_20260206_000123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;correlation_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run_20260206_210000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;sender&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SuperAgent&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;receiver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ResearchAgent&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;intent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;collect_references&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;topic&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ai agent workflow&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;constraints&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;zh-CN&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;no_bare_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ok&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;references&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Model Context Protocol - Specification&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://modelcontextprotocol.io/specification/latest&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;notes&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MCP 规范入口，包含 lifecycle、tools、resources、prompts 等&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;artifact&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;markdown&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;content/journal/xxx.md&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;error&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;metrics&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;latency_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">812</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tokens_in&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1200</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;tokens_out&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">350</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>你会发现它很"无聊"。但工程上，<strong>无聊就是稳定</strong>。</p>
<h3 id="a2a">A2A 的两个关键习惯</h3>
<ul>
<li><strong>强制输出 schema</strong>：哪怕 SubAgent 内部写得再自由，最终对外输出必须过 schema 校验</li>
<li><strong>对失败分类</strong>：比如 <code>VALIDATION_ERROR</code>（输入不合规）、<code>TOOL_ERROR</code>（工具失败）、<code>TIMEOUT</code>（超时），不同错误的重试策略不一样</li>
</ul>
<hr>
<h2 id="3-prompt-git">3) Prompt 版本管理：别用数据库，用目录 + 文件 + Git</h2>
<p>有人喜欢把 prompt 存数据库，方便后台管理系统在线编辑。我的看法相反——<strong>直接用目录 + 文件 + Git</strong>。原因很朴素：</p>
<ul>
<li><strong>可 diff</strong>：这句改了什么，一眼就能看到</li>
<li><strong>可 review</strong>：PR 上看 Prompt 变更，比在后台管理系统点点点靠谱</li>
<li><strong>可回滚</strong>：线上出事，<code>git revert</code> 可能比你"回忆昨晚改了啥"更快</li>
</ul>
<p>一个我觉得舒服的目录结构如下：</p>
<div class="highlight"><pre><span></span><code>prompts/
  super/
    router.v1.md
    evaluator.v1.md
  agents/
    research/
      system.v1.md
      user_template.v1.md
    coder/
      system.v1.md
      user_template.v1.md
    writer/
      system.v1.md
      outline.v1.md
      draft.v1.md
schemas/
  a2a/
    message.v1.json
workflows/
  blog_write.v1.yaml
  audit_report.v1.yaml
</code></pre></div>

<p>再加一条"反直觉"的小建议：<strong>Prompt 的版本号不要追求语义化得太完美</strong>。
先做到"能回滚、能对比、能定位"，比"v2.3.4"更重要。</p>
<hr>
<h2 id="4-workflow">4) Workflow：先设计（声明式），再执行（命令式）</h2>
<p>"Agent 先写个程序：design workflow，再执行程序 execute workflow"——这个节奏，本质上就是工程界反复验证过的经典套路：</p>
<ul>
<li>Terraform：先写声明，再 apply</li>
<li>CI Pipeline：先写 YAML，再 run</li>
<li>Temporal / Airflow：先定义 DAG，再调度执行</li>
</ul>
<p>Agent workflow 也一样：<strong>先把流程写成"能跑的结构"，再让模型去跑</strong>。</p>
<h3 id="workflowdag">一个最小可用的 workflow（DAG 思路）</h3>
<p>比如写文章这件事，workflow 可以是：</p>
<ul>
<li><code>collect_notes</code>（收集要点）</li>
<li><code>make_outline</code>（生成大纲）</li>
<li><code>draft</code>（写正文）</li>
<li><code>render_diagrams</code>（渲染图）</li>
<li><code>verify_links</code>（检查链接）</li>
<li><code>finalize</code>（补 Summary、License、修改时间）</li>
</ul>
<p>这里给一张结构图，帮助你把职责边界直观看清楚。</p>
<div class="highlight"><pre><span></span><code>@startuml
skinparam componentStyle rectangle
skinparam shadowing false
skinparam rectangleBorderColor #555555

rectangle &quot;Super Agent\n(Orchestrator)&quot; as SA #FFD700
rectangle &quot;Workflow Definition\n(DAG / State Machine)&quot; as WF #FFEEBB

rectangle &quot;SubAgents&quot; as SUB #E8F5E9 {
  rectangle &quot;ResearchAgent\n(SRP: references)&quot; as RA #C8E6C9
  rectangle &quot;CodeAgent\n(SRP: changes/tests)&quot; as CA #C8E6C9
  rectangle &quot;DocAgent\n(SRP: writing)&quot; as DA #C8E6C9
  rectangle &quot;DiagramAgent\n(SRP: render)&quot; as GA #C8E6C9
}

rectangle &quot;A2A Message Contract\n(schema + version)&quot; as A2A #E3F2FD
rectangle &quot;Prompt Repo\n(files + git)&quot; as PR #E3F2FD

rectangle &quot;MCP Servers\n(tools/resources/prompts)&quot; as MCP #F3E5F5
rectangle &quot;Workspace\n(files/artifacts)&quot; as WS #FFF3E0

SA --&gt; WF : design + execute
SA --&gt; A2A : enforce contract
SA --&gt; PR : load prompts
SA --&gt; RA : dispatch tasks
SA --&gt; CA
SA --&gt; DA
SA --&gt; GA

RA --&gt; MCP : search/tools
CA --&gt; MCP : git/build/tools
DA --&gt; PR : templates
GA --&gt; WS : images

MCP --&gt; WS : read/write (scoped)
@enduml
</code></pre></div>

<p><img alt="Super Agent + MCP + Workflow 架构" src="../images/journal_20260206_ai-agent-workflow_architecture.png"></p>
<h3 id="prompt_1">执行层面的关键：重试策略要"写在流程里"，别写在 Prompt 里</h3>
<p>Prompt 里写"如果失败请重试三次"，听起来很美，但它<strong>不可观测</strong>、也<strong>不可审计</strong>。
正确姿势是：把重试、超时、兜底策略写在 workflow 引擎里，让执行层负责。</p>
<hr>
<h2 id="5-mcp-agent">5) MCP：把"工具接入"标准化，别让每个 Agent 都发明一遍轮子</h2>
<p>MCP（Model Context Protocol）我更愿意把它看作：<strong>Agent 连接外部世界的"标准插口"</strong>。</p>
<p>没有 MCP 之前，每个 SubAgent 要用一个外部工具，你得自己写一套"连接 + 鉴权 + 参数序列化 + 错误处理"的胶水代码。5 个 Agent 用 5 个工具，就是 25 种组合，维护起来想哭。</p>
<p>有了 MCP 之后：</p>
<ul>
<li>SubAgent 需要工具，只管调 <code>tool.xxx()</code>，不关心底层怎么连、怎么鉴权</li>
<li>Super Agent 不用关心"调用某个工具要不要先登录、token 放哪"</li>
<li>工具能力以 "MCP Server" 的形式独立部署：文件系统、数据库、PubMed、Git、CI、图渲染......想加就加，想换就换</li>
</ul>
<p>MCP 协议本身很简洁，核心就三类能力：<strong>Tools</strong>（可调用的函数）、<strong>Resources</strong>（可读取的数据源）、<strong>Prompts</strong>（可复用的提示模板）。Agent 通过 JSON-RPC 和 MCP Server 通信，Server 端可以用任何语言实现——Python、TypeScript、Go、Rust 都有官方 SDK。</p>
<p>如果你已经有了一个能用的内部 API 或脚本，把它包装成 MCP Server 通常只需要几十行代码。后面第 8 节的 demo 里有一个具体的例子（<code>mcp_pubmed_search</code>），可以参考。</p>
<p>详细文档和参考实现我放在文末的扩展阅读里。</p>
<hr>
<h2 id="6-a2a">6) 把它们串起来：一段 A2A 序列，看看"复杂流程"怎么被管住</h2>
<p>下面这张序列图不是为了好看，而是为了回答两个问题：</p>
<p>1) <strong>每一步都能定位是谁产出的</strong>
2) <strong>失败后怎么恢复</strong>（重试哪个节点，而不是整锅重来）</p>
<div class="highlight"><pre><span></span><code>@startuml
autonumber
skinparam participantBackgroundColor #FAFAFA
skinparam participantBorderColor #555555
participant &quot;SuperAgent\n(Orchestrator)&quot; as SA #FFD700
participant &quot;ResearchAgent&quot; as RA #C8E6C9
participant &quot;DocAgent&quot; as DA #C8E6C9
participant &quot;DiagramAgent&quot; as GA #C8E6C9
participant &quot;MCP Server&quot; as MCP #F3E5F5
participant &quot;Workspace&quot; as WS #FFF3E0

SA -&gt; RA : A2A(request)\nintent=collect_references\nschema=a2a.v1
RA -&gt; MCP : tool.search(query)
MCP --&gt; RA : results (structured)
RA --&gt; SA : A2A(response)\nreferences[] + confidence

SA -&gt; DA : A2A(request)\nintent=draft_article\ninput=notes+refs
DA --&gt; SA : A2A(response)\nmarkdown_draft

SA -&gt; GA : A2A(request)\nintent=render_diagrams\ninput=code_blocks
GA -&gt; WS : write images
GA --&gt; SA : A2A(response)\nimages[]

SA -&gt; MCP : tool.verify_links(urls)
MCP --&gt; SA : ok / broken[]

SA -&gt; WS : write final markdown
@enduml
</code></pre></div>

<p><img alt="A2A + MCP 的执行序列" src="../images/journal_20260206_ai-agent-workflow_a2a-sequence.png"></p>
<hr>
<h2 id="7">7) 一份"能抄就抄"的落地清单</h2>
<h3 id="7_1">你需要先做的 7 件事（按优先级）</h3>
<ul>
<li><strong>定义 SubAgent 清单</strong>：每个 SubAgent 的 SRP 是什么？输入/输出是什么？</li>
<li><strong>定义 A2A schema</strong>：至少包含 <code>id</code>、<code>correlation_id</code>、<code>status</code>、<code>output</code>、<code>error</code></li>
<li><strong>把 Prompt 放进仓库</strong>：目录结构固定、命名统一、PR 审核机制</li>
<li><strong>写 workflow 文件</strong>：DAG/状态机都行，关键是"可读、可追踪、可重跑"</li>
<li><strong>接入 MCP 工具</strong>：先从最常用的 2-3 个开始（文件、搜索、Git/CI）</li>
<li><strong>加上可观测性</strong>：每个节点的输入/输出摘要、耗时、失败原因（注意脱敏）</li>
<li><strong>设计失败恢复</strong>：节点级重试、人工介入点、回滚策略（别全靠"再跑一次"）</li>
</ul>
<h3 id="_2">两个常见坑（我踩过的那种）</h3>
<ul>
<li>
<p><strong>坑 1：SubAgent 职责漂移</strong>
  今天让它"查资料"，明天又让它"顺便写总结"，最后它变成一个小号 Super Agent。</p>
</li>
<li>
<p><strong>坑 2：把流程控制写进 Prompt</strong>
  Prompt 里越写越多"如果......则......否则......"，最后你得到的是一个不可测试的"语言版状态机"。</p>
</li>
</ul>
<hr>
<h2 id="8-langgraph">8) 动手试一试：用 LangGraph 编排一篇临床医学论文</h2>
<p>前面讲了一堆方法论，你可能已经有点痒了：说得好听，代码呢？</p>
<p>我女儿从事临床医学研究，她写论文时需要用到 AI Agent 来辅助她完成论文的写作。因此，我选择了<strong>临床医学论文写作</strong>作为示例，因为它天然就是"复杂流程"的标本——文献要从 PubMed 捞、统计分析不能瞎编、正文必须 IMRAD（Introduction-Methods-Results-And-Discussion）结构、最后还得过 CONSORT/STROBE 合规审查。少了哪一步，审稿人都会把你稿子打回来。</p>
<p>下面用 <strong>LangGraph</strong> 实现这个多 Agent 工作流，把前面的概念全用上：</p>
<ul>
<li><strong>Super Agent</strong> -&gt; LangGraph 的 <code>supervisor</code> 节点（论文主编，决定下一步该谁干活）</li>
<li><strong>SubAgent（SRP）</strong> -&gt; <code>literature_agent</code>、<code>stats_agent</code>、<code>writer_agent</code>、<code>compliance_agent</code>，各管各的</li>
<li><strong>A2A 结构化通讯</strong> -&gt; LangGraph 的 <code>MessagesState</code>（共享的、有类型的消息列表）</li>
<li><strong>Workflow 先设计再执行</strong> -&gt; 整张 <code>StateGraph</code> 就是声明式的 DAG，<code>compile()</code> 之后才执行</li>
</ul>
<h3 id="workflow">先看一眼这个 workflow 的全貌</h3>
<div class="highlight"><pre><span></span><code>@startuml
skinparam shadowing false
skinparam activityBackgroundColor #f5f5f5
skinparam activityBorderColor #555555

(*) --&gt; &quot;==Supervisor==\n(论文主编)&quot; #FFD700
&quot;==Supervisor==\n(论文主编)&quot; --&gt; &quot;LiteratureAgent\nPubMed 文献检索&quot; #C8E6C9
&quot;LiteratureAgent\nPubMed 文献检索&quot; --&gt; &quot;==Supervisor==\n(论文主编)&quot;

&quot;==Supervisor==\n(论文主编)&quot; --&gt; &quot;StatsAgent\n统计分析&quot; #BBDEFB
&quot;StatsAgent\n统计分析&quot; --&gt; &quot;==Supervisor==\n(论文主编)&quot;

&quot;==Supervisor==\n(论文主编)&quot; --&gt; &quot;WriterAgent\nIMRAD 撰写&quot; #FFE0B2
&quot;WriterAgent\nIMRAD 撰写&quot; --&gt; &quot;==Supervisor==\n(论文主编)&quot;

&quot;==Supervisor==\n(论文主编)&quot; --&gt; &quot;ComplianceAgent\nCONSORT 合规审查&quot; #E1BEE7
&quot;ComplianceAgent\nCONSORT 合规审查&quot; --&gt; &quot;==Supervisor==\n(论文主编)&quot;

&quot;==Supervisor==\n(论文主编)&quot; --&gt; &quot;END\n输出终稿&quot; #F5F5F5
@enduml
</code></pre></div>

<p><img alt="LangGraph 临床论文写作 Workflow" src="../images/journal_20260206_ai-agent-workflow_langgraph-flow.png"></p>
<p>核心思路：<strong>Supervisor 就是"论文通讯作者"</strong> -- 它不亲自写每一节，但它决定"接下来把球传给谁"、"这一轮结果够不够格"，以及"活干完了，投稿"。</p>
<h3 id="_3">完整代码（可直接跑）</h3>
<blockquote>
<p><strong>依赖</strong>：<code>pip install langgraph langchain-core langchain-openai</code>（需要 <code>OPENAI_API_KEY</code> 环境变量）</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">clinical_paper_workflow.py</span>
<span class="sd">用 LangGraph 实现临床医学论文多 Agent 写作工作流</span>

<span class="sd">场景：写一篇 RCT（随机对照试验）论文，比较两种降压药的疗效</span>
<span class="sd">流程：文献检索 -&gt; 统计分析 -&gt; IMRAD 撰写 -&gt; CONSORT 合规审查</span>

<span class="sd">概念映射：</span>
<span class="sd">  Super Agent   -&gt; supervisor（通讯作者 / 论文主编）</span>
<span class="sd">  SubAgent(SRP) -&gt; literature / stats / writer / compliance</span>
<span class="sd">  A2A 通讯      -&gt; MessagesState（结构化消息链）</span>
<span class="sd">  Workflow      -&gt; StateGraph（声明式 DAG）</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.prebuilt</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_react_agent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langgraph.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">START</span><span class="p">,</span> <span class="n">END</span><span class="p">,</span> <span class="n">MessagesState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">langchain_core.tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">tool</span>


<span class="c1"># =========================================================</span>
<span class="c1"># 1. 定义每个 SubAgent 的专属 Tools</span>
<span class="c1"># =========================================================</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">search_pubmed</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search PubMed for clinical research papers.&quot;&quot;&quot;</span>
    <span class="c1"># 真实场景接 NCBI E-utilities API 或 MCP PubMed server</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[PubMed results for &#39;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&#39;, top </span><span class="si">{</span><span class="n">max_results</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;1. PMID:38901234 - &#39;Amlodipine vs Losartan in Stage 2 HTN: &quot;</span>
        <span class="s2">&quot;A 12-month RCT&#39; (Lancet 2025) - N=480, primary: 24h-ABPM</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;2. PMID:38876543 - &#39;Meta-analysis of CCB vs ARB in elderly HTN&#39; &quot;</span>
        <span class="s2">&quot;(BMJ 2024) - 12 RCTs, N=8,320</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;3. PMID:38765432 - &#39;CONSORT 2025 updated checklist for RCTs&#39; &quot;</span>
        <span class="s2">&quot;(Ann Intern Med 2025)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;4. PMID:38654321 - &#39;Renal outcomes in ARB-treated diabetic HTN&#39; &quot;</span>
        <span class="s2">&quot;(NEJM 2024) - N=1,200</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;5. PMID:38543210 - &#39;Adverse events profiling: CCB vs ARB classes&#39; &quot;</span>
        <span class="s2">&quot;(Pharmacotherapy 2025) - systematic review&quot;</span>
    <span class="p">)</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">run_stats_analysis</span><span class="p">(</span><span class="n">design</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">groups</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run statistical analysis on clinical trial data.&quot;&quot;&quot;</span>
    <span class="c1"># 真实场景接 R/Python stats 脚本，或 MCP 数据分析 server</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;[Statistical Report: </span><span class="si">{</span><span class="n">design</span><span class="si">}</span><span class="s2">]</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Groups: </span><span class="si">{</span><span class="n">groups</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Primary endpoint: </span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Results:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Amlodipine group (n=240): mean SBP reduction 18.3 mmHg (SD 6.2)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Losartan group (n=240): mean SBP reduction 16.7 mmHg (SD 5.8)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Between-group diff: 1.6 mmHg (95% CI: 0.5-2.7, p=0.012)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- NNT for target BP (&lt;130/80): 14</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Adverse events: peripheral edema 12.1% vs 3.3% (p&lt;0.001)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Kaplan-Meier 12-month adherence: 82% vs 89% (log-rank p=0.04)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;- Sensitivity analysis (per-protocol): consistent with ITT&quot;</span>
    <span class="p">)</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">write_imrad_section</span><span class="p">(</span><span class="n">section</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write a section of the paper in IMRAD format.&quot;&quot;&quot;</span>
    <span class="c1"># 真实场景用更强的模型 + 领域 prompt 模板</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;introduction&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;## Introduction</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Hypertension affects over 1.28 billion adults worldwide (WHO 2023). &quot;</span>
            <span class="s2">&quot;Current guidelines recommend CCBs and ARBs as first-line agents, &quot;</span>
            <span class="s2">&quot;yet head-to-head RCTs comparing amlodipine and losartan remain scarce...</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(Based on literature: </span><span class="si">{</span><span class="n">data</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">...)&quot;</span>
        <span class="p">),</span>
        <span class="s2">&quot;methods&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;## Methods</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;### Study design</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Prospective, randomized, double-blind, active-controlled trial.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;### Participants</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Adults 40-75 y with stage 2 HTN (SBP 140-179 mmHg). &quot;</span>
            <span class="s2">&quot;Key exclusion: secondary HTN, eGFR &lt;30.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;### Randomization</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;1:1 allocation via computer-generated sequence, &quot;</span>
            <span class="s2">&quot;stratified by diabetes status.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(Stats plan: </span><span class="si">{</span><span class="n">data</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...)&quot;</span>
        <span class="p">),</span>
        <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;## Results</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Figure 1: Kaplan-Meier adherence curves.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Table 1: Baseline characteristics (well-balanced, p&gt;0.05 for all).&quot;</span>
        <span class="p">),</span>
        <span class="s2">&quot;discussion&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="s2">&quot;## Discussion</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Our findings suggest a statistically significant but clinically modest &quot;</span>
            <span class="s2">&quot;advantage of amlodipine over losartan in 24h SBP reduction. &quot;</span>
            <span class="s2">&quot;However, the higher edema rate and lower adherence in the amlodipine &quot;</span>
            <span class="s2">&quot;group warrant individualized treatment decisions...</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(Contextualized with: </span><span class="si">{</span><span class="n">data</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">...)&quot;</span>
        <span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">templates</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">section</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">section</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nd">@tool</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_consort_compliance</span><span class="p">(</span><span class="n">manuscript</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check manuscript against CONSORT 2025 checklist.&quot;&quot;&quot;</span>
    <span class="c1"># 真实场景：逐条比对 CONSORT 25 项 + 流程图</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="s2">&quot;CONSORT 2025 Compliance Report:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [1] Title: identified as randomised trial</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [2] Abstract: structured, includes key numbers</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [3a] Background: scientific rationale stated</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;WARN [6a] Outcomes: secondary endpoints not fully pre-specified</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [7a] Sample size: calculation provided (power=0.80, alpha=0.05)</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [8a] Randomization: sequence generation described</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;WARN [11a] Blinding: assessor blinding not explicitly confirmed</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [13a] Flow diagram: CONSORT flow present</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;PASS [16] Ancillary analyses: sensitivity analysis included</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;FAIL [23] Registration: trial registry number missing</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Score: 22/25 items PASS, 2 WARN, 1 FAIL</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;Action required: add trial registration number (e.g. NCT0xxxxxxx)&quot;</span>
    <span class="p">)</span>


<span class="c1"># =========================================================</span>
<span class="c1"># 2. 定义四个 SubAgent（SRP：一个 Agent 只干一件事）</span>
<span class="c1"># =========================================================</span>

<span class="n">literature_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">search_pubmed</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;你是 LiteratureAgent，只负责在 PubMed 检索相关临床文献。&quot;</span>
        <span class="s2">&quot;输出结构化的参考列表：PMID、标题、期刊、年份、样本量、关键结论。&quot;</span>
        <span class="s2">&quot;不要写论文正文，不要做统计分析。&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;literature_agent&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">stats_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">run_stats_analysis</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;你是 StatsAgent，只负责对临床试验数据做统计分析。&quot;</span>
        <span class="s2">&quot;输出：主要终点结果、p 值、置信区间、效应量、敏感性分析。&quot;</span>
        <span class="s2">&quot;不要写论文正文，不要检索文献。&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;stats_agent&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">writer_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">write_imrad_section</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;你是 WriterAgent，根据文献和统计结果撰写论文。&quot;</span>
        <span class="s2">&quot;严格使用 IMRAD 结构（Introduction, Methods, Results, Discussion）。&quot;</span>
        <span class="s2">&quot;学术语言，客观严谨，引用须标注 PMID。&quot;</span>
        <span class="s2">&quot;不要自己编造数据，只用已有的文献和统计结果。&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;writer_agent&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">compliance_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">check_consort_compliance</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;你是 ComplianceAgent，按 CONSORT 2025 清单审查论文手稿。&quot;</span>
        <span class="s2">&quot;逐条检查并输出：PASS / WARN / FAIL + 具体修改建议。&quot;</span>
        <span class="s2">&quot;不要自己改写论文，只输出审查报告。&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;compliance_agent&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># =========================================================</span>
<span class="c1"># 3. 定义 Supervisor（通讯作者：编排 + 质控）</span>
<span class="c1"># =========================================================</span>

<span class="n">supervisor_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># supervisor 不需要 tools，它靠路由决策</span>
    <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
        <span class="s2">&quot;你是 Supervisor（通讯作者），管理四个 Agent：</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;1. literature_agent - 负责 PubMed 文献检索</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;2. stats_agent - 负责统计分析</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;3. writer_agent - 负责 IMRAD 论文撰写</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;4. compliance_agent - 负责 CONSORT 合规审查</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;标准流程：</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  Step 1: literature_agent 检索相关 RCT 和 meta-analysis</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  Step 2: stats_agent 分析试验数据</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  Step 3: writer_agent 按 IMRAD 撰写各章节</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;  Step 4: compliance_agent 做 CONSORT 合规检查</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;每次只分派一个任务。如果合规审查有 FAIL 项，&quot;</span>
        <span class="s2">&quot;把修改意见转给 writer_agent 修订，然后重新审查。</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;全部 PASS 或仅剩 WARN 后，输出最终结论并结束。&quot;</span>
    <span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;supervisor&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># =========================================================</span>
<span class="c1"># 4. 组装 StateGraph -- 声明式 workflow</span>
<span class="c1"># =========================================================</span>

<span class="n">workflow</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">StateGraph</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
        <span class="n">supervisor_agent</span><span class="p">,</span>
        <span class="n">destinations</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;literature_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;stats_agent&quot;</span><span class="p">,</span>
            <span class="s2">&quot;writer_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;compliance_agent&quot;</span><span class="p">,</span> <span class="n">END</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">literature_agent</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">stats_agent</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">writer_agent</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">compliance_agent</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">START</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>
    <span class="c1"># 每个 SubAgent 完成后回到 supervisor</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;literature_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;stats_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;writer_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;compliance_agent&quot;</span><span class="p">,</span> <span class="s2">&quot;supervisor&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">compile</span><span class="p">()</span>
<span class="p">)</span>


<span class="c1"># =========================================================</span>
<span class="c1"># 5. 执行 -- 一句话触发整个论文写作流程</span>
<span class="c1"># =========================================================</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="p">(</span>
                        <span class="s2">&quot;请帮我写一篇 RCT 论文：比较氨氯地平与氯沙坦&quot;</span>
                        <span class="s2">&quot;治疗 2 期高血压的 12 个月疗效和安全性。&quot;</span>
                        <span class="s2">&quot;样本量 480 例，主要终点为 24 小时动态血压。&quot;</span>
                    <span class="p">),</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]:</span>
        <span class="n">role</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">role</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">content</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_4">几个值得注意的设计细节</h3>
<p><strong>为什么拆成四个 Agent 而不是一个大 Prompt？</strong></p>
<p>你当然可以把"检索 + 统计 + 写作 + 合规"塞进一个 system prompt。但那样一来：改 CONSORT 检查项就得动整个 prompt，牵一发而动全身；<code>stats_agent</code> 想换个更擅长数值推理的模型（比如 o3）？没门，因为和写作共用一个上下文；合规审查 FAIL 了？只能整篇重跑，而不是只让 <code>writer_agent</code> 改那一节。</p>
<p>拆开之后，这些问题都不存在了——每个 Agent 独立演进、独立替换、独立重试。这就是 SRP 在 Agent 场景下的实际收益。</p>
<p><strong>Supervisor 的"循环修订"能力</strong></p>
<p>注意 supervisor prompt 里的这段：<em>"如果合规审查有 FAIL 项，把修改意见转给 writer_agent 修订，然后重新审查"</em>。这不是线性流水线，而是带反馈环的 DAG -- LangGraph 天然支持，因为每个 SubAgent 完成后都回到 supervisor，由它决定是"往下走"还是"打回去"。</p>
<p><strong>MessagesState 就是"穷人版 A2A"</strong></p>
<p>LangGraph 的 <code>MessagesState</code> 是一个共享的结构化消息列表。每个节点读到的输入、写出的输出都挂在这条链上 -- 天然带了顺序、角色标记（谁说的）和内容。如果你需要更严格的 schema 校验，可以继承 <code>MessagesState</code> 加自己的字段：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ClinicalPaperState</span><span class="p">(</span><span class="n">MessagesState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;扩展 state，让论文写作的 A2A 数据更结构化&quot;&quot;&quot;</span>
    <span class="n">references</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>         <span class="c1"># LiteratureAgent: PMID + 摘要</span>
    <span class="n">stats_report</span><span class="p">:</span> <span class="nb">str</span>              <span class="c1"># StatsAgent: 统计分析报告</span>
    <span class="n">manuscript_sections</span><span class="p">:</span> <span class="nb">dict</span>      <span class="c1"># WriterAgent: {&quot;intro&quot;: ..., &quot;methods&quot;: ...}</span>
    <span class="n">consort_score</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>  <span class="c1"># ComplianceAgent: {pass: 22, warn: 2, fail: 1}</span>
    <span class="n">revision_round</span><span class="p">:</span> <span class="nb">int</span>            <span class="c1"># 第几轮修订（可观测性）</span>
</code></pre></div>

<p><strong>Prompt 怎么从文件加载？</strong></p>
<p>把前面第 3 节讲的 "Prompt 版本管理" 接上：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_prompt</span><span class="p">(</span><span class="n">agent_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;v1&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;从 prompts/ 目录加载对应版本的 system prompt&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;prompts/agents/</span><span class="si">{</span><span class="n">agent_name</span><span class="si">}</span><span class="s2">/system.</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">.md&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">read_text</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>

<span class="c1"># 用法：升级 CONSORT 检查清单时，只需要改 compliance 的 prompt 文件</span>
<span class="n">compliance_agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s2">&quot;openai:gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">check_consort_compliance</span><span class="p">],</span>
    <span class="n">prompt</span><span class="o">=</span><span class="n">load_prompt</span><span class="p">(</span><span class="s2">&quot;compliance&quot;</span><span class="p">,</span> <span class="s2">&quot;v2&quot;</span><span class="p">),</span>  <span class="c1"># CONSORT 2025 版</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;compliance_agent&quot;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>

<p><strong>MCP 怎么接进来？</strong></p>
<p>LangGraph 的 <code>@tool</code> 装饰器可以包装任何 Python 函数。如果你的 PubMed 检索工具跑在 MCP Server 上，只需要写一个适配层：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">mcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClientSession</span>

<span class="nd">@tool</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_pubmed_search</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_results</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;通过 MCP Server 检索 PubMed（替代直接调 NCBI API）&quot;&quot;&quot;</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">ClientSession</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span>
            <span class="s2">&quot;pubmed_search&quot;</span><span class="p">,</span>
            <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span> <span class="s2">&quot;max_results&quot;</span><span class="p">:</span> <span class="n">max_results</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
</code></pre></div>

<p>这样 <code>literature_agent</code> 代码不用改，只是 tool 的实现从"直接调 NCBI E-utilities"变成了"走 MCP 协议" -- <strong>接口不变，通道标准化</strong>。同理，<code>stats_agent</code> 的统计脚本也可以包成 MCP Server，让 R/Python 后端跑真实的 t-test / Cox regression。</p>
<hr>
<h2 id="_5">总结：复杂流程的解法，是"工程化地管理不确定性"</h2>
<p>如果你只记住一句话：<strong>Super Agent 负责编排与验收，SubAgent 负责 SRP 能力，A2A 用契约沟通，Prompt 用 Git 管版本，Workflow 先声明后执行，MCP 把工具接入标准化。</strong></p>
<p>你目前团队里最想用 Agent 处理的"复杂流程"是什么？是代码审查、安全审计、内容生产，还是别的什么？欢迎留言聊聊——说不定你的场景就是下一篇文章的素材。</p>
<p>最后给你一张思维导图（方便复盘/分享给同事）。</p>
<div class="highlight"><pre><span></span><code>@startmindmap
&lt;style&gt;
mindmapDiagram {
  node {
    BackgroundColor #FAFAFA
  }
  :depth(0) {
    BackgroundColor #FFD700
  }
  :depth(1) {
    BackgroundColor #E3F2FD
  }
  :depth(2) {
    BackgroundColor #F5F5F5
  }
}
&lt;/style&gt;
* 用 AI Agent 处理复杂流程
** 先定义角色
*** Super Agent
**** 识别/拆分任务
**** 编排 workflow（顺序/并行/重试）
**** 汇总成果 + 验收一致性
*** SubAgent（SRP）
**** Research：资料与引用
**** Code：改动与测试
**** Doc：写作与结构化输出
**** Diagram：渲染与产物管理
** SOLID 设计原则
*** SRP：一个 Agent 一个职责
*** OCP：加能力 = 加节点/加文件
*** LSP：遵守契约即可互换
*** ISP：最小够用的工具集
*** DIP：依赖契约，不依赖实现
** A2A：结构化通讯
*** schema + version
*** correlation_id 可追踪
*** error 分类 + 策略化重试
** Prompt：文件化版本管理
*** prompts/ 目录
*** Git diff/review/rollback
** Workflow：先设计再执行
*** DAG/状态机
*** 超时/重试/兜底写在执行层
** MCP：工具接入标准化
*** tools/resources/prompts
*** 权限边界更清晰
** LangGraph 实战
*** Supervisor + SubAgent
*** MessagesState = A2A
*** @tool + MCP 适配
** 观测与安全
*** 日志脱敏
*** 最小权限
*** 产物可审计
@endmindmap
</code></pre></div>

<p><img alt="用 AI Agent 处理复杂流程：思维导图" src="../images/journal_20260206_ai-agent-workflow_mindmap.png"></p>
<hr>
<h2 id="_6">扩展阅读</h2>
<ul>
<li><a href="https://modelcontextprotocol.io/specification/latest">Model Context Protocol（MCP）规范（latest）</a></li>
<li><a href="https://modelcontextprotocol.io/">Model Context Protocol 官方站点</a></li>
<li><a href="https://github.com/modelcontextprotocol">MCP GitHub Organization（参考实现与 SDK）</a></li>
<li><a href="https://langchain-ai.github.io/langgraph/">LangGraph 官方文档</a></li>
<li><a href="https://langchain-ai.github.io/langgraph/tutorials/multi_agent/agent_supervisor">LangGraph Multi-Agent Supervisor Tutorial</a></li>
<li><a href="https://github.com/google/A2A">Google Agent2Agent Protocol (A2A)</a></li>
</ul>
<hr/>
<p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/ai.html">ai</a>
      <a href="./tag/agent.html">agent</a>
      <a href="./tag/workflow.html">workflow</a>
      <a href="./tag/mcp.html">mcp</a>
      <a href="./tag/a2a.html">a2a</a>
      <a href="./tag/prompt-engineering.html">prompt-engineering</a>
      <a href="./tag/langgraph.html">langgraph</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./ru-he-da-zao-ge-ren-yu-xiang-mu-zhi-shi-ku-cong-quan-wen-sou-suo-dao-ragzai-dao-claude-skill.html" title="如何打造个人与项目知识库：从全文搜索到 RAG，再到 Claude Skill">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./zhi-chang-gong-ju-xiang-zhi-san-dian-fa-bie-zhi-gei-yi-ge-fang-an-na-shi-zai-bi-ling-dao-zuo-xuan-ze.html" title="职场工具箱之三点法：别只给一个方案，那是在逼领导做选择">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./cong-shou-cuo-workflow-dao-langgraphai-liu-cheng-bian-pai-de-liang-chong-lu-jing.html">从手搓 Workflow 到 LangGraph：AI 流程编排的两种路径</a></li>
      <li><a href="./prompt-as-codedang-prompt-bu-zhi-shi-hua-er-shi-ke-zhi-xing-de-cheng-xu.html">Prompt-as-Code：当 Prompt 不只是"话"，而是可执行的"程序"</a></li>
      <li><a href="./vibe-bian-cheng-de-xin-fan-shi-zai-ai-shi-dai-zhong-xin-ding-yi-ruan-jian-kai-fa.html">Vibe 编程的新范式：在 AI 时代重新定义软件开发</a></li>
      <li><a href="./cursor-de-san-ban-fu-rules-commands-yu-agent-skills.html">Cursor 的三板斧：Rules, Commands 与 Agent Skills</a></li>
      <li><a href="./agent-skillsgei-ai-zhu-shou-zhuang-shang-ji-neng-bao.html">Agent Skills：给 AI 助手装上"技能包"</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>