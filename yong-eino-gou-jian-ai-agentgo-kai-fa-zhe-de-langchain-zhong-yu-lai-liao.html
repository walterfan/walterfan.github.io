
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="字节跳动开源的 Eino 框架，让 Go 开发者也能优雅地构建 AI Agent——本文带你从零开始，用 Go 写一个智能穿衣助手" />
<meta name="keywords" content="golang, ai-agent, eino, llm, cloudwego">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="用 Eino 构建 AI Agent：Go 开发者的 LangChain 终于来了"/>
  <meta property="og:description" content="字节跳动开源的 Eino 框架，让 Go 开发者也能优雅地构建 AI Agent——本文带你从零开始，用 Go 写一个智能穿衣助手"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./yong-eino-gou-jian-ai-agentgo-kai-fa-zhe-de-langchain-zhong-yu-lai-liao.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2026-01-14 21:00:00+08:00"/>
  <meta property="article:modified_time" content="2026-01-14 23:00:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="golang"/>
  <meta property="article:tag" content="ai-agent"/>
  <meta property="article:tag" content="eino"/>
  <meta property="article:tag" content="llm"/>
  <meta property="article:tag" content="cloudwego"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; 用 Eino 构建 AI Agent：Go 开发者的 LangChain 终于来了</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="tao.html" >tao</a>
          </li>
          <li>
            <a target="_self" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_self" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_self" href="https://github.com/walterfan" >github</a>
          </li>
          <li>
            <a target="_self" href="https://www.jianshu.com/u/e0b365801f48" >技术文章</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="yong-eino-gou-jian-ai-agentgo-kai-fa-zhe-de-langchain-zhong-yu-lai-liao">用 Eino 构建 AI Agent：Go 开发者的 LangChain 终于来了</h1>
    <p>
      Posted on Wed 14 January 2026 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <table>
<thead>
<tr>
<th><strong>Abstract</strong></th>
<th>用 Eino 框架构建一个智能穿衣助手——结合天气、用户偏好、衣柜数据，给出个性化穿搭推荐</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authors</strong></td>
<td><a href="https://www.fanyamin.com">Walter Fan</a></td>
</tr>
<tr>
<td><strong>Category</strong></td>
<td>learning note</td>
</tr>
<tr>
<td><strong>Status</strong></td>
<td>v1.0</td>
</tr>
<tr>
<td><strong>Updated</strong></td>
<td>2026-01-14</td>
</tr>
<tr>
<td><strong>License</strong></td>
<td><a href="http://creativecommons.org/licenses/by-nc-nd/4.0">CC-BY-NC-ND 4.0</a></td>
</tr>
</tbody>
</table>
<h1 id="eino-ai-agentgo-langchain">用 Eino 构建 AI Agent：Go 开发者的 LangChain 终于来了</h1>
<blockquote>
<p>Go 开发者等这一天，等了太久了。</p>
</blockquote>
<hr>
<h2 id="_1">开篇：从一个"穿衣困难症"说起</h2>
<p>每天早上，我都要经历灵魂拷问：<strong>今天穿什么？</strong></p>
<p>看看窗外——多云。打开手机——8 度。翻翻衣柜——一堆衣服。然后陷入选择困难症。</p>
<p>这个场景你熟悉吗？</p>
<p>作为一个程序员，我的第一反应是：<strong>能不能写个 AI 来帮我搭配？</strong></p>
<p>需求很简单：
- 查一下今天天气
- 看看我衣柜里有什么
- 结合我的喜好（我怕冷、不喜欢太正式）
- 给我一套今天的穿搭推荐
- 如果我不满意，能根据反馈调整</p>
<p>用 Python + LangChain？三下五除二就能搞定。</p>
<p>但我是 Go 开发者啊！我的后端服务都是 Go 写的，难道为了这个功能还得起一个 Python 服务？</p>
<p><strong>以前确实没办法。但现在不一样了。</strong></p>
<p>字节跳动开源了 <a href="https://github.com/cloudwego/eino">Eino</a>——一个<strong>纯 Go 实现的 AI 应用开发框架</strong>。</p>
<p>它的目标很明确：<strong>让 Go 开发者也能像用 LangChain 一样，优雅地构建 AI 应用</strong>。</p>
<p>这篇文章，我就带你用 Eino 构建一个<strong>智能穿衣助手</strong>——它能查天气、读档案、翻衣柜、给推荐、听反馈。一个真正"能用"的 AI Agent。</p>
<hr>
<h2 id="eino">一、Eino 是什么？</h2>
<p><strong>GitHub</strong>: <a href="https://github.com/cloudwego/eino">cloudwego/eino</a></p>
<p>Eino（读作 /ˈaɪnoʊ/）是 CloudWeGo 团队开源的 <strong>Go 语言 LLM/AI 应用开发框架</strong>。</p>
<p>一句话总结：<strong>Eino 之于 Go，就像 LangChain 之于 Python</strong>。</p>
<h3 id="eino_1">Eino 的核心能力</h3>
<table>
<thead>
<tr>
<th>能力</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>组件抽象</strong></td>
<td>ChatModel、Tool、Retriever、Document Loader 等标准组件</td>
</tr>
<tr>
<td><strong>图编排</strong></td>
<td>用 Graph 把多个组件串联起来，实现复杂工作流</td>
</tr>
<tr>
<td><strong>流处理</strong></td>
<td>原生支持流式输出，自动处理流的拼接、复制、合并</td>
</tr>
<tr>
<td><strong>回调机制</strong></td>
<td>OnStart、OnEnd、OnError 等切面，方便做日志、追踪、监控</td>
</tr>
<tr>
<td><strong>类型安全</strong></td>
<td>编译时检查组件输入输出类型，减少运行时错误</td>
</tr>
</tbody>
</table>
<h3 id="eino_2">Eino 的项目结构</h3>
<div class="highlight"><pre><span></span><code>Eino 生态
├── eino          # 核心框架：类型定义、组件抽象、编排能力
├── eino-ext      # 扩展实现：各种 ChatModel、Tool、Retriever 的具体实现
├── eino-devops   # 开发工具：可视化调试、开发
└── eino-examples # 示例代码：最佳实践
</code></pre></div>

<h3 id="eino_3">为什么选择 Eino？</h3>
<ol>
<li><strong>纯 Go 实现</strong>：不用 CGO，不用 Python，部署简单</li>
<li><strong>类型安全</strong>：编译时检查，比 Python 的运行时错误好太多</li>
<li><strong>高性能</strong>：Go 的并发模型天然适合 AI 应用的流处理</li>
<li><strong>字节背书</strong>：CloudWeGo 团队出品，久经考验</li>
<li><strong>活跃社区</strong>：9.2k Star，持续更新</li>
</ol>
<hr>
<h2 id="eino_4">二、核心概念：理解 Eino 的设计哲学</h2>
<p>在写代码之前，我们需要理解 Eino 的几个核心概念。</p>
<h3 id="1-component">1. 组件（Component）</h3>
<p>Eino 把 AI 应用中常用的"积木块"抽象成了<strong>组件</strong>。</p>
<table>
<thead>
<tr>
<th>组件类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ChatModel</strong></td>
<td>大语言模型</td>
<td>OpenAI、Claude、Ollama</td>
</tr>
<tr>
<td><strong>Tool</strong></td>
<td>工具/函数调用</td>
<td>搜索、计算器、API 调用</td>
</tr>
<tr>
<td><strong>Retriever</strong></td>
<td>检索器</td>
<td>向量检索、关键词检索</td>
</tr>
<tr>
<td><strong>Document Loader</strong></td>
<td>文档加载器</td>
<td>PDF、网页、Markdown</td>
</tr>
<tr>
<td><strong>ChatTemplate</strong></td>
<td>提示词模板</td>
<td>系统提示、Few-shot 示例</td>
</tr>
<tr>
<td><strong>Lambda</strong></td>
<td>自定义函数</td>
<td>任意 Go 函数</td>
</tr>
</tbody>
</table>
<p>每个组件都有<strong>标准的接口</strong>：定义好的输入类型、输出类型、Option 类型。</p>
<p>这意味着：<strong>你可以像搭积木一样，把不同的组件组合起来</strong>。</p>
<h3 id="2-orchestration">2. 编排（Orchestration）</h3>
<p>单个组件没什么用，<strong>把组件串起来才能干活</strong>。</p>
<p>Eino 提供了两种编排方式：</p>
<p><strong>Chain（链式）</strong>：简单的线性流程</p>
<div class="highlight"><pre><span></span><code>Input → ChatTemplate → ChatModel → Output
</code></pre></div>

<p><strong>Graph（图）</strong>：复杂的非线性流程</p>
<div class="highlight"><pre><span></span><code>        ┌─→ Tool A ─┐
Input → │           │ → ChatModel → Output
        └─→ Tool B ─┘
</code></pre></div>

<p>Graph 编排是 Eino 的杀手锏，它支持：</p>
<ul>
<li><strong>分支</strong>：根据条件走不同路径</li>
<li><strong>并行</strong>：多个节点同时执行</li>
<li><strong>循环</strong>：Agent 的"思考-行动-观察"循环</li>
<li><strong>状态</strong>：在节点之间共享状态</li>
</ul>
<h3 id="3-streaming">3. 流处理（Streaming）</h3>
<p>大模型的输出是<strong>流式</strong>的——它一边生成一边输出，而不是等全部生成完再返回。</p>
<p>Eino 原生支持流处理，而且做了很多自动化的工作：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>Eino 的处理</th>
</tr>
</thead>
<tbody>
<tr>
<td>下游需要完整输入</td>
<td>自动拼接流</td>
</tr>
<tr>
<td>下游需要流输入</td>
<td>自动传递流</td>
</tr>
<tr>
<td>多个下游节点</td>
<td>自动复制流</td>
</tr>
<tr>
<td>多个上游流汇合</td>
<td>自动合并流</td>
</tr>
</tbody>
</table>
<p>这意味着：<strong>你不用关心流的细节，Eino 帮你处理好了</strong>。</p>
<h3 id="4-callback">4. 回调（Callback）</h3>
<p>AI 应用需要日志、追踪、监控。Eino 提供了<strong>切面机制</strong>：</p>
<ul>
<li><code>OnStart</code>：组件开始执行前</li>
<li><code>OnEnd</code>：组件执行完成后</li>
<li><code>OnError</code>：组件执行出错时</li>
<li><code>OnStartWithStreamInput</code>：流输入开始时</li>
<li><code>OnEndWithStreamOutput</code>：流输出结束时</li>
</ul>
<p>你可以在这些切面里做任何事情：打日志、发指标、记录 Trace。</p>
<hr>
<h2 id="eino_5">三、实战：用 Eino 构建一个智能穿衣助手</h2>
<p>理论讲完了，来点实际的。</p>
<p>我们要构建一个<strong>智能穿衣助手 Agent</strong>——它能：</p>
<ol>
<li>查询用户所在城市的天气</li>
<li>获取用户的个人信息（年龄、性别、身体状况、穿衣偏好）</li>
<li>查看用户衣柜里有哪些可选的衣物</li>
<li>综合以上信息，推荐今天穿什么</li>
<li>根据用户反馈，调整推荐</li>
</ol>
<p>这是一个比"查天气"复杂得多的场景——它需要<strong>多个工具协作</strong>、<strong>多轮对话</strong>、<strong>个性化推理</strong>。</p>
<h3 id="step-1-eino">Step 1：安装 Eino</h3>
<div class="highlight"><pre><span></span><code>go<span class="w"> </span>get<span class="w"> </span>github.com/cloudwego/eino@latest
go<span class="w"> </span>get<span class="w"> </span>github.com/cloudwego/eino-ext@latest
</code></pre></div>

<h3 id="step-2">Step 2：定义数据模型</h3>
<p>首先，定义我们需要的数据结构：</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="c1">// 用户档案</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">UserProfile</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">      </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">         </span><span class="kt">int</span><span class="w">      </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w">      </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;gender&quot;`</span><span class="w">      </span><span class="c1">// male, female</span>
<span class="w">    </span><span class="nx">City</span><span class="w">        </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;city&quot;`</span><span class="w">        </span><span class="c1">// 所在城市</span>
<span class="w">    </span><span class="nx">BodyType</span><span class="w">    </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;body_type&quot;`</span><span class="w">   </span><span class="c1">// slim, medium, large</span>
<span class="w">    </span><span class="nx">HealthNotes</span><span class="w"> </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;health_notes&quot;`</span><span class="w"> </span><span class="c1">// 健康备注，如：怕冷、关节炎</span>
<span class="w">    </span><span class="nx">StylePrefs</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;style_prefs&quot;`</span><span class="w"> </span><span class="c1">// 风格偏好：casual, formal, sporty</span>
<span class="w">    </span><span class="nx">ColorPrefs</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;color_prefs&quot;`</span><span class="w"> </span><span class="c1">// 颜色偏好</span>
<span class="p">}</span>

<span class="c1">// 衣物信息</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">ClothingItem</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ID</span><span class="w">          </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;id&quot;`</span>
<span class="w">    </span><span class="nx">Type</span><span class="w">        </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;type&quot;`</span><span class="w">        </span><span class="c1">// top, bottom, outerwear, shoes, accessory</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;name&quot;`</span><span class="w">        </span><span class="c1">// 衣物名称</span>
<span class="w">    </span><span class="nx">Color</span><span class="w">       </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;color&quot;`</span><span class="w">       </span><span class="c1">// 颜色</span>
<span class="w">    </span><span class="nx">Style</span><span class="w">       </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;style&quot;`</span><span class="w">       </span><span class="c1">// casual, formal, sporty</span>
<span class="w">    </span><span class="nx">WarmthLevel</span><span class="w"> </span><span class="kt">int</span><span class="w">      </span><span class="s">`json:&quot;warmth_level&quot;`</span><span class="w"> </span><span class="c1">// 保暖等级 1-5</span>
<span class="w">    </span><span class="nx">Occasions</span><span class="w">   </span><span class="p">[]</span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;occasions&quot;`</span><span class="w">   </span><span class="c1">// 适合场合</span>
<span class="w">    </span><span class="nx">ImageURL</span><span class="w">    </span><span class="kt">string</span><span class="w">   </span><span class="s">`json:&quot;image_url&quot;`</span><span class="w">   </span><span class="c1">// 图片链接</span>
<span class="p">}</span>

<span class="c1">// 天气信息</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">WeatherInfo</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">City</span><span class="w">        </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;city&quot;`</span>
<span class="w">    </span><span class="nx">Temperature</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;temperature&quot;`</span><span class="w">  </span><span class="c1">// 摄氏度</span>
<span class="w">    </span><span class="nx">FeelsLike</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;feels_like&quot;`</span><span class="w">   </span><span class="c1">// 体感温度</span>
<span class="w">    </span><span class="nx">Humidity</span><span class="w">    </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;humidity&quot;`</span><span class="w">     </span><span class="c1">// 湿度</span>
<span class="w">    </span><span class="nx">Condition</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;condition&quot;`</span><span class="w">    </span><span class="c1">// 天气状况：晴、多云、雨、雪</span>
<span class="w">    </span><span class="nx">WindSpeed</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;wind_speed&quot;`</span><span class="w">   </span><span class="c1">// 风速</span>
<span class="w">    </span><span class="nx">UVIndex</span><span class="w">     </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;uv_index&quot;`</span><span class="w">     </span><span class="c1">// 紫外线指数</span>
<span class="p">}</span>

<span class="c1">// 穿搭推荐</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">OutfitRecommendation</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Top</span><span class="w">        </span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;top&quot;`</span>
<span class="w">    </span><span class="nx">Bottom</span><span class="w">     </span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;bottom&quot;`</span>
<span class="w">    </span><span class="nx">Outerwear</span><span class="w">  </span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;outerwear,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Shoes</span><span class="w">      </span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;shoes&quot;`</span>
<span class="w">    </span><span class="nx">Accessory</span><span class="w">  </span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;accessory,omitempty&quot;`</span>
<span class="w">    </span><span class="nx">Reason</span><span class="w">     </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;reason&quot;`</span><span class="w">     </span><span class="c1">// 推荐理由</span>
<span class="w">    </span><span class="nx">StyleTips</span><span class="w">  </span><span class="kt">string</span><span class="w">        </span><span class="s">`json:&quot;style_tips&quot;`</span><span class="w"> </span><span class="c1">// 穿搭小贴士</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="step-3tools">Step 3：定义工具（Tools）</h3>
<p>穿衣助手需要 4 个工具：</p>
<p><strong>工具 1：获取天气</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">NewWeatherTool</span><span class="p">()</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">InvokableTool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">NewTool</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">schema</span><span class="p">.</span><span class="nx">ToolInfo</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;get_weather&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;获取指定城市的当前天气信息，包括温度、体感温度、湿度、天气状况等&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Parameters</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;object&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;city&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;城市名称，如：北京、上海、杭州&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;city&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">City</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;city&quot;`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>

<span class="w">            </span><span class="c1">// 实际项目中调用天气 API，这里模拟</span>
<span class="w">            </span><span class="nx">weather</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">WeatherInfo</span><span class="p">{</span>
<span class="w">                </span><span class="nx">City</span><span class="p">:</span><span class="w">        </span><span class="nx">params</span><span class="p">.</span><span class="nx">City</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Temperature</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
<span class="w">                </span><span class="nx">FeelsLike</span><span class="p">:</span><span class="w">   </span><span class="mi">5</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Humidity</span><span class="p">:</span><span class="w">    </span><span class="mi">65</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Condition</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;多云&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">WindSpeed</span><span class="p">:</span><span class="w">   </span><span class="mi">15</span><span class="p">,</span>
<span class="w">                </span><span class="nx">UVIndex</span><span class="p">:</span><span class="w">     </span><span class="mi">2</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">weather</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>工具 2：获取用户档案</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">NewUserProfileTool</span><span class="p">(</span><span class="nx">profileStore</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">UserProfile</span><span class="p">)</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">InvokableTool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">NewTool</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">schema</span><span class="p">.</span><span class="nx">ToolInfo</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;get_user_profile&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;获取用户的个人信息，包括年龄、性别、身体状况、穿衣风格偏好等&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Parameters</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;object&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;用户ID&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">UserID</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>

<span class="w">            </span><span class="nx">profile</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">profileStore</span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s">`{&quot;error&quot;: &quot;用户不存在&quot;}`</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">profile</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>工具 3：查询衣柜</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">NewWardrobeTool</span><span class="p">(</span><span class="nx">wardrobeStore</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="o">*</span><span class="nx">ClothingItem</span><span class="p">)</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">InvokableTool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">NewTool</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">schema</span><span class="p">.</span><span class="nx">ToolInfo</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;get_wardrobe&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;获取用户衣柜中的所有衣物，可按类型筛选（top上衣、bottom下装、outerwear外套、shoes鞋子、accessory配饰）&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Parameters</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;object&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;用户ID&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;clothing_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;衣物类型筛选，可选：top, bottom, outerwear, shoes, accessory。不填则返回全部&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">UserID</span><span class="w">       </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">                </span><span class="nx">ClothingType</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;clothing_type&quot;`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>

<span class="w">            </span><span class="nx">items</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">wardrobeStore</span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s">`{&quot;error&quot;: &quot;衣柜为空&quot;}`</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// 按类型筛选</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">ClothingType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">filtered</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">ClothingItem</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">item</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="nx">item</span><span class="p">.</span><span class="nx">Type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">ClothingType</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">filtered</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">filtered</span><span class="p">,</span><span class="w"> </span><span class="nx">item</span><span class="p">)</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="nx">items</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">filtered</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nx">Marshal</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>工具 4：保存用户反馈</strong></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span><span class="w"> </span><span class="nx">NewFeedbackTool</span><span class="p">(</span><span class="nx">feedbackStore</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">InvokableTool</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tool</span><span class="p">.</span><span class="nx">NewTool</span><span class="p">(</span>
<span class="w">        </span><span class="o">&amp;</span><span class="nx">schema</span><span class="p">.</span><span class="nx">ToolInfo</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;save_feedback&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;保存用户对穿搭推荐的反馈，用于改进后续推荐&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Parameters</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;object&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;用户ID&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;feedback_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;反馈类型：like（喜欢）、dislike（不喜欢）、too_warm（太热）、too_cold（太冷）、wrong_style（风格不对）&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="s">&quot;feedback_detail&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">                        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">                        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;详细反馈内容&quot;</span><span class="p">,</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="s">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;feedback_type&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">UserID</span><span class="w">         </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">                </span><span class="nx">FeedbackType</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;feedback_type&quot;`</span>
<span class="w">                </span><span class="nx">FeedbackDetail</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;feedback_detail&quot;`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">json</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">params</span><span class="p">)</span>

<span class="w">            </span><span class="nx">feedback</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;[%s] %s: %s&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;2006-01-02 15:04&quot;</span><span class="p">),</span><span class="w"> </span>
<span class="w">                </span><span class="nx">params</span><span class="p">.</span><span class="nx">FeedbackType</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="nx">params</span><span class="p">.</span><span class="nx">FeedbackDetail</span><span class="p">)</span>

<span class="w">            </span><span class="nx">feedbackStore</span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">feedbackStore</span><span class="p">[</span><span class="nx">params</span><span class="p">.</span><span class="nx">UserID</span><span class="p">],</span><span class="w"> </span><span class="nx">feedback</span><span class="p">)</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">`{&quot;status&quot;: &quot;反馈已保存，感谢您的意见！&quot;}`</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="step-4-chatmodel">Step 4：创建 ChatModel</h3>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;os&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino-ext/components/model/openai&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">NewChatModel</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">openai</span><span class="p">.</span><span class="nx">ChatModel</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">openai</span><span class="p">.</span><span class="nx">NewChatModel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">openai</span><span class="p">.</span><span class="nx">ChatModelConfig</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Model</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;gpt-4-turbo&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">APIKey</span><span class="p">:</span><span class="w">  </span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;OPENAI_API_KEY&quot;</span><span class="p">),</span>
<span class="w">        </span><span class="nx">BaseURL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://api.openai.com/v1&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// 或者用 OpenRouter</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="step-5-agent">Step 5：构建穿衣助手 Agent</h3>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;fmt&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino/components/tool&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino/flow/agent/react&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino/schema&quot;</span>
<span class="p">)</span>

<span class="c1">// 系统提示词——这是穿衣助手的&quot;灵魂&quot;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SystemPrompt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`你是一个专业的智能穿衣助手，帮助用户根据天气、个人情况和衣柜中的衣物，推荐今天的穿搭。</span>

<span class="s">## 工作流程</span>

<span class="s">1. **了解用户**：首先使用 get_user_profile 获取用户的基本信息（年龄、性别、身体状况、穿衣偏好）</span>
<span class="s">2. **查看天气**：使用 get_weather 获取用户所在城市的天气</span>
<span class="s">3. **查看衣柜**：使用 get_wardrobe 查看用户有哪些衣物可选</span>
<span class="s">4. **综合推荐**：根据以上信息，给出穿搭建议</span>

<span class="s">## 推荐原则</span>

<span class="s">- **健康优先**：如果用户有健康问题（如怕冷、关节炎），要特别注意保暖</span>
<span class="s">- **场合适配**：根据用户今天的安排（如果用户提到了）选择合适的风格</span>
<span class="s">- **个性尊重**：尽量符合用户的风格和颜色偏好</span>
<span class="s">- **天气适应**：</span>
<span class="s">  - 温度 &lt; 10°C：需要外套，注意保暖</span>
<span class="s">  - 温度 10-20°C：可穿轻薄外套或厚衬衫</span>
<span class="s">  - 温度 &gt; 20°C：轻便穿着</span>
<span class="s">  - 下雨：建议防水外套或带伞</span>
<span class="s">  - 大风：避免裙装或宽松衣物</span>

<span class="s">## 输出格式</span>

<span class="s">推荐时请包含：</span>
<span class="s">1. 具体的衣物搭配（从用户衣柜中选择）</span>
<span class="s">2. 为什么这样搭配的理由</span>
<span class="s">3. 穿搭小贴士</span>

<span class="s">## 反馈处理</span>

<span class="s">如果用户对推荐不满意，请：</span>
<span class="s">1. 使用 save_feedback 保存用户反馈</span>
<span class="s">2. 根据反馈调整推荐（如：太冷就加衣服，风格不对就换一套）</span>
<span class="s">3. 给出新的推荐</span>
<span class="s">`</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 1. 初始化数据存储（实际项目中这些会是数据库）</span>
<span class="w">    </span><span class="nx">profileStore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">initUserProfiles</span><span class="p">()</span>
<span class="w">    </span><span class="nx">wardrobeStore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">initWardrobes</span><span class="p">()</span>
<span class="w">    </span><span class="nx">feedbackStore</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="kt">string</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 2. 创建 ChatModel</span>
<span class="w">    </span><span class="nx">chatModel</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewChatModel</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 3. 创建所有工具</span>
<span class="w">    </span><span class="nx">tools</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">tool</span><span class="p">.</span><span class="nx">BaseTool</span><span class="p">{</span>
<span class="w">        </span><span class="nx">NewWeatherTool</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">NewUserProfileTool</span><span class="p">(</span><span class="nx">profileStore</span><span class="p">),</span>
<span class="w">        </span><span class="nx">NewWardrobeTool</span><span class="p">(</span><span class="nx">wardrobeStore</span><span class="p">),</span>
<span class="w">        </span><span class="nx">NewFeedbackTool</span><span class="p">(</span><span class="nx">feedbackStore</span><span class="p">),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 4. 创建穿衣助手 Agent</span>
<span class="w">    </span><span class="nx">agent</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">react</span><span class="p">.</span><span class="nx">NewAgent</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">react</span><span class="p">.</span><span class="nx">AgentConfig</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Model</span><span class="p">:</span><span class="w">         </span><span class="nx">chatModel</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Tools</span><span class="p">:</span><span class="w">         </span><span class="nx">tools</span><span class="p">,</span>
<span class="w">        </span><span class="nx">SystemPrompt</span><span class="p">:</span><span class="w">  </span><span class="nx">SystemPrompt</span><span class="p">,</span>
<span class="w">        </span><span class="nx">MaxIterations</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="c1">// 允许多轮工具调用</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 5. 开始对话</span>
<span class="w">    </span><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;user_001&quot;</span>

<span class="w">    </span><span class="c1">// 第一轮：请求推荐</span>
<span class="w">    </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">schema</span><span class="p">.</span><span class="nx">Message</span><span class="p">{</span>
<span class="w">        </span><span class="nx">schema</span><span class="p">.</span><span class="nx">UserMessage</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;我是用户 %s，今天要去参加一个商务会议，帮我看看穿什么合适？&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">userID</span><span class="p">,</span>
<span class="w">        </span><span class="p">)),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🤖 穿衣助手:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 第二轮：用户反馈</span>
<span class="w">    </span><span class="nx">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nx">schema</span><span class="p">.</span><span class="nx">AssistantMessage</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">Content</span><span class="p">),</span>
<span class="w">        </span><span class="nx">schema</span><span class="p">.</span><span class="nx">UserMessage</span><span class="p">(</span><span class="s">&quot;感觉你推荐的外套有点太正式了，我想要休闲一点的&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🤖 穿衣助手:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 初始化用户档案（模拟数据）</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">initUserProfiles</span><span class="p">()</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">UserProfile</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">UserProfile</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;user_001&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">UserID</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;user_001&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;张三&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Age</span><span class="p">:</span><span class="w">         </span><span class="mi">35</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Gender</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;male&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">City</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;北京&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">BodyType</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;medium&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">HealthNotes</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;轻微怕冷，膝盖有时不舒服&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">StylePrefs</span><span class="p">:</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;business_casual&quot;</span><span class="p">},</span>
<span class="w">            </span><span class="nx">ColorPrefs</span><span class="p">:</span><span class="w">  </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;藏青色&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;灰色&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;白色&quot;</span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 初始化衣柜（模拟数据）</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">initWardrobes</span><span class="p">()</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">][]</span><span class="o">*</span><span class="nx">ClothingItem</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;user_001&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 上衣</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;t001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;白色牛津纺衬衫&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;白色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;business_casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;t002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;藏青色羊毛衫&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;藏青色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;t003&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;灰色圆领T恤&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;灰色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;t004&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;top&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;条纹POLO衫&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;蓝白条纹&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;business_casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">            </span><span class="c1">// 下装</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;深灰色西裤&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;深灰色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;formal&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;卡其色休闲裤&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;卡其色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;b003&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bottom&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;深蓝色牛仔裤&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;深蓝色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">            </span><span class="c1">// 外套</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;o001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;outerwear&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;藏青色羊毛大衣&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;藏青色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;formal&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;o002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;outerwear&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;灰色针织开衫&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;灰色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;o003&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;outerwear&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;黑色皮夹克&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;黑色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;o004&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;outerwear&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;卡其色风衣&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;卡其色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;business_casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="w">            </span><span class="c1">// 鞋子</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s001&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;黑色皮鞋&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;黑色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;formal&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s002&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;棕色乐福鞋&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;棕色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;business_casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">            </span><span class="p">{</span><span class="nx">ID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;s003&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;shoes&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;白色运动鞋&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Color</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;白色&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Style</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;casual&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">WarmthLevel</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="step-6">Step 6：运行效果演示</h3>
<p>当用户说"今天要去参加商务会议"，Agent 会：</p>
<ol>
<li>
<p><strong>调用 get_user_profile</strong>：获取用户信息
   <code>json
   {"name": "张三", "age": 35, "gender": "male", "city": "北京", 
    "health_notes": "轻微怕冷，膝盖有时不舒服", "style_prefs": ["casual", "business_casual"]}</code></p>
</li>
<li>
<p><strong>调用 get_weather</strong>：查询北京天气
   <code>json
   {"city": "北京", "temperature": 8, "feels_like": 5, "condition": "多云", "wind_speed": 15}</code></p>
</li>
<li>
<p><strong>调用 get_wardrobe</strong>：查看可选衣物
   <code>json
   [{"name": "白色牛津纺衬衫", ...}, {"name": "藏青色羊毛衫", ...}, ...]</code></p>
</li>
<li>
<p><strong>综合推理</strong>：</p>
</li>
<li>温度 8°C，体感 5°C → 需要保暖</li>
<li>用户怕冷、膝盖不好 → 额外注意保暖</li>
<li>商务会议 → business_casual 风格</li>
<li>
<p>用户偏好藏青色、灰色</p>
</li>
<li>
<p><strong>输出推荐</strong>：
   ```
   🤖 穿衣助手：</p>
</li>
</ol>
<p>根据今天北京的天气（8°C，体感5°C，多云有风）和您的商务会议需求，
   我从您的衣柜中为您搭配了这套：</p>
<p>👔 上衣：白色牛津纺衬衫 + 藏青色羊毛衫（叠穿）
   👖 下装：深灰色西裤
   🧥 外套：卡其色风衣
   👞 鞋子：棕色乐福鞋</p>
<p>💡 推荐理由：
   - 考虑到您轻微怕冷且膝盖不适，选择了保暖性较好的羊毛衫叠穿
   - 风衣既能保暖又不会过于正式，符合 business_casual 风格
   - 藏青色+卡其色+棕色的配色经典稳重，适合商务场合</p>
<p>⚠️ 小贴士：今天风大，建议把风衣扣子系好；
   膝盖不舒服的话，可以在西裤里穿一条薄款保暖裤。
   ```</p>
<h3 id="step-7">Step 7：处理用户反馈</h3>
<p>当用户说"外套太正式了，想要休闲一点"：</p>
<ol>
<li><strong>调用 save_feedback</strong>：保存反馈</li>
<li><strong>重新推理</strong>：换一件更休闲的外套</li>
<li><strong>输出新推荐</strong>：
   ```
   🤖 穿衣助手：</li>
</ol>
<p>明白了！既然您想休闲一点，我换一套推荐：</p>
<p>👔 上衣：条纹POLO衫 + 藏青色羊毛衫
   👖 下装：卡其色休闲裤
   🧥 外套：灰色针织开衫（天气转暖后可脱掉）
   👞 鞋子：棕色乐福鞋</p>
<p>这套更休闲但依然得体，适合不那么正式的商务场合。
   如果会议室温度高，可以把针织开衫脱掉，POLO衫单穿也很精神。
   ```</p>
<h3 id="step-8">Step 8：添加流式输出</h3>
<p>让推荐过程更有"交互感"：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 流式运行</span>
<span class="nx">stream</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Stream</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;🤖 穿衣助手: &quot;</span><span class="p">)</span>
<span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">chunk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">stream</span><span class="p">.</span><span class="nx">Recv</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">break</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span><span class="w"> </span><span class="c1">// 实时打印，有&quot;正在思考&quot;的感觉</span>
<span class="p">}</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span>
</code></pre></div>

<hr>
<h2 id="graph">四、进阶：Graph 编排</h2>
<p>ReAct Agent 是 Eino 提供的"开箱即用"方案。但如果你需要更复杂的工作流，就要用到 <strong>Graph 编排</strong>。</p>
<h3 id="_2">场景：穿衣助手的并行优化</h3>
<p>上面的 ReAct Agent 是串行调用工具的：先查用户 → 再查天气 → 再查衣柜。</p>
<p>但其实这三个查询是<strong>可以并行的</strong>！用 Graph 编排可以优化性能：</p>
<div class="highlight"><pre><span></span><code>                ┌─→ 查询用户档案 ─┐
用户输入 → 解析 → │                │ → 综合推理 → 生成推荐
                ├─→ 查询天气 ────┤
                └─→ 查询衣柜 ────┘
</code></pre></div>

<h3 id="graph_1">用 Graph 实现</h3>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino/compose&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/cloudwego/eino/schema&quot;</span>
<span class="p">)</span>

<span class="c1">// 穿衣推荐的中间状态</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">OutfitContext</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserID</span><span class="w">   </span><span class="kt">string</span><span class="w">          </span><span class="s">`json:&quot;user_id&quot;`</span>
<span class="w">    </span><span class="nx">Profile</span><span class="w">  </span><span class="o">*</span><span class="nx">UserProfile</span><span class="w">    </span><span class="s">`json:&quot;profile&quot;`</span>
<span class="w">    </span><span class="nx">Weather</span><span class="w">  </span><span class="o">*</span><span class="nx">WeatherInfo</span><span class="w">    </span><span class="s">`json:&quot;weather&quot;`</span>
<span class="w">    </span><span class="nx">Wardrobe</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">ClothingItem</span><span class="w"> </span><span class="s">`json:&quot;wardrobe&quot;`</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">BuildOutfitGraph</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">compose</span><span class="p">.</span><span class="nx">CompiledGraph</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 创建 Graph</span>
<span class="w">    </span><span class="nx">graph</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">compose</span><span class="p">.</span><span class="nx">NewGraph</span><span class="p">[</span><span class="o">*</span><span class="nx">OutfitContext</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">OutfitRecommendation</span><span class="p">]()</span>

<span class="w">    </span><span class="c1">// 添加并行执行的节点</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddLambdaNode</span><span class="p">(</span><span class="s">&quot;fetch_profile&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchProfileFunc</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddLambdaNode</span><span class="p">(</span><span class="s">&quot;fetch_weather&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchWeatherFunc</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddLambdaNode</span><span class="p">(</span><span class="s">&quot;fetch_wardrobe&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchWardrobeFunc</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 添加聚合节点（等待所有并行节点完成）</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddLambdaNode</span><span class="p">(</span><span class="s">&quot;aggregate&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">aggregateFunc</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 添加推理节点</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddChatModelNode</span><span class="p">(</span><span class="s">&quot;recommend&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">recommendModel</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 定义边（数据流向）——三个查询并行执行</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="nx">compose</span><span class="p">.</span><span class="nx">START</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fetch_profile&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="nx">compose</span><span class="p">.</span><span class="nx">START</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fetch_weather&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="nx">compose</span><span class="p">.</span><span class="nx">START</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fetch_wardrobe&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 三个查询都完成后，汇聚到 aggregate</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;fetch_profile&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aggregate&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;fetch_weather&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aggregate&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;fetch_wardrobe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;aggregate&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 聚合后生成推荐</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;aggregate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;recommend&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;recommend&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">compose</span><span class="p">.</span><span class="nx">END</span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 编译 Graph</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">graph</span><span class="p">.</span><span class="nx">Compile</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>

<span class="w">    </span><span class="nx">compiledGraph</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">BuildOutfitGraph</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 运行</span>
<span class="w">    </span><span class="nx">input</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">OutfitContext</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user_001&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">recommendation</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">compiledGraph</span><span class="p">.</span><span class="nx">Invoke</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;推荐穿搭：%s + %s + %s\n&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="nx">recommendation</span><span class="p">.</span><span class="nx">Top</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">recommendation</span><span class="p">.</span><span class="nx">Bottom</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">recommendation</span><span class="p">.</span><span class="nx">Outerwear</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;理由：%s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">recommendation</span><span class="p">.</span><span class="nx">Reason</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="_3">条件分支：根据天气选择推荐策略</h3>
<p>不同天气需要不同的穿搭策略：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 添加条件分支——根据天气分流</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">AddBranch</span><span class="p">(</span><span class="s">&quot;weather_router&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="o">*</span><span class="nx">OutfitContext</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">Weather</span><span class="p">.</span><span class="nx">Temperature</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;cold_strategy&quot;</span><span class="w">    </span><span class="c1">// 寒冷天气策略：保暖优先</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">Weather</span><span class="p">.</span><span class="nx">Temperature</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">28</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;hot_strategy&quot;</span><span class="w">     </span><span class="c1">// 炎热天气策略：透气优先</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">Weather</span><span class="p">.</span><span class="nx">Condition</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;雨&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;rainy_strategy&quot;</span><span class="w">   </span><span class="c1">// 雨天策略：防水优先</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;normal_strategy&quot;</span><span class="w">      </span><span class="c1">// 普通天气策略</span>
<span class="p">})</span>

<span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;weather_router&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cold_strategy&quot;</span><span class="p">)</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;weather_router&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hot_strategy&quot;</span><span class="p">)</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;weather_router&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rainy_strategy&quot;</span><span class="p">)</span>
<span class="nx">graph</span><span class="p">.</span><span class="nx">AddEdge</span><span class="p">(</span><span class="s">&quot;weather_router&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;normal_strategy&quot;</span><span class="p">)</span>
</code></pre></div>

<h3 id="_4">添加回调（日志、追踪）</h3>
<p>记录每个步骤的执行情况，方便调试：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 创建回调处理器</span>
<span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">NewHandlerBuilder</span><span class="p">().</span>
<span class="w">    </span><span class="nx">OnStartFn</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">*</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">RunInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">CallbackInput</span><span class="p">)</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;👀 [%s] 开始执行&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fetch_weather&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;   正在查询天气...&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;recommend&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;   正在生成穿搭推荐...&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span>
<span class="w">    </span><span class="p">}).</span>
<span class="w">    </span><span class="nx">OnEndFn</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">*</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">RunInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">CallbackOutput</span><span class="p">)</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;✅ [%s] 执行完成&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fetch_weather&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">weather</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">output</span><span class="p">.(</span><span class="o">*</span><span class="nx">WeatherInfo</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;   天气：%s，温度：%d°C&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">weather</span><span class="p">.</span><span class="nx">Condition</span><span class="p">,</span><span class="w"> </span><span class="nx">weather</span><span class="p">.</span><span class="nx">Temperature</span><span class="p">)</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span>
<span class="w">    </span><span class="p">}).</span>
<span class="w">    </span><span class="nx">OnErrorFn</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">*</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">RunInfo</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;❌ [%s] 执行出错: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">ctx</span>
<span class="w">    </span><span class="p">}).</span>
<span class="w">    </span><span class="nx">Build</span><span class="p">()</span>

<span class="c1">// 运行时传入回调</span>
<span class="nx">recommendation</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">compiledGraph</span><span class="p">.</span><span class="nx">Invoke</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">,</span><span class="w"> </span><span class="nx">compose</span><span class="p">.</span><span class="nx">WithCallbacks</span><span class="p">(</span><span class="nx">handler</span><span class="p">))</span>
</code></pre></div>

<p>执行时会输出：</p>
<div class="highlight"><pre><span></span><code>👀 [fetch_profile] 开始执行
👀 [fetch_weather] 开始执行
   正在查询天气...
👀 [fetch_wardrobe] 开始执行
✅ [fetch_profile] 执行完成
✅ [fetch_weather] 执行完成
   天气：多云，温度：8°C
✅ [fetch_wardrobe] 执行完成
👀 [aggregate] 开始执行
✅ [aggregate] 执行完成
👀 [recommend] 开始执行
   正在生成穿搭推荐...
✅ [recommend] 执行完成
</code></pre></div>

<hr>
<h2 id="eino-vs-langchaingo">五、Eino vs LangChain：Go 开发者怎么选？</h2>
<table>
<thead>
<tr>
<th>维度</th>
<th>Eino (Go)</th>
<th>LangChain (Python)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>语言</strong></td>
<td>Go</td>
<td>Python</td>
</tr>
<tr>
<td><strong>类型安全</strong></td>
<td>✅ 编译时检查</td>
<td>❌ 运行时检查</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>✅ 高</td>
<td>一般</td>
</tr>
<tr>
<td><strong>部署</strong></td>
<td>✅ 单二进制</td>
<td>需要 Python 环境</td>
</tr>
<tr>
<td><strong>生态丰富度</strong></td>
<td>一般（在快速增长）</td>
<td>✅ 非常丰富</td>
</tr>
<tr>
<td><strong>文档完善度</strong></td>
<td>一般</td>
<td>✅ 完善</td>
</tr>
<tr>
<td><strong>社区活跃度</strong></td>
<td>活跃</td>
<td>✅ 非常活跃</td>
</tr>
<tr>
<td><strong>学习曲线</strong></td>
<td>需要懂 Go</td>
<td>更低</td>
</tr>
</tbody>
</table>
<p><strong>我的建议</strong>：</p>
<ul>
<li>如果你的团队是 <strong>Go 技术栈</strong>，选 Eino</li>
<li>如果你需要<strong>高性能、低资源占用</strong>，选 Eino</li>
<li>如果你需要<strong>最丰富的组件和示例</strong>，选 LangChain</li>
<li>如果你是 <strong>AI 应用新手</strong>，先用 LangChain 入门，再迁移到 Eino</li>
</ul>
<hr>
<h2 id="_5">六、常见问题与坑点</h2>
<h3 id="1-eof">1. 流处理的 EOF 处理</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 错误写法：忘记处理 EOF</span>
<span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">chunk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">stream</span><span class="p">.</span><span class="nx">Recv</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// EOF 也会触发 panic！</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 正确写法</span>
<span class="k">for</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">chunk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">stream</span><span class="p">.</span><span class="nx">Recv</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">break</span><span class="w"> </span><span class="c1">// 正常结束</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="c1">// 真正的错误</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="2-tool-json-schema">2. Tool 的 JSON Schema 要写对</h3>
<p>LLM 依赖 JSON Schema 来理解工具的参数。如果 Schema 写错了，LLM 可能无法正确调用工具。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 错误：缺少 description，LLM 不知道参数的含义</span>
<span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;clothing_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>

<span class="c1">// 正确：有清晰的 description 和示例</span>
<span class="s">&quot;properties&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;用户ID，如：user_001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="s">&quot;clothing_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;type&quot;</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;string&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;衣物类型，可选值：top（上衣）、bottom（下装）、outerwear（外套）、shoes（鞋子）、accessory（配饰）&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="3">3. 多工具协作时的状态管理</h3>
<p>穿衣助手需要多个工具协作，要注意状态的一致性：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 错误：每次调用都重新查询，效率低且可能不一致</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">recommendOutfit</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">OutfitRecommendation</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">profile</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fetchProfile</span><span class="p">(</span><span class="nx">userID</span><span class="p">)</span><span class="w">  </span><span class="c1">// 第一次查询</span>
<span class="w">    </span><span class="nx">weather</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fetchWeather</span><span class="p">(</span><span class="nx">profile</span><span class="p">.</span><span class="nx">City</span><span class="p">)</span>
<span class="w">    </span><span class="nx">wardrobe</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fetchWardrobe</span><span class="p">(</span><span class="nx">userID</span><span class="p">)</span><span class="w"> </span><span class="c1">// 如果用户在这之间更新了档案怎么办？</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// 正确：用 Graph 编排确保状态一致</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">BuildOutfitGraph</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Graph 会在同一个 context 中管理所有状态</span>
<span class="w">    </span><span class="c1">// 并行查询时会共享同一个时间点的快照</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="4-context">4. Context 超时设置</h3>
<p>穿衣推荐涉及多个工具调用，要设置合理的超时：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 单次工具调用可能需要 5-10 秒</span>
<span class="c1">// 穿衣助手可能调用 4-5 次工具</span>
<span class="c1">// 设置 60 秒的总超时比较合理</span>
<span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="mi">60</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
<span class="k">defer</span><span class="w"> </span><span class="nx">cancel</span><span class="p">()</span>

<span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
</code></pre></div>

<h3 id="5">5. 错误处理要完善</h3>
<div class="highlight"><pre><span></span><code><span class="nx">output</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">agent</span><span class="p">.</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">input</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 区分不同类型的错误</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">DeadlineExceeded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;⏰ 请求超时，可能是天气 API 响应慢&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Canceled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🚫 用户取消了请求&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Contains</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;rate limit&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;🔥 API 限流，请稍后重试&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;❌ 未知错误: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// 降级策略：返回一个通用推荐</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">defaultRecommendation</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="6">6. 用户偏好的冲突处理</h3>
<p>用户的偏好可能自相矛盾，Agent 需要智能处理：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 场景：用户说&quot;想穿休闲一点&quot;，但又说&quot;今天有重要会议&quot;</span>
<span class="c1">// 这两个需求可能冲突</span>

<span class="c1">// 在 SystemPrompt 中明确优先级</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">SystemPrompt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">`</span>
<span class="s">...</span>
<span class="s">## 冲突处理原则</span>
<span class="s">当用户需求存在冲突时，按以下优先级处理：</span>
<span class="s">1. 健康/舒适优先（怕冷就要保暖，膝盖不好就别穿裙子）</span>
<span class="s">2. 场合需求（正式场合不能穿拖鞋）</span>
<span class="s">3. 用户明确要求（用户最新说的话权重最高）</span>
<span class="s">4. 历史偏好（作为兜底参考）</span>
<span class="s">...</span>
<span class="s">`</span>
</code></pre></div>

<hr>
<h2 id="_6">总结</h2>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Eino</strong></td>
<td>Go 语言的 AI 应用开发框架，类似 Python 的 LangChain</td>
</tr>
<tr>
<td><strong>组件</strong></td>
<td>ChatModel、Tool、Retriever 等标准化的"积木块"</td>
</tr>
<tr>
<td><strong>Graph 编排</strong></td>
<td>把组件串联成复杂工作流，支持并行、分支、循环</td>
</tr>
<tr>
<td><strong>流处理</strong></td>
<td>原生支持流式输出，自动处理流的拼接、复制、合并</td>
</tr>
<tr>
<td><strong>回调</strong></td>
<td>OnStart、OnEnd、OnError 等切面，用于日志、追踪</td>
</tr>
<tr>
<td><strong>ReAct Agent</strong></td>
<td>开箱即用的"思考-行动-观察"循环 Agent</td>
</tr>
<tr>
<td><strong>多工具协作</strong></td>
<td>一个 Agent 可以调用多个 Tool，综合信息进行推理</td>
</tr>
</tbody>
</table>
<h3 id="_7">穿衣助手架构回顾</h3>
<div class="highlight"><pre><span></span><code>┌─────────────────────────────────────────────────────────────┐
│                     智能穿衣助手 Agent                        │
├─────────────────────────────────────────────────────────────┤
│  SystemPrompt: 穿搭原则、推荐流程、反馈处理                      │
├─────────────────────────────────────────────────────────────┤
│  Tools:                                                      │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 天气查询  │ │ 用户档案  │ │ 衣柜查询  │ │ 反馈保存  │        │
│  │ Tool     │ │ Tool     │ │ Tool     │ │ Tool     │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
├─────────────────────────────────────────────────────────────┤
│  ChatModel: GPT-4 / Claude / 本地模型                         │
├─────────────────────────────────────────────────────────────┤
│  Callbacks: 日志、追踪、监控                                   │
└─────────────────────────────────────────────────────────────┘
</code></pre></div>

<hr>
<h2 id="checklist">Checklist：你可以现在就做的事</h2>
<ul>
<li>[ ] 安装 Eino：<code>go get github.com/cloudwego/eino@latest</code></li>
<li>[ ] 跑一下官方示例：<a href="https://github.com/cloudwego/eino-examples">eino-examples</a></li>
<li>[ ] <strong>定义你的第一个 Tool</strong>（比如天气查询、用户档案查询）</li>
<li>[ ] <strong>写好 JSON Schema</strong>（description 写清楚，LLM 才能正确调用）</li>
<li>[ ] 构建一个 ReAct Agent，让它能调用多个 Tool</li>
<li>[ ] <strong>设计 SystemPrompt</strong>（定义 Agent 的"灵魂"：工作流程、推荐原则、冲突处理）</li>
<li>[ ] 尝试用 Graph 编排实现并行查询</li>
<li>[ ] 添加 Callback，把执行日志打印出来</li>
<li>[ ] <strong>处理用户反馈</strong>：保存反馈、调整推荐、多轮对话</li>
</ul>
<hr>
<h2 id="_8">扩展阅读</h2>
<ul>
<li><a href="https://github.com/cloudwego/eino">Eino GitHub</a> — 官方仓库</li>
<li><a href="https://www.cloudwego.io/docs/eino/">Eino 官方文档</a> — 详细教程</li>
<li><a href="https://www.cloudwego.io/docs/eino/quick-start/">Eino Quick Start</a> — 快速入门</li>
<li><a href="https://github.com/cloudwego/eino-examples">Eino Examples</a> — 示例代码</li>
<li><a href="https://www.cloudwego.io/">CloudWeGo</a> — 字节跳动开源的 Go 微服务生态</li>
</ul>
<hr>
<h2 id="_9">最后：穿衣助手只是开始</h2>
<p>回到开篇的问题：<strong>今天穿什么？</strong></p>
<p>现在我有了答案——让 AI 帮我想。</p>
<p>这个"穿衣助手"只是一个 Demo，但它展示了 AI Agent 的核心能力：</p>
<ul>
<li><strong>多工具协作</strong>：天气、用户档案、衣柜——Agent 能自己决定什么时候调用什么工具</li>
<li><strong>个性化推理</strong>：不是简单的 if-else，而是综合多个因素的智能推荐</li>
<li><strong>对话式交互</strong>：用户不满意？说出来，Agent 会调整</li>
</ul>
<p>这些能力可以迁移到无数场景：</p>
<ul>
<li><strong>旅行助手</strong>：查机票、查酒店、查景点、做行程——你只需要说"帮我规划去日本的行程"</li>
<li><strong>健康顾问</strong>：查体检报告、查饮食记录、查运动数据——给出个性化的健康建议</li>
<li><strong>代码审查员</strong>：读代码、查规范、跑测试——自动给出改进建议</li>
</ul>
<p><strong>Go 开发者终于有了自己的"LangChain"。</strong></p>
<p>Eino 还很年轻（2024 年底才开源），生态还在建设中。但它的设计理念是对的：<strong>类型安全、高性能、原生流处理</strong>。</p>
<p>如果你是 Go 开发者，想做 AI 应用，Eino 值得一试。</p>
<p>如果你在使用过程中遇到问题，可以去 <a href="https://github.com/cloudwego/eino/issues">GitHub Issues</a> 提问，或者加入他们的飞书群交流。</p>
<p><strong>从明天开始，让 AI 帮你挑衣服。</strong> 😄</p>
<hr/>
<p>本作品采用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/golang.html">golang</a>
      <a href="./tag/ai-agent.html">ai-agent</a>
      <a href="./tag/eino.html">eino</a>
      <a href="./tag/llm.html">llm</a>
      <a href="./tag/cloudwego.html">cloudwego</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./2026-nian-yi-ren-gong-si-zui-zhi-de-tou-ru-de-kai-yuan-xiang-mu.html" title="2026 年一人公司最值得投入的开源项目">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./rag-jin-jie-zhi-nan-bie-zhi-cheng-zhao-xiang-liang-shu-ju-ku-elasticsearch-cai-shi-sao-di-seng.html" title="RAG 进阶指南：别只盯着向量数据库，Elasticsearch 才是扫地僧">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./cong-pdca-dao-paoeai-agent-da-nao-li-de-xun-huan.html">从 PDCA 到 PAOE：AI Agent 大脑里的循环</a></li>
      <li><a href="./jing-ti-ni-de-go-cheng-xu-zheng-zai-tou-tou-xie-lou-xiang-jie-goroutine-leak.html">警惕！你的 Go 程序正在偷偷"泄漏" —— 详解 Goroutine Leak</a></li>
      <li><a href="./prompt-gong-cheng-yi-si-shang-xia-wen-gong-cheng-dang-li.html">Prompt 工程已死，上下文工程当立</a></li>
      <li><a href="./rag-jin-jie-zhi-nan-bie-zhi-cheng-zhao-xiang-liang-shu-ju-ku-elasticsearch-cai-shi-sao-di-seng.html">RAG 进阶指南：别只盯着向量数据库，Elasticsearch 才是扫地僧</a></li>
      <li><a href="./vibe-bian-cheng-de-xin-fan-shi-zai-ai-shi-dai-zhong-xin-ding-yi-ruan-jian-kai-fa.html">Vibe 编程的新范式：在 AI 时代重新定义软件开发</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>