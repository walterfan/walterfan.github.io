
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="./theme/pygments/github.min.css">



  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="./images/favicon.ico" type="image/x-icon">










 

<meta name="author" content="Walter Fan" />
<meta name="description" content="Daily minute" />
<meta name="keywords" content="journal, blog">


  <meta property="og:site_name" content="Walter Fan's Blog"/>
  <meta property="og:title" content="用你的浏览器拍照,录音和录像"/>
  <meta property="og:description" content="Daily minute"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./yong-ni-de-liu-lan-qi-pai-zhao-lu-yin-he-lu-xiang.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2021-02-25 10:20:00+08:00"/>
  <meta property="article:modified_time" content="2021-02-25 19:30:00+08:00"/>
  <meta property="article:author" content="./author/walter-fan.html">
  <meta property="article:section" content="Journal"/>
  <meta property="article:tag" content="journal"/>
  <meta property="article:tag" content="blog"/>
  <meta property="og:image" content="./images/walterfan.jpg">

  <title>Walter Fan's Blog &ndash; 用你的浏览器拍照,录音和录像</title>


</head>
<body class="light-theme">

<aside>
  <div>
    <a href="./">
      <img src="./images/walterfan.jpg" alt="Walter Fan" title="Walter Fan">
    </a>

    <h1>
      <a href="./">Walter Fan</a>
    </h1>

    <p>手握灵珠常奋笔, 心开天籁不吹箫</p>


    <nav>
      <ul class="list">



          <li>
            <a target="_self" href="/tao" >tao</a>
          </li>
          <li>
            <a target="_self" href="interest.html" >interest</a>
          </li>
          <li>
            <a target="_self" href="/wordpress" >notebook</a>
          </li>
          <li>
            <a target="_self" href="bookmark.html" >bookmark</a>
          </li>
          <li>
            <a target="_self" href="/webrtc/examples/index.html" >webrtc</a>
          </li>
          <li>
            <a target="_self" href="https://github.com/walterfan" >github</a>
          </li>
          <li>
            <a target="_self" href="https://www.jianshu.com/u/e0b365801f48" >技术文章</a>
          </li>
          <li>
            <a target="_self" href="/tao/tech" >技术笔记</a>
          </li>
          <li>
            <a target="_self" href="/tao/tool" >我的工具</a>
          </li>
          <li>
            <a target="_self" href="/tao" >给我留言</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="http://github.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-weibo"
           href="http://weibo.com/walterfan"
           target="_blank">
          <i class="fa-brands fa-weibo"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="yong-ni-de-liu-lan-qi-pai-zhao-lu-yin-he-lu-xiang">用你的浏览器拍照,录音和录像</h1>
    <p>
      Posted on Thu 25 February 2021 in <a href="./category/journal.html">Journal</a>

    </p>
  </header>


  <div>
    <h1 id="_1">用你的浏览器拍照</h1>
<p>先看一下效果，你可以在这里亲自动手试试 https://www.fanyamin.com/webrtc/examples/media_stream.html</p>
<p><img alt="media_stream" src="https://upload-images.jianshu.io/upload_images/1598924-96104f3b98854b35.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>WebRTC 中对媒体流 Media Stream 做了内置的支持，可以从电脑的摄像头，麦克风中捕获音频或视频流，并在 HTML5 所支持的 <video> 或 <audio> 或 <canvas> 中回放或展示。</p>
<ul>
<li>
<p>MediaStream 代表音频或视频数据流, 一个 MediaStream包含零个或多个 MediaStreamTrack ,</p>
</li>
<li>
<p>MediaStreamTrack 代表各种 audio 或 video track, 一个 MediaStreamTrack 包含一个或多个 Channels .</p>
</li>
<li>
<p>Channel 代表媒体流的最小单元, 例如音频信号关联到一个给定的 Speaker , 如立体声道的左右声道.</p>
</li>
</ul>
<p>MediaStream对象具有单个输入和单个输出。 由getUserMedia() 方法生成的MediaStream对象称为本地对象，其输入之一是用户的摄像机或麦克风。</p>
<p>非本地MediaStream可能表示为媒体元素（例如<video>或<audio>），通过网络发起并通过WebRTC RTCPeerConnection API 获得的流，或者使用Web Audio API MediaStreamAudioSourceNode创建的流。</p>
<p>MediaStream对象的输出链接到使用者。 它可以是媒体元素，例如<audio>或<video>，WebRTC RTCPeerConnection API或Web Audio API MediaStreamAudioSourceNode。</p>
<p><img alt="MediaStream" src="https://upload-images.jianshu.io/upload_images/1598924-5eba009d1d9a20a1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="api">API</h2>
<div class="highlight"><pre><span></span><code>var promise = navigator.mediaDevices.getUserMedia(constraints);
</code></pre></div>

<p>基本用法</p>
<div class="highlight"><pre><span></span><code>async function getMedia(constraints) {
  let stream = null;

  try {
    stream = await navigator.mediaDevices.getUserMedia(constraints);
    /* use the stream */
  } catch(err) {
    /* handle the error */
  }
}
// or not use promise
navigator.mediaDevices.getUserMedia(constraints)
.then(function(stream) {
  /* use the stream */
})
.catch(function(err) {
  /* handle the error */
});
</code></pre></div>

<h2 id="_2">实例</h2>
<p>开始提到的实例怎么实现呢，其实很简单</p>
<p>1）先创建一个 media_stream.html</p>
<div class="highlight"><pre><span></span><code>&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;/&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
&lt;title&gt; WebRTC Examples&lt;/title&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/6.4.0/adapter.min.js&quot; &gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.1/jquery.min.js&quot; &gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery.blockUI/2.70/jquery.blockUI.min.js&quot; &gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/util.js&quot; &gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/media_stream_demo.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    $(function() {
        $(&quot;.navbar-static-top&quot;).load(&quot;navbar.html&quot;, function() {
            $(&quot;.navbar-static-top li.dropdown&quot;).addClass(&quot;active&quot;);
            $(&quot;.navbar-static-top a[href=&#39;echotest.html&#39;]&quot;).parent().addClass(&quot;active&quot;);
        });
    $(&quot;.footer&quot;).load(&quot;footer.html&quot;);
    //-----------------------------------------------------------//

    weblog(&quot;-------- Available User Devices -----------&quot;)
    listUserDevices();

    const constraints = window.constraints = {
      audio: false,
      video: true
    };

    const resSelect = document.querySelector(&#39;select#resolution&#39;);
    var selectedRes = resSelect.value;


    switch(selectedRes) {
      case &quot;qvga&quot;:
        constraints.video = {
          mandatory: {
            maxWidth: 320,
            maxHeight: 240
          }
        }  
        break;
      case &quot;vga&quot;:
        constraints.video = {
            mandatory: {
              maxWidth: 640,
              maxHeight: 480
            }
          }  

        break;
      default:
        constraints.video = {
            mandatory: {
              maxWidth: 1024,
              maxHeight: 768
            }
          }  

        break;
    }      

    const filterSelect = document.querySelector(&#39;select#filter&#39;);
    filterSelect.onchange = function() {
      const video = document.querySelector(&#39;video&#39;);
      video.className = filterSelect.value;
    };

    document.querySelector(&#39;#open&#39;).addEventListener(&#39;click&#39;, e =&gt; openCamera(e, constraints));

    document.querySelector(&#39;#close&#39;).addEventListener(&#39;click&#39;, e =&gt; closeCamera(e, constraints));

    document.querySelector(&#39;#snapshot&#39;).addEventListener(&#39;click&#39;, e =&gt; takeSnapshot(e));

    });
&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css&quot; type=&quot;text/css&quot;/&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;css/demo.css&quot; type=&quot;text/css&quot;/&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css&quot; type=&quot;text/css&quot;/&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css&quot;/&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;!-- 
  &lt;a href=&quot;https://github.com/walterfan/webrtc-primer&quot;&gt;&lt;img style=&quot;position: absolute; top: 0; left: 0; border: 0; z-index: 1001;&quot; src=&quot;https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png&quot; alt=&quot;Fork me on GitHub&quot;&gt;&lt;/a&gt;
--&gt;
&lt;nav class=&quot;navbar navbar-default navbar-static-top&quot;&gt;
&lt;/nav&gt;

&lt;div class=&quot;container&quot;&gt;
    &lt;div class=&quot;row&quot;&gt;
        &lt;div class=&quot;col-md-12&quot;&gt;
            &lt;div class=&quot;page-header&quot;&gt;
                &lt;h1&gt;WebRTC example of User Media &lt;/h1&gt;
            &lt;/div&gt;
            &lt;div class=&quot;container&quot; id=&quot;details&quot;&gt;
          &lt;div class=&quot;row&quot;&gt;

              &lt;div class=&quot;col-lg-12&quot;&gt;

                &lt;p&gt;Click the button to open, close camera or take snapshot&lt;/p&gt;
                &lt;div&gt;

                      &lt;button class=&quot;btn btn-default&quot; autocomplete=&quot;off&quot; id=&quot;open&quot;&gt;Open Camera&lt;/button&gt;
                      &lt;label for=&quot;resolution&quot;&gt;resolution &lt;/label&gt;
                      &lt;select id=&quot;resolution&quot;&gt;
                          &lt;option value=&quot;qvga&quot;&gt;320*240&lt;/option&gt;
                          &lt;option value=&quot;vga&quot;&gt;640*480&lt;/option&gt;
                          &lt;option value=&quot;hd&quot;&gt;1280*960&lt;/option&gt;
                      &lt;/select&gt;

                      &lt;button class=&quot;btn btn-default&quot; autocomplete=&quot;off&quot; id=&quot;close&quot;&gt;Close Camera&lt;/button&gt;
                      &lt;button class=&quot;btn btn-default&quot; autocomplete=&quot;off&quot; id=&quot;snapshot&quot;&gt;Take Snapshort&lt;/button&gt;

                      &lt;label for=&quot;filter&quot;&gt;Filter: &lt;/label&gt;
                      &lt;select id=&quot;filter&quot;&gt;
                          &lt;option value=&quot;none&quot;&gt;None&lt;/option&gt;
                          &lt;option value=&quot;blur&quot;&gt;Blur&lt;/option&gt;
                          &lt;option value=&quot;grayscale&quot;&gt;Grayscale&lt;/option&gt;
                          &lt;option value=&quot;invert&quot;&gt;Invert&lt;/option&gt;
                          &lt;option value=&quot;sepia&quot;&gt;Sepia&lt;/option&gt;
                      &lt;/select&gt;                   

                &lt;/div&gt;
                &lt;br/&gt;
              &lt;/div&gt;
              &lt;div class=&quot;col-lg-12&quot;&gt;

                &lt;div class=&quot;col-lg-6&quot;&gt;&lt;video id=&quot;localVideo&quot; autoplay playsinline controls=&quot;true&quot;&gt;&lt;/video&gt;&lt;/div&gt;
                &lt;div class=&quot;col-lg-6&quot;&gt;&lt;canvas id=&quot;localCanvas&quot;&gt;&lt;/canvas&gt;&lt;/div&gt;
              &lt;/div&gt;
          &lt;/div&gt;

          &lt;div class=&quot;note&quot;&gt;

              &lt;div id=&quot;logDiv&quot;&gt;
                  &lt;ul id=&quot;logContent&quot;&gt;

                  &lt;/ul&gt;

              &lt;/div&gt;

            &lt;/div&gt;
            &lt;/div&gt;

        &lt;/div&gt;
    &lt;/div&gt;

    &lt;hr&gt;
    &lt;div class=&quot;footer&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>

<p>2)  创建 media_stream_demo.js</p>
<div class="highlight"><pre><span></span><code>&#39;use strict&#39;;

// Put variables in global scope to make them available to the browser console.


function handleSuccess(stream) {
  const video = document.querySelector(&#39;video&#39;);
  const videoTracks = stream.getVideoTracks();
  console.log(&#39;Got stream with constraints:&#39;, constraints);
  console.log(`Using video device: ${videoTracks[0].label}`);
  window.stream = stream; // make variable available to browser console
  video.srcObject = stream;
}

function handleError(error) {
  if (error.name === &#39;ConstraintNotSatisfiedError&#39;) {
    const v = constraints.video;
    errorMsg(`The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.`);
  } else if (error.name === &#39;PermissionDeniedError&#39;) {
    errorMsg(&#39;Permissions have not been granted to use your camera and &#39; +
      &#39;microphone, you need to allow the page access to your devices in &#39; +
      &#39;order for the demo to work.&#39;);
  }
  errorMsg(`getUserMedia error: ${error.name}`, error);
}

function errorMsg(msg, error) {
  const errorElement = document.querySelector(&#39;#logDiv&#39;);
  errorElement.innerHTML += `&lt;p&gt;${msg}&lt;/p&gt;`;
  if (typeof error !== &#39;undefined&#39;) {
    console.error(error);
  }
}

async function openCamera(e, constraints) {
  try {
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    handleSuccess(stream);
    e.target.disabled = true;
    document.querySelector(&#39;#close&#39;).disabled = false;
  } catch (ex) {
    handleError(ex);
  }
}

function closeCamera(e) {
    const videoElem = document.querySelector(&#39;video&#39;);
    const stream = videoElem.srcObject;
    const tracks = stream.getTracks();
    e.target.disabled = true;
    document.querySelector(&#39;#open&#39;).disabled = false;
    tracks.forEach(function(track) {
      track.stop();
    });

    videoElem.srcObject = null;
}

async function takeSnapshot(e) {
    console.log(&quot;take snapshot&quot;);
    try {
        const video = document.querySelector(&#39;video&#39;);
        const canvas = window.canvas = document.querySelector(&#39;canvas&#39;);
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext(&#39;2d&#39;).drawImage(video, 0, 0, canvas.width, canvas.height);
    } catch (ex) {
        handleError(ex);
    }
}
</code></pre></div>

<p>3) 点击  "Oper Camera" 来打开摄像头，点击 “Take Snapshot” 来拍摄快照</p>
<p>4) 可以自己动手试试，通过选择 "resolution" 来调整 getUserMedia 的 Contraints </p>
<p>5) 可以自己动手试试，通过更改 "Filter" 来为摄像头捕捉的视频添加滤镜。</p>
<h1 id="_3">用你的浏览器录音和录像</h1>
<p>既然现在的笔记本电脑，平板，手机都有摄像头和麦克风，那么录音和录像就是一件非常容易的事情了，但是如果不用别人写好的录音录像程序，让你自己来实现一个录音和录像应用，其实也没那么简单。</p>
<p>但是有了 WebRTC 和支持它的浏览器， 事情就变得简单多了</p>
<p>现代浏览器不仅支持 audio 和 video 两个新的元素，还支持了MediaStream 和 MediaRecorder 这样的媒体 API </p>
<h1 id="html">第一步：创建一个供演示的 HTML  文件</h1>
<ul>
<li>源码在此 <a href="https://github.com/walterfan/webrtc_primer/blob/main/examples/record_demo.html" referrerpolicy="no-referrer" rel="noopener noreferrer" target="_blank" title="record_demo.html">record_demo.html</a></li>
</ul>
<p>这个 html 文件很简单，就是如下四个按钮</p>
<p><img alt="web gui" src="https://upload-images.jianshu.io/upload_images/1598924-8cda83479a5b1c27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>再加上一个 HTML5 支持的 video 元素</p>
<div class="highlight"><pre><span></span><code>&lt;video autoplay&gt;&lt;/video&gt; 
</code></pre></div>

<h1 id="click">第二步：处理这四个按键的的 click 事件</h1>
<p>源码见 <a href="https://github.com/walterfan/webrtc_primer/blob/main/examples/js/record_demo.js" referrerpolicy="no-referrer" rel="noopener noreferrer" target="_blank" title="record_demo.js">record_demo.js</a></p>
<h2 id="1-open-media-">1. 打开媒体 “open media” 按键的处理 - 获取本地媒体流</h2>
<div class="highlight"><pre><span></span><code>var localStream = null;
var mediaRecorder = null;
var recordChunks = [];
var recordElement = document.querySelector(&#39;video&#39;);
var recordMediaType = &#39;video/webm&#39;;

var mediaConstraints = {
    audio:  {
        echoCancellation: {exact: true}
      },
    video: {
        width: 640, 
        height: 480
    }
};

async function openMedia(e, constraints) {
    if (mediaButton.textContent === &#39;Close Media&#39;) {
        closeMedia(e);
        return;
    }

    try {
        const stream = await navigator.mediaDevices.getUserMedia(mediaConstraints);
        handleSuccess(stream);
        mediaButton.textContent = &#39;Close Media&#39;;    
        console.log(&#39;openMedia success &#39;);
    } catch (ex) {
        handleError(ex);
    }
}

function handleSuccess(stream) {
    localStream = stream;
    recordElement.srcObject = stream;
}
</code></pre></div>

<p>上述代码获取本地用户的 audio 和 video 媒体流，async 和 await 关键字是ES7 提供的异步支持，await 就是先返回，等异步操作完成再回来执行下一步语句， async 代表函数是异步的。
当媒体流获取后，就赋予本地的</p>
<h2 id="2-start-record-">2. 开始录制 “start record” 的处理 - 录制本地媒体流</h2>
<p>MediaRecorder API 就是录制媒体流的核心</p>
<p><img alt="image.png" src="https://upload-images.jianshu.io/upload_images/1598924-17c1cf6ef5e39e66.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<div class="highlight"><pre><span></span><code>function startRecord() {
    if(!localStream) {
        console.error(&quot;stream is not created.&quot;);
        return;
    }

    if (recordButton.textContent === &#39;Stop Record&#39;) {
        stopRecord();
        return;
    } 

    var options = {mimeType: recordMediaType};
    mediaRecorder = new MediaRecorder(localStream, options);
    mediaRecorder.start();

    recordButton.textContent = &#39;Stop Record&#39;;
    playButton.disabled = true;
    downButton.disabled = true;

    console.log(&quot;recorder started&quot;);

    mediaRecorder.ondataavailable = function(e) {
        console.log(&quot;data available&quot;, e.data);
        recordChunks.push(e.data);
    }

    mediaRecorder.onstop = function(e) {
        console.log(&#39;onstop fired&#39;);
        var blob = new Blob(recordChunks, { &#39;type&#39; : recordMediaType });
        var blobURL = URL.createObjectURL(blob);
        const a = document.createElement(&#39;a&#39;);
        a.style.display = &#39;none&#39;;
        a.href = blobURL;
        a.download = &#39;test.webm&#39;;
        document.body.appendChild(a);
    };
}
</code></pre></div>

<p>上述代码很简单，关键的地方就是创建 MediaRecorder 对象，传入媒体流，然后开始录制</p>
<div class="highlight"><pre><span></span><code>var options = {mimeType: recordMediaType};
mediaRecorder = new MediaRecorder(localStream, options);
mediaRecorder.start();
</code></pre></div>

<p>为了能播放和下载所录制的媒体文件，需要将录制的内容存贮下来
<code>var recordChunks = [];</code>是一个字节数组， 在录制停止时一起存入本地的 blob 对象中</p>
<div class="highlight"><pre><span></span><code>    mediaRecorder.ondataavailable = function(e) {
        console.log(&quot;data available&quot;, e.data);
        recordChunks.push(e.data);
    }

    mediaRecorder.onstop = function(e) {
        console.log(&#39;onstop fired&#39;);
        var blob = new Blob(recordChunks, { &#39;type&#39; : recordMediaType });
        var blobURL = URL.createObjectURL(blob);
        const a = document.createElement(&#39;a&#39;);
        a.style.display = &#39;none&#39;;
        a.href = blobURL;
        a.download = &#39;test.webm&#39;;
        document.body.appendChild(a);
    };
</code></pre></div>

<h2 id="3-plan-record-">3. 播放 “Plan Record” 的处理 - 播放本地存储的媒体文件</h2>
<p>它由录制时保存下来的 blob 数组创建出来</p>
<div class="highlight"><pre><span></span><code>function playRecord() {
    const blob = new Blob(recordChunks, {type: recordMediaType});
    recordElement.src = null;
    recordElement.srcObject = null;
    recordElement.src = window.URL.createObjectURL(blob);
    recordElement.controls = true;
    recordElement.play();
}
</code></pre></div>

<h2 id="4-download-record-">4. 下载 “Download Record ” 的处理 -  下载本地存储的媒体文件</h2>
<div class="highlight"><pre><span></span><code>function downRecord() {
    const blob = new Blob(recordChunks, {type: recordMediaType});
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement(&#39;a&#39;);
    a.style.display = &#39;none&#39;;
    a.href = url;
    a.download = &#39;test.webm&#39;;
    document.body.appendChild(a);
    a.click();
    setTimeout(() =&gt; {
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
    }, 100);
}
</code></pre></div>

<p>可点击https://www.fanyamin.com/webrtc/examples/record_demo.html 看最终的效果：</p>
<p><img alt="record_demo" src="https://upload-images.jianshu.io/upload_images/1598924-fb4ccdf3c4b167fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h1 id="_4">参考资料</h1>
<ul>
<li>https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia</li>
<li>MediaRecorderAPI 参见  https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder </li>
<li>MediaRecorder 示例参考 https://webrtc.github.io/samples/src/content/getusermedia/record/</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/journal.html">journal</a>
      <a href="./tag/blog.html">blog</a>
    </p>
  </div>


  <div class="neighbors">
    <a class="btn float-left" href="./journal-on-2021-02-16.html" title="Journal on 2021-02-16">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="./web-de-wang-zhe-javascript-yu-zhan-yu-yong.html" title="Web 的王者 Javascript 愈战愈勇">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>You might enjoy</h4>
    <ul class="related-posts">
      <li><a href="./wo-zai-chuang-ye-gong-si-zhe-yi-nian.html">我在创业公司这一年</a></li>
      <li><a href="./shen-suo-de-yi-zhu.html">伸缩的艺术</a></li>
      <li><a href="./bian-cheng-jiang-hu-zhong-de-dao-yu-zhu.html">编程江湖中的道与术</a></li>
      <li><a href="./pydantic-dui-xiang-de-xian-jing.html">pydantic 对象的陷阱</a></li>
      <li><a href="./bian-cheng-yu-yan-de-bian-jie.html">编程语言的边界</a></li>
    </ul>
  </div>



<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'wfblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

<footer>
<p>&copy; 2010 ~ 2030  Walter Fan <a href="https://beian.miit.gov.cn" target="_blank">皖ICP备20001876号-1</a></p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><!-- StatusCake -->

<!-- End StatusCake --></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Walter Fan's Blog ",
  "url" : ".",
  "image": "./images/walterfan.jpg",
  "description": "an old programmer never die, he just branch to a new address."
}
</script>
</body>
</html>